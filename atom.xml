<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ShijieQin</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://shijieqin.github.io/"/>
  <updated>2017-11-24T05:52:09.000Z</updated>
  <id>https://shijieqin.github.io/</id>
  
  <author>
    <name>Shijie Qin</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Centos6修改Hostname</title>
    <link href="https://shijieqin.github.io/2017/11/24/Centos6%E4%BF%AE%E6%94%B9Hostname/"/>
    <id>https://shijieqin.github.io/2017/11/24/Centos6修改Hostname/</id>
    <published>2017-11-24T05:52:09.000Z</published>
    <updated>2017-11-24T05:52:09.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="查看当前hostname"><a href="#查看当前hostname" class="headerlink" title="查看当前hostname"></a>查看当前hostname</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# hostname</div><div class="line">node01.myCluster.com</div></pre></td></tr></table></figure><a id="more"></a><h3 id="临时修改hostname"><a href="#临时修改hostname" class="headerlink" title="临时修改hostname"></a>临时修改hostname</h3><p>命令格式为：</p><p><strong><em>hostname newhostname</em></strong></p><p>如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# hostname node02.myCluster.com</div><div class="line">[root@node01 ~]# hostname</div><div class="line">node02.myCluster.com</div></pre></td></tr></table></figure><p>通过以上修改，只能临时生效，重启服务器后失效</p><h3 id="修改-etc-sysconfig-network"><a href="#修改-etc-sysconfig-network" class="headerlink" title="修改/etc/sysconfig/network"></a>修改/etc/sysconfig/network</h3><p>通过修改/etc/sysconfig/network中的hostname，实现永久生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NETWORKING=yes</div><div class="line">HOSTNAME=node02.myCluster.com</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;查看当前hostname&quot;&gt;&lt;a href=&quot;#查看当前hostname&quot; class=&quot;headerlink&quot; title=&quot;查看当前hostname&quot;&gt;&lt;/a&gt;查看当前hostname&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@node01 ~]# hostname&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;node01.myCluster.com&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="LINUX" scheme="https://shijieqin.github.io/categories/LINUX/"/>
    
      <category term="hostname" scheme="https://shijieqin.github.io/categories/LINUX/hostname/"/>
    
    
      <category term="LINUX" scheme="https://shijieqin.github.io/tags/LINUX/"/>
    
      <category term="hostname" scheme="https://shijieqin.github.io/tags/hostname/"/>
    
  </entry>
  
  <entry>
    <title>hwcloud上的Oracle RAC 12cR2安装手册(1)--环境的准备</title>
    <link href="https://shijieqin.github.io/2017/11/23/hwcloud%E4%B8%8A%E7%9A%84Oracle-RAC-12cR2%E5%AE%89%E8%A3%85%E6%89%8B%E5%86%8C-1-%E7%8E%AF%E5%A2%83%E7%9A%84%E5%87%86%E5%A4%87/"/>
    <id>https://shijieqin.github.io/2017/11/23/hwcloud上的Oracle-RAC-12cR2安装手册-1-环境的准备/</id>
    <published>2017-11-23T09:15:01.000Z</published>
    <updated>2017-11-23T09:15:01.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h3><h4 id="网卡分配"><a href="#网卡分配" class="headerlink" title="网卡分配"></a>网卡分配</h4><table><thead><tr><th>网卡名</th><th>作用</th><th>网段</th></tr></thead><tbody><tr><td>eth0</td><td>Public IP</td><td>192.168.1.0/24</td></tr><tr><td>eth1</td><td>NET IP</td><td>192.168.2.0/24</td></tr><tr><td>eth2</td><td>Private IP</td><td>192.168.6.0/24</td></tr></tbody></table><p>这里我用了三块网卡：</p><ul><li>eth0做Public IP的网卡，同时会绑定Virtual IP 和 SCAN IP</li><li>eth1做NET IP的网卡，用来提供访问互联网的服务</li><li>eth2做Private的网卡，用来做节点之间的数据交互</li></ul><a id="more"></a><h4 id="IP段分配"><a href="#IP段分配" class="headerlink" title="IP段分配"></a>IP段分配</h4><table><thead><tr><th>Name</th><th>node01</th><th>node02</th></tr></thead><tbody><tr><td>Public IP</td><td>192.168.1.14</td><td>192.168.1.15</td></tr><tr><td>Private IP</td><td>192.168.6.2</td><td>192.168.6.3</td></tr><tr><td>Virtual IP</td><td>192.168.1.16</td><td>192.168.1.17</td></tr><tr><td>SCAN IP</td><td>192.168.1.18</td><td>192.168.1.19</td></tr><tr><td></td><td>192.168.1.20</td><td></td></tr><tr><td>NET IP</td><td>192.168.2.95</td><td>192.168.2.96</td></tr></tbody></table><h4 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h4><p>参考<a href="/2017/11/24/Centos6修改Hostname/" title="Centos6修改Hostname">Centos6修改Hostname</a></p><p>分别将两个节点的主机名改为node01.myCluster.com、node02.myCluster.com</p><h4 id="配置host解析"><a href="#配置host解析" class="headerlink" title="配置host解析"></a>配置host解析</h4><p>修改node1和node2的hosts文件，添加如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"># Public</div><div class="line">192.168.1.14 node01.myCluster.com node01</div><div class="line">192.168.1.14 node02.myCluster.com node02</div><div class="line"># Private</div><div class="line">192.168.6.2   node01-priv.myCluster.com   node01-priv</div><div class="line">192.168.6.3   node02-priv.myCluster.com   node02-priv</div><div class="line"># Virtual</div><div class="line">192.168.1.16   node01-vip.myCluster.com    node01-vip</div><div class="line">192.168.1.17   node02-vip.myCluster.com    node02-vip</div><div class="line"># SCAN</div><div class="line">192.168.1.18   nodes-scan.myCluster.com nodes-scan</div><div class="line">192.168.1.19   nodes-scan.myCluster.com nodes-scan</div><div class="line">192.168.1.20   nodes-scan.myCluster.com nodes-scan</div></pre></td></tr></table></figure><h4 id="关闭libvirt的虚拟网卡功能"><a href="#关闭libvirt的虚拟网卡功能" class="headerlink" title="关闭libvirt的虚拟网卡功能"></a>关闭libvirt的虚拟网卡功能</h4><p>如果服务器安装了libvirt，则需要关闭其自带的虚拟网卡功能，方法如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">virsh net-list</div><div class="line">virsh net-destroy default</div><div class="line">virsh net-undefine default</div><div class="line">service libvirtd restart</div></pre></td></tr></table></figure><p><strong><em>(注：华为云提供的Centos6.8镜像不需要做此操作)</em></strong></p><h4 id="禁用ZEROCONF"><a href="#禁用ZEROCONF" class="headerlink" title="禁用ZEROCONF"></a>禁用ZEROCONF</h4><p>分别编辑node01和node02上的/etc/sysconfig/network，添加如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NOZEROCONF=yes</div></pre></td></tr></table></figure><p>###操作系统配置</p><h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install binutils compat-libcap1 compat-libstdc++ compat-libstdc++-33 e2fsprogs e2fsprogs-libs glibc glibc glibc-devel glibc-devel ksh libgcc libgcc libstdc++ libstdc++ libstdc++-devel libstdc++-devel libaio libaio libaio-devel libaio-devel libXtst libXtst libX11 libX11 libXau libXau libxcb libxcb libXi libXi make net-tools nfs-utils sysstat smartmontools</div></pre></td></tr></table></figure><h4 id="配置内核参数"><a href="#配置内核参数" class="headerlink" title="配置内核参数"></a>配置内核参数</h4><p>我服务器配置为<strong><em>4C/8G</em></strong></p><p>在node01和node02上编辑/etc/sysctl.conf，添加或修改如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">kernel.shmall = 4294967296</div><div class="line">kernel.shmmax = 8589934591</div><div class="line">fs.aio-max-nr = 1048576</div><div class="line">fs.file-max = 6815744</div><div class="line">kernel.shmmni = 4096</div><div class="line">kernel.sem = 250 32000 100 128</div><div class="line">net.ipv4.ip_local_port_range = 9000 65500</div><div class="line">net.core.rmem_default = 262144</div><div class="line">net.core.rmem_max = 4194304</div><div class="line">net.core.wmem_default = 262144</div><div class="line">net.core.wmem_max = 1048576</div><div class="line">kernel.panic_on_oops=1</div></pre></td></tr></table></figure><p>关于以上部分参数的介绍：</p><p><strong>kernel.shmmax</strong>:</p><blockquote><p>用来定义共享内存单个共享内存段可使用的内存大小，最好设置改值得大小能容下整个SGA的大小，否则会导致性能下降，原因是因为在实例启动以及ServerProcess创建的时候，多个小的共享内存段可能会导致当时轻微的系统性能的降低(在启动的时候需要去创建多个虚拟地址段，在进程创建的时候要让进程对多个段进行“识别”，会有一些影响)，但是其他时候都不会有影响。</p></blockquote><p><strong><em>以上未经过验证</em></strong></p><p>基于以上的说法，在设置改参数的时候需要考虑SGA的大小。在我的数据库中，一般设置MEMORY_TARGET为物理内存80%，SGA又占MEMORY_TARGET的80%，因此可将kernel.shmmax设置为物理内存的64%，一般情况下大于SGA即可，这里为了方便计算，我设置为物理-1byte，既8589934591byte</p><p><strong>kernel.shmall</strong>:</p><blockquote><p>该参数控制可以使用的共享内存的总页数。Linux共享内存页大小为4KB,共享内存段的大小都是共享内存页大小的整数倍。一个共享内存段的最大大小是16G，那么需要共享内存页数是16GB/4KB=16777216KB /4KB=4194304（页），也就是64Bit系统下16GB物理内存，设置kernel.shmall = 4194304才符合要求(几乎是原来设置2097152的两倍)。这时可以将shmmax参数调整到16G了，同时可以修改SGA_MAX_SIZE和SGA_TARGET为12G（您想设置的SGA最大大小，当然也可以是2G~14G等，还要协调PGA参数及OS等其他内存使用，不能设置太满，比如16G）</p></blockquote><p><strong><em>以上的说法来自于网络，这里贴出来仅供参考</em></strong></p><p>其实，该参数是用来控制可用的共享内存数的，单位是page(通常在linux中1page=4KB)，只要可用的共享内存书大于SGA的大小即可，一般默认的大小就可以满足大部分oracle的需求了，这里我没有修改默认值</p><p><strong><em>kernel.shmmni</em></strong>：</p><blockquote><p>该参数是共享内存段的最大数量。shmmni缺省值4096，一般肯定是够用了。</p></blockquote><p><strong><em>fs.file-max</em></strong>：</p><blockquote><p>该参数决定了系统中所允许的文件句柄最大数目，文件句柄设置代表linux系统中可以打开的文件的数量。</p></blockquote><p><strong><em>fs.aio-max-nr</em></strong>：</p><blockquote><p>此参数限制并发未完成的请求，应该设置避免I/O子系统故障。</p></blockquote><p><strong><em>kernel.sem</em></strong>：</p><blockquote><p>以kernel.sem = 250 32000 100 128为例：</p><p>​       250是参数semmsl的值，表示一个信号量集合中能够包含的信号量最大数目。</p><p>​       32000是参数semmns的值，表示系统内可允许的信号量最大数目。</p><p>​       100是参数semopm的值，表示单个semopm()调用在一个信号量集合上可以执行的操作数量。</p><p>​       128是参数semmni的值，表示系统信号量集合总数。</p></blockquote><p><strong><em>net.ipv4.ip_local_port_range</em></strong>：</p><blockquote><p>表示应用程序可使用的IPv4端口范围。</p></blockquote><p><strong><em>net.core.rmem_default</em></strong>：</p><blockquote><p>表示套接字接收缓冲区大小的缺省值。</p></blockquote><p><strong><em>net.core.rmem_max</em></strong>：</p><blockquote><p>表示套接字接收缓冲区大小的最大值。</p></blockquote><p><strong><em>net.core.wmem_default</em></strong>：</p><blockquote><p>表示套接字发送缓冲区大小的缺省值。</p></blockquote><p><strong><em>net.core.wmem_max</em></strong>：</p><blockquote><p>表示套接字发送缓冲区大小的最大值。</p></blockquote><p>执行<code>sysctl -p</code>使其生效</p><h4 id="关闭NTP"><a href="#关闭NTP" class="headerlink" title="关闭NTP"></a>关闭NTP</h4><p>Oracle Rac有自带的<strong>Oracle Cluster Time Synchronization Service</strong>来保证节点间的时间同步，因此，关闭自带的NTP服务</p><p>命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">/sbin/service ntpd stop</div><div class="line">chkconfig ntpd off</div><div class="line">mv /etc/ntp.conf /etc/ntp.conf.org</div><div class="line">rm /var/run/ntpd.pid</div></pre></td></tr></table></figure><h4 id="配置PAM"><a href="#配置PAM" class="headerlink" title="配置PAM"></a>配置PAM</h4><p>在node01和node02节点上编辑<strong>/etc/pam.d/login</strong>，添加如下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">session required pam_limits.so</div></pre></td></tr></table></figure><h4 id="limit文件"><a href="#limit文件" class="headerlink" title="limit文件"></a>limit文件</h4><p>在node01和node02节点上编辑<strong>/etc/security/limits.conf</strong>，添加如下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@oinstall hard nofile 65536</div><div class="line">@oinstall soft nofile 10240</div><div class="line">@oinstall hard nproc 16384</div><div class="line">@oinstall soft nproc 16384</div><div class="line">@oinstall hard stack 32768</div><div class="line">@oinstall soft stack 10240</div><div class="line">@oinstall soft memlock 475188563</div><div class="line">@oinstall hard memlock 475188563</div></pre></td></tr></table></figure><h4 id="关闭SELinux"><a href="#关闭SELinux" class="headerlink" title="关闭SELinux"></a>关闭SELinux</h4><p>在node01和node02上分别执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setenforce 0</div></pre></td></tr></table></figure><p>在node01和node02节点上编辑文件<strong>/etc/sysconfig/selinux</strong>，修改如下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELINUX=disabled</div></pre></td></tr></table></figure><h4 id="创建用户、组、文件夹"><a href="#创建用户、组、文件夹" class="headerlink" title="创建用户、组、文件夹"></a>创建用户、组、文件夹</h4><p>在node01和node02上分别执行如下命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">groupadd -g 1000 oinstall</div><div class="line">groupadd -g 1020 asmadmin</div><div class="line">groupadd -g 1021 asmdba</div><div class="line">groupadd -g 1022 asmoper</div><div class="line">groupadd -g 1031 dba</div><div class="line">groupadd -g 1032 oper</div><div class="line">useradd -u 1100 -g oinstall -G asmadmin,asmdba,asmoper,oper,dba grid</div><div class="line">useradd -u 1101 -g oinstall -G dba,asmdba,oper oracle</div><div class="line">mkdir -p /u01/software</div><div class="line">mkdir -p /u01/app/12.2.0/grid</div><div class="line">mkdir -p /u01/app/grid</div><div class="line">mkdir -p /u01/app/oracle</div><div class="line">chown -R grid:oinstall /u01</div><div class="line">chown oracle:oinstall /u01/app/oracle</div><div class="line">chmod -R 775 /u01/</div></pre></td></tr></table></figure><p>将下面的两个文件分别上传至node01的/u01/software文件夹下</p><ul><li>linuxx64_12201_grid_home.zip</li><li>linuxx64_12201_database.zip</li></ul><p>解压并修改对应权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd /u01/software</div><div class="line">unzip linuxx64_12201_grid_home.zip -d /u01/app/12.2.0/grid/</div><div class="line">chown -R grid:oinstall /u01/app/12.2.0/grid/</div><div class="line">unzip linuxx64_12201_database.zip</div><div class="line">chown oracle:oinstall database</div></pre></td></tr></table></figure><h4 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h4><h5 id="配置grid用户的环境变量"><a href="#配置grid用户的环境变量" class="headerlink" title="配置grid用户的环境变量"></a>配置grid用户的环境变量</h5><p>在node01上，grid用户</p><p>编辑<strong>/home/grid/.bash_profile</strong>，添加如下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">export ORACLE_SID=+ASM1</div><div class="line">export TMP=/tmp</div><div class="line">export ORACLE_BASE=/u01/app/grid</div><div class="line">export ORACLE_HOME=/u01/app/12.2.0/grid</div><div class="line">export PATH=$ORACLE_HOME/bin:/usr/sbin:$PATH</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib</div><div class="line">export LC_ALL=en_US.UTF-8</div></pre></td></tr></table></figure><p>在node02上，grid用户</p><p>编辑<strong>/home/grid/.bash_profile</strong>，添加如下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">export ORACLE_SID=+ASM2</div><div class="line">export TMP=/tmp</div><div class="line">export ORACLE_BASE=/u01/app/grid</div><div class="line">export ORACLE_HOME=/u01/app/12.2.0/grid</div><div class="line">export PATH=$ORACLE_HOME/bin:/usr/sbin:$PATH</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib</div><div class="line">export LC_ALL=en_US.UTF-8</div></pre></td></tr></table></figure><h5 id="配置oracle的环境变量"><a href="#配置oracle的环境变量" class="headerlink" title="配置oracle的环境变量"></a>配置oracle的环境变量</h5><p>在node01上，oracle用户</p><p>编辑<strong>/home/oracle/.bash_profile</strong>，添加如下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">export TMP=/tmp</div><div class="line">export ORACLE_BASE=/u01/app/oracle</div><div class="line">export ORACLE_HOME=$ORACLE_BASE/product/12.2.0/dbhome_1</div><div class="line">export ORACLE_SID=orcl_1</div><div class="line">export PATH=$ORACLE_HOME/bin:/usr/sbin:$ORACLE_HOME/OPatch:$PATH</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib</div><div class="line">export NLS_LANG=AMERICAN_AMERICA.UTF8</div><div class="line">export LC_ALL=en_US.UTF-8</div></pre></td></tr></table></figure><p>在node02上，oracle用户</p><p>编辑<strong>/home/oracle/.bash_profile</strong>，添加如下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">export TMP=/tmp</div><div class="line">export ORACLE_BASE=/u01/app/oracle</div><div class="line">export ORACLE_HOME=$ORACLE_BASE/product/12.2.0/dbhome_1</div><div class="line">export ORACLE_SID=orcl_2</div><div class="line">export PATH=$ORACLE_HOME/bin:/usr/sbin:$ORACLE_HOME/OPatch:$PATH</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib</div><div class="line">export NLS_LANG=AMERICAN_AMERICA.UTF8</div><div class="line">export LC_ALL=en_US.UTF-8</div></pre></td></tr></table></figure><h3 id="配置SSH互信"><a href="#配置SSH互信" class="headerlink" title="配置SSH互信"></a>配置SSH互信</h3><p>在node01上，grid用户，分别为grid用户和oracle用户配置SSH互信。</p><p><strong><em>注：配置过程中需要输入grid和oracle用户的密码，请提前设置好</em></strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd /u01/app/12.2.0/grid/oui/prov/resources/scripts/</div><div class="line">./sshUserSetup.sh -hosts &quot;node01 node02&quot; -user grid  -advanced -noPromptPassphrase</div><div class="line">./sshUserSetup.sh -hosts &quot;node01 node02&quot; -user oracle  -advanced -noPromptPassphrase</div></pre></td></tr></table></figure><p>在node01上，grid用户，尝试登录node02验证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[grid@node01 ~]$ ssh node02 hostname</div><div class="line">node02.myCluster.com</div><div class="line">[grid@node01 ~]$ ssh node02-priv hostname</div><div class="line">node02.myCluster.com</div></pre></td></tr></table></figure><p>在node02上，grid用户，尝试登录node01验证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[grid@node02 ~]$ ssh node01 hostname</div><div class="line">node01.myCluster.com</div><div class="line">[grid@node02 ~]$ ssh node01-priv hostname</div><div class="line">node01.myCluster.com</div></pre></td></tr></table></figure><p>在node01上，oracle用户，尝试登录node02验证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[oracle@node01 ~]$ ssh node02 hostname</div><div class="line">node02.myCluster.com</div><div class="line">[oracle@node01 ~]$ ssh node02-priv hostname</div><div class="line">node02.myCluster.com</div></pre></td></tr></table></figure><p>在node02上，oracle用户，尝试登录node01验证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[oracle@node02 ~]$ ssh node01 hostname</div><div class="line">node01.myCluster.com</div><div class="line">[oracle@node02 ~]$ ssh node01-priv hostname</div><div class="line">node01.myCluster.com</div></pre></td></tr></table></figure><h3 id="配置存储"><a href="#配置存储" class="headerlink" title="配置存储"></a>配置存储</h3><p>在华为云控制台选购磁盘，共享模式选择共享，磁盘模式选择VBD(这里使用的是VBD的磁盘，使用oracleasm来配置共享磁盘)</p><h4 id="安装ASMLIB"><a href="#安装ASMLIB" class="headerlink" title="安装ASMLIB"></a>安装ASMLIB</h4><p>我这里操作系统用的是Centos 6.8，Centos 6系列和Redhat 6系列都可以按下面的方式安装，至于其他版本的下载连接，参考地址：<a href="http://www.oracle.com/technetwork/server-storage/linux/asmlib/index-101839.html?ssSourceSiteId=ocomen" target="_blank" rel="external">http://www.oracle.com/technetwork/server-storage/linux/asmlib/index-101839.html?ssSourceSiteId=ocomen</a></p><p><strong><em>注：以下操作需要在node01和node02两个节点上操作</em></strong></p><p>#####下载相关软件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# wget http://oss.oracle.com/projects/oracleasm-support/dist/files/RPMS/rhel6/amd64/2.1.8/oracleasm-support-2.1.8-1.el6.x86_64.rpm</div><div class="line">[root@node01 ~]# wget http://download.oracle.com/otn_software/asmlib/oracleasmlib-2.0.4-1.el6.x86_64.rpm</div></pre></td></tr></table></figure><p>#####使用yum自动安装相关依赖</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# yum install oracleasm</div></pre></td></tr></table></figure><p>#####使用yum本地安装下载好的两个安装包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# yum localinstall oracleasmlib-2.0.4-1.el6.x86_64.rpm</div><div class="line">[root@node01 ~]# yum localinstall oracleasm-support-2.1.8-1.el6.x86_64.rpm</div></pre></td></tr></table></figure><p>#####配置oracleasm服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# oracleasm configure -i</div><div class="line">Configuring the Oracle ASM library driver.</div><div class="line">This will configure the on-boot properties of the Oracle ASM library</div><div class="line">driver.  The following questions will determine whether the driver is</div><div class="line">loaded on boot and what permissions it will have.  The current values</div><div class="line">will be shown in brackets ('[]').  Hitting &lt;ENTER&gt; without typing an</div><div class="line">answer will keep that current value.  Ctrl-C will abort.</div><div class="line">Default user to own the driver interface []: grid</div><div class="line">Default group to own the driver interface []: asmadmin</div><div class="line">Start Oracle ASM library driver on boot (y/n) [n]: y</div><div class="line">Scan for Oracle ASM disks on boot (y/n) [y]: y</div><div class="line">Writing Oracle ASM library driver configuration: done</div></pre></td></tr></table></figure><h5 id="启动oracleasm"><a href="#启动oracleasm" class="headerlink" title="启动oracleasm"></a>启动oracleasm</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# /etc/init.d/oracleasm enable</div></pre></td></tr></table></figure><h4 id="创建分区"><a href="#创建分区" class="headerlink" title="创建分区"></a>创建分区</h4><p><strong><em>注：</em></strong></p><ul><li><strong><em>我的共享磁盘挂载点为/dev/xvdc</em></strong></li><li><strong><em>OCR_VOT_GIMR磁盘组和DATA磁盘组的冗余类型都选择为External</em></strong></li><li><strong><em>/dev/sdb共100G空间，创建1个40G分区分配给OCR_VOT_GIMR磁盘组使用，创建一个60G分区分配至DATA磁盘组</em></strong></li><li><em>*</em>ASM磁盘要求参考<a href="https://docs.oracle.com/database/122/CWLIN/oracle-clusterware-storage-space-requirements.htm#CWLIN-GUID-97FD5D40-A65B-4575-AD12-06C491AF3F41" target="_blank" rel="external">官方文档</a></li></ul><p>在node01上执行，仅分区即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# fdisk /dev/xvdc</div><div class="line">Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel</div><div class="line">Building a new DOS disklabel with disk identifier 0x3c07d9cd.</div><div class="line">Changes will remain in memory only, until you decide to write them.</div><div class="line">After that, of course, the previous content won't be recoverable.</div><div class="line">Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)</div><div class="line">WARNING: DOS-compatible mode is deprecated. It's strongly recommended to</div><div class="line">         switch off the mode (command 'c') and change display units to</div><div class="line">         sectors (command 'u').</div><div class="line">Command (m for help): n</div><div class="line">Command action</div><div class="line">   e   extended</div><div class="line">   p   primary partition (1-4)</div><div class="line">p</div><div class="line">Partition number (1-4): 1</div><div class="line">First cylinder (1-13054, default 1):</div><div class="line">Using default value 1</div><div class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1-13054, default 13054): +40G</div><div class="line">Command (m for help): n</div><div class="line">Command action</div><div class="line">   e   extended</div><div class="line">   p   primary partition (1-4)</div><div class="line">p</div><div class="line">Partition number (1-4): 2</div><div class="line">First cylinder (5224-13054, default 5224):</div><div class="line">Using default value 5224</div><div class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (5224-13054, default 13054):</div><div class="line">Using default value 13054</div><div class="line">Command (m for help): w</div><div class="line">The partition table has been altered!</div><div class="line">Calling ioctl() to re-read partition table.</div><div class="line">Syncing disks.</div></pre></td></tr></table></figure><p>分区结果如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# fdisk -l /dev/xvdc</div><div class="line">Disk /dev/xvdc: 107.4 GB, 107374182400 bytes</div><div class="line">255 heads, 63 sectors/track, 13054 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x3c07d9cd</div><div class="line">    Device Boot      Start         End      Blocks   Id  System</div><div class="line">/dev/xvdc1               1        5223    41953716   83  Linux</div><div class="line">/dev/xvdc2            5224       13054    62902507+  83  Linux</div></pre></td></tr></table></figure><h4 id="创建磁盘组"><a href="#创建磁盘组" class="headerlink" title="创建磁盘组"></a>创建磁盘组</h4><p>node01执行如下命令创建磁盘组：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# oracleasm createdisk OCR_VOT_GIMR /dev/xvdc1</div><div class="line">Writing disk header: done</div><div class="line">Instantiating disk: done</div><div class="line">[root@node01 ~]# oracleasm createdisk DATA /dev/xvdc2</div><div class="line">Writing disk header: done</div><div class="line">Instantiating disk: done</div></pre></td></tr></table></figure><p>使用<code>oracleasm listdisks</code>查看已创建的磁盘组，如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# oracleasm listdisks</div><div class="line">DATA</div><div class="line">OCR_VOT_GIMR</div></pre></td></tr></table></figure><p>在node02上扫描node01上创建的磁盘组，如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@node02 ~]# oracleasm scandisks</div><div class="line">Reloading disk partitions: done</div><div class="line">Cleaning any stale ASM disks...</div><div class="line">Scanning system for ASM disks...</div><div class="line">Instantiating disk "OCR_VOT_GIMR"</div><div class="line">Instantiating disk "DATA"</div></pre></td></tr></table></figure><p>使用<code>oracleasm listdisks</code>查看扫描到的磁盘组，如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@node02 ~]# oracleasm listdisks</div><div class="line">DATA</div><div class="line">OCR_VOT_GIMR</div></pre></td></tr></table></figure><p>至此，安装环境准备完成。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;网络&quot;&gt;&lt;a href=&quot;#网络&quot; class=&quot;headerlink&quot; title=&quot;网络&quot;&gt;&lt;/a&gt;网络&lt;/h3&gt;&lt;h4 id=&quot;网卡分配&quot;&gt;&lt;a href=&quot;#网卡分配&quot; class=&quot;headerlink&quot; title=&quot;网卡分配&quot;&gt;&lt;/a&gt;网卡分配&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;网卡名&lt;/th&gt;
&lt;th&gt;作用&lt;/th&gt;
&lt;th&gt;网段&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;eth0&lt;/td&gt;
&lt;td&gt;Public IP&lt;/td&gt;
&lt;td&gt;192.168.1.0/24&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;eth1&lt;/td&gt;
&lt;td&gt;NET IP&lt;/td&gt;
&lt;td&gt;192.168.2.0/24&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;eth2&lt;/td&gt;
&lt;td&gt;Private IP&lt;/td&gt;
&lt;td&gt;192.168.6.0/24&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;这里我用了三块网卡：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;eth0做Public IP的网卡，同时会绑定Virtual IP 和 SCAN IP&lt;/li&gt;
&lt;li&gt;eth1做NET IP的网卡，用来提供访问互联网的服务&lt;/li&gt;
&lt;li&gt;eth2做Private的网卡，用来做节点之间的数据交互&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="oracle" scheme="https://shijieqin.github.io/categories/oracle/"/>
    
      <category term="rac" scheme="https://shijieqin.github.io/categories/oracle/rac/"/>
    
    
      <category term="oracle" scheme="https://shijieqin.github.io/tags/oracle/"/>
    
      <category term="rac" scheme="https://shijieqin.github.io/tags/rac/"/>
    
  </entry>
  
  <entry>
    <title>Performing RMAN Recovery</title>
    <link href="https://shijieqin.github.io/2017/11/17/Performing-RMAN-Recovery/"/>
    <id>https://shijieqin.github.io/2017/11/17/Performing-RMAN-Recovery/</id>
    <published>2017-11-17T03:14:10.000Z</published>
    <updated>2017-11-17T03:14:10.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="安装数据库软件-不需要安装实例"><a href="#安装数据库软件-不需要安装实例" class="headerlink" title="安装数据库软件(不需要安装实例)"></a>安装数据库软件(不需要安装实例)</h3><p>略</p><h3 id="创建对应路径-与原库路径一致"><a href="#创建对应路径-与原库路径一致" class="headerlink" title="创建对应路径(与原库路径一致)"></a>创建对应路径(与原库路径一致)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">mkdir -p /u01/app/oracle/oradata/TEST</div><div class="line">mkdir -p /u01/app/oracle/fast_recovery_area</div><div class="line">mkdir -p /u01/app/oracle/admin/TEST</div><div class="line">mkdir /u01/app/oracle/admin/TEST/adump</div><div class="line">mkdir /u01/app/oracle/admin/TEST/bdump</div><div class="line">mkdir /u01/app/oracle/admin/TEST/cdump</div><div class="line">mkdir /u01/app/oracle/admin/TEST/ddump</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/19A9B2E4ED836CFCE0537680A8C03E8F/DATAFILE</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/1A325228C22837A9E0537680A8C0AB5A/DATAFILE</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/BCG/DATAFILE</div><div class="line">mkdir /u01/app/oracle/oradata/TEST/CONTROLFILE</div><div class="line">mkdir /u01/app/oracle/oradata/TEST/DATAFILE</div></pre></td></tr></table></figure><h3 id="开始恢复"><a href="#开始恢复" class="headerlink" title="开始恢复"></a>开始恢复</h3><a id="more"></a><p>rman target / nocatalog</p><h4 id="设置DBID"><a href="#设置DBID" class="headerlink" title="设置DBID"></a>设置DBID</h4><p>可通过原库查询，也可通过控制文件的备份名称获得(备份名称c-DBID-date-num.bak)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SET</span> DBID <span class="number">999753383</span>;</div></pre></td></tr></table></figure><h4 id="恢复spfile-和-pfile"><a href="#恢复spfile-和-pfile" class="headerlink" title="恢复spfile 和 pfile"></a>恢复spfile 和 pfile</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">STARTUP NOMOUNT;</div><div class="line"><span class="keyword">RESTORE</span> <span class="keyword">SPFILE</span> <span class="keyword">FROM</span> <span class="string">'/u01/rmanbak/c-999753383-20170925-00.bak'</span>;</div><div class="line"><span class="keyword">RESTORE</span> <span class="keyword">SPFILE</span> <span class="keyword">TO</span> PFILE <span class="string">'/u01/app/oracle/product/12.1.0/dbhome_1/dbs/initTEST.ora'</span> <span class="keyword">FROM</span> <span class="string">'/u01/rmanbak/c-999753383-20170925-00.bak'</span>;</div></pre></td></tr></table></figure><h4 id="结合当前服务器的配置信息修改pfile文件"><a href="#结合当前服务器的配置信息修改pfile文件" class="headerlink" title="结合当前服务器的配置信息修改pfile文件"></a>结合当前服务器的配置信息修改pfile文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">TEST.__data_transfer_cache_size=0</div><div class="line">TEST.__db_cache_size=1010827260</div><div class="line">TEST.__java_pool_size=20971520</div><div class="line">TEST.__large_pool_size=8388608</div><div class="line">TEST.__oracle_base=&apos;/u01/app/oracle&apos;#ORACLE_BASE set from environment</div><div class="line">TEST.__pga_aggregate_target=289406976</div><div class="line">TEST.__sga_target=1333788670</div><div class="line">TEST.__shared_io_pool_size=46137344</div><div class="line">TEST.__shared_pool_size=234881024</div><div class="line">TEST.__streams_pool_size=8388608</div><div class="line">*.audit_file_dest=&apos;/u01/app/oracle/admin/TEST/adump&apos;</div><div class="line">*.audit_trail=&apos;db&apos;</div><div class="line">*.compatible=&apos;12.1.0.2.0&apos;</div><div class="line">*.control_files=&apos;/u01/app/oracle/oradata/TEST/CONTROLFILE/current.257.883692833&apos;,&apos;/u01/app/oracle/oradata/TEST/CONTROLFILE/current.258.883692835&apos;</div><div class="line">*.db_block_size=32768</div><div class="line">*.db_domain=&apos;&apos;</div><div class="line">*.db_name=&apos;TEST&apos;</div><div class="line">*.db_recovery_file_dest_size=30g</div><div class="line">*.diagnostic_dest=&apos;/u01/app/oracle&apos;</div><div class="line">*.dispatchers=&apos;(PROTOCOL=TCP) (SERVICE=TESTXDB)&apos;</div><div class="line">*.enable_pluggable_database=true</div><div class="line">*.open_cursors=300</div><div class="line">*.pga_aggregate_target=1310m</div><div class="line">*.processes=1500</div><div class="line">*.remote_login_passwordfile=&apos;exclusive&apos;</div><div class="line">*.resource_manager_plan=&apos;&apos;</div><div class="line">*.sga_target=5242m</div></pre></td></tr></table></figure><h4 id="使用pfile文件启动数据库到NOMOUNT状态"><a href="#使用pfile文件启动数据库到NOMOUNT状态" class="headerlink" title="使用pfile文件启动数据库到NOMOUNT状态"></a>使用pfile文件启动数据库到NOMOUNT状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">STARTUP FORCE NOMOUNT PFILE=&apos;/u01/app/oracle/product/12.1.0/dbhome_1/dbs/initTEST.ora&apos;;</div></pre></td></tr></table></figure><h4 id="恢复控制文件"><a href="#恢复控制文件" class="headerlink" title="恢复控制文件"></a>恢复控制文件</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">RESTORE</span> <span class="keyword">CONTROLFILE</span> <span class="keyword">FROM</span> <span class="string">'/u01/rmanbak/c-999753383-20170925-00.bak'</span>;</div></pre></td></tr></table></figure><h4 id="切换数据库为MOUNT状态"><a href="#切换数据库为MOUNT状态" class="headerlink" title="切换数据库为MOUNT状态"></a>切换数据库为MOUNT状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sql &apos;alter database mount&apos;;</div></pre></td></tr></table></figure><h4 id="执行恢复"><a href="#执行恢复" class="headerlink" title="执行恢复"></a>执行恢复</h4><p>以下之所以rename，因为新库的数据文件路径发生改变，所以需要rename，可通过再rman中执行report schema查看所有的数据文件名和文件编号</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div></pre></td><td class="code"><pre><div class="line">CATALOG <span class="keyword">START</span> <span class="keyword">WITH</span> <span class="string">'/u01/rmanbak'</span>;</div><div class="line">RUN</div><div class="line">&#123;</div><div class="line">  ALLOCATE CHANNEL c1 TYPE DISK;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">1</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/DATAFILE/system.263.883692841'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">2</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/19A9B2E4ED836CFCE0537680A8C03E8F/DATAFILE/system.264.883692851'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">3</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/DATAFILE/sysaux.265.883692857'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">4</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/19A9B2E4ED836CFCE0537680A8C03E8F/DATAFILE/sysaux.266.883692865'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">5</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/DATAFILE/undotbs1.267.883692869'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">6</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/DATAFILE/undotbs2.270.883692925'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">7</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/DATAFILE/users.271.883692927'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">15</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1A325228C22837A9E0537680A8C0AB5A/DATAFILE/system.282.884366019'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">16</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1A325228C22837A9E0537680A8C0AB5A/DATAFILE/sysaux.281.884366019'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">20</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1A325228C22837A9E0537680A8C0AB5A/DATAFILE/fcprod_01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">21</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1A325228C22837A9E0537680A8C0AB5A/DATAFILE/fcprod_02.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">22</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE/system.288.885650835'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">23</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE/sysaux.289.885650835'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">24</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE/sugontra_01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">25</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE/sugontra_02.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">33</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE/sgtread.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">38</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/system.365.897157457'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">39</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sysaux.376.897157457'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">42</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/system.886.898112773'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">43</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/sysaux.896.898112773'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">44</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/absenpro_01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">45</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/absenpro_02.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">50</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">51</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_02.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">63</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_data.2127.902684869'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">64</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/system.4371.904906001'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">65</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/sysaux.4372.904906011'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">66</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4376.904906531'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">67</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4377.904906561'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">68</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4378.904906591'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">69</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4379.904906621'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">70</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4380.904906651'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">71</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4381.904906683'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">72</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4382.904906713'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">73</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4383.904906741'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">74</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4384.904906771'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">75</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/system.9415.906672919'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">76</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/sysaux.11560.906672919'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">77</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">78</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_02.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">79</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_03.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">80</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_03.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">81</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_04.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">82</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_05.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">83</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_06.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">84</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_04.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">85</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/absenpro_03.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">86</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_10.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">87</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_data_6.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">88</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_7.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">89</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_11.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">90</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_8.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">91</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_9.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">92</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_12.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">93</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_10.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">94</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_11.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">95</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_12.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">96</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_13.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">116</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_13.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">117</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_14.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">118</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_15.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">119</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_16.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">120</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_14.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">121</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/system.6863.913669707'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">122</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/sysaux.6861.913669707'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">123</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/shacpro_01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">124</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/shacpro_02.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">125</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/shacpro_03.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">126</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/shacpro_04.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">127</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/shacpro_05.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">128</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_15.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">129</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_17.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">130</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_data_7.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">131</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_18.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">132</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_19.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">133</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_16.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">134</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_20.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">135</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_21.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">136</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_17.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">137</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/absenpro_data_4.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">142</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/absenpro_data_5.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">147</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_data_8.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">149</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_18.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">150</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_19.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">151</span> <span class="keyword">TO</span><span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_22.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">152</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_data_9.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">153</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_23.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">154</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/absenpro_data_6.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">155</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_24.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">156</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/shacpro_06.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">157</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_25.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">169</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/system01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">170</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/sysaux01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">171</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">172</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_02.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">173</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_03.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">174</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_04.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">175</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_05.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">176</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_06.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">177</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_07.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">178</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_08.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">179</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_09.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">180</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_26.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">181</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/shacpro_07.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">1</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/TEMPFILE/temp.268.883692873'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">2</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/19A9B2E4ED836CFCE0537680A8C03E8F/TEMPFILE/temp.269.883692873'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">3</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_temp.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">4</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1A325228C22837A9E0537680A8C0AB5A/TEMPFILE/temp.283.884366053'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">5</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1A325228C22837A9E0537680A8C0AB5A/DATAFILE/fcprod_temp.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">6</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/TEMPFILE/temp.290.885650869'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">7</span>     <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE/sugontra_temp.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">8</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/TEMPFILE/temp.9418.906672955'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">9</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_temp.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">10</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE/sgtread_temp.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">11</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/temp01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">13</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/TEMPFILE/temp.462.897157491'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">14</span>    <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_temp.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">15</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/TEMPFILE/temp.898.898112805'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">16</span>    <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/absenpro_temp.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">19</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_temp_01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">20</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/TEMPFILE/temp.6857.913669745'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">21</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/shacpro_temp.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">25</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/temp001.dbf'</span>;</div><div class="line">  <span class="keyword">RESTORE</span> <span class="keyword">DATABASE</span>;</div><div class="line">  switch DATAFILE all;</div><div class="line">  switch tempfile all;</div><div class="line">  RECOVER DATABASE;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>由于归档日志缺失，只能部分恢复数据库，也就是只能恢复到rman备份的那一刻，根据报错显示的SCN号，恢复到指定SCN</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">RECOVER DATABASE UNTIL SCN 10144773006017;</div></pre></td></tr></table></figure><h4 id="根据pfile创建spfile"><a href="#根据pfile创建spfile" class="headerlink" title="根据pfile创建spfile"></a>根据pfile创建spfile</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Create</span> <span class="keyword">spfile</span> <span class="keyword">from</span> pfile=<span class="string">'/u01/app/oracle/product/12.1.0/dbhome_1/dbs/initTEST.ora'</span>;</div></pre></td></tr></table></figure><h4 id="修改日志文件路径"><a href="#修改日志文件路径" class="headerlink" title="修改日志文件路径"></a>修改日志文件路径</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">member</span> <span class="keyword">from</span> v$<span class="keyword">logfile</span>;</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/ONLINELOG;</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/STANDBYLOG;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/ONLINELOG/group1.259.883692835'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/ONLINELOG/group1.259.883692835'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/ONLINELOG/group1.260.883692837'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/ONLINELOG/group1.260.883692837'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/ONLINELOG/group2.261.883692837'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/ONLINELOG/group2.261.883692837'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/ONLINELOG/group2.262.883692839'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/ONLINELOG/group2.262.883692839'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/ONLINELOG/group3.272.883704715'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/ONLINELOG/group3.272.883704715'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/ONLINELOG/group3.273.883704717'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/ONLINELOG/group3.273.883704717'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/ONLINELOG/group4.274.883704719'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/ONLINELOG/group4.274.883704719'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/ONLINELOG/group4.275.883704721'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/ONLINELOG/group4.275.883704721'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/STANDBYLOG/standby_group11.log'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/STANDBYLOG/standby_group11.log'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/STANDBYLOG/standby_group12.log'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/STANDBYLOG/standby_group12.log'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/STANDBYLOG/standby_group13.log'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/STANDBYLOG/standby_group13.log'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/STANDBYLOG/standby_group14.log'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/STANDBYLOG/standby_group14.log'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/STANDBYLOG/standby_group15.log'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/STANDBYLOG/standby_group15.log'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/STANDBYLOG/standby_group16.log'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/STANDBYLOG/standby_group16.log'</span>;</div></pre></td></tr></table></figure><h4 id="启动数据库"><a href="#启动数据库" class="headerlink" title="启动数据库"></a>启动数据库</h4><p>由于修改了数据库日志路径，第一次启动需要resetlogs</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">open</span> <span class="keyword">resetlogs</span>;</div></pre></td></tr></table></figure><h3 id="创建lisenter"><a href="#创建lisenter" class="headerlink" title="创建lisenter"></a>创建lisenter</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">netca /silent /responsefile /u01/software/database/response/netca.rsp</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;安装数据库软件-不需要安装实例&quot;&gt;&lt;a href=&quot;#安装数据库软件-不需要安装实例&quot; class=&quot;headerlink&quot; title=&quot;安装数据库软件(不需要安装实例)&quot;&gt;&lt;/a&gt;安装数据库软件(不需要安装实例)&lt;/h3&gt;&lt;p&gt;略&lt;/p&gt;
&lt;h3 id=&quot;创建对应路径-与原库路径一致&quot;&gt;&lt;a href=&quot;#创建对应路径-与原库路径一致&quot; class=&quot;headerlink&quot; title=&quot;创建对应路径(与原库路径一致)&quot;&gt;&lt;/a&gt;创建对应路径(与原库路径一致)&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/fast_recovery_area&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/admin/TEST&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir /u01/app/oracle/admin/TEST/adump&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir /u01/app/oracle/admin/TEST/bdump&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir /u01/app/oracle/admin/TEST/cdump&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir /u01/app/oracle/admin/TEST/ddump&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/19A9B2E4ED836CFCE0537680A8C03E8F/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/1A325228C22837A9E0537680A8C0AB5A/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/BCG/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir /u01/app/oracle/oradata/TEST/CONTROLFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir /u01/app/oracle/oradata/TEST/DATAFILE&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;开始恢复&quot;&gt;&lt;a href=&quot;#开始恢复&quot; class=&quot;headerlink&quot; title=&quot;开始恢复&quot;&gt;&lt;/a&gt;开始恢复&lt;/h3&gt;
    
    </summary>
    
      <category term="oracle" scheme="https://shijieqin.github.io/categories/oracle/"/>
    
      <category term="rman" scheme="https://shijieqin.github.io/categories/oracle/rman/"/>
    
    
      <category term="oracle" scheme="https://shijieqin.github.io/tags/oracle/"/>
    
      <category term="rman" scheme="https://shijieqin.github.io/tags/rman/"/>
    
  </entry>
  
  <entry>
    <title>rebuild oracle password file</title>
    <link href="https://shijieqin.github.io/2017/10/19/rebuild-oracle-password-file/"/>
    <id>https://shijieqin.github.io/2017/10/19/rebuild-oracle-password-file/</id>
    <published>2017-10-19T07:47:40.000Z</published>
    <updated>2017-10-19T07:47:40.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h3><p>之前通过rman将一台生产库恢复到了另外一台服务器上。今天使用sys用户连接数据库时，一直报用户名密码错误，后台通过<strong>sys / as sysdba</strong>登录服务器之后，使用<strong>alter user sys identified by newpassword</strong>修改密码之后依然不能使用密码登录数据库，因此才有如下解决方式。</p><a id="more"></a><p>原因是因为数据库回复后并没有生成对应的密码文件，因此sys用户无法作为sysdba登录，在开始之前需要先检查数据库的<strong>remote_login_passwordfile</strong>参数为<strong>exclusive</strong>，这也是oracle数据库的默认值。</p><p>检查方式如下：</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; show parameter remote_login_passwordfile</div></pre></td></tr></table></figure><p>VALUE值为<strong>EXCLUSIVE</strong>即可</p><p>关于密码文件：</p><ol><li>oracle官网解释说在用DBCA创建数据库对的时候会自动创建密码文件，所以用DBCA创建的数据库一般是没问题的，但是我这次是用rman恢复的实例，不知道是否我原库是RAC的原因，恢复完之后并没有密码文件</li><li>具有管理员权限的角色(<code>SYSDBA</code>, <code>SYSOPER</code>, <code>SYSBACKUP</code>, <code>SYSDG</code>, or <code>SYSKM</code>)都会通过密码文件进行验证，而不是通过数据库来进行验证，但前提是该用户在数据库中存在。</li><li>密码文件中保存的密码是区分大小写的</li><li>RAC的密码文件是保存在ASM磁盘中的</li></ol><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>重建密码文件即可，其中密码文件的路径为<strong>$ORACLE_HOME/dbs/orapw<em>$instance_name</em></strong></p><p>其中最后的文件名必须是<strong>orapw</strong>与<strong>instance_name</strong>拼接起来的名字，假设这里的instance_name为TEST</p><p>使用如下命令重建密码文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> orapwd file="$ORACLE_HOME/dbs/orapwTEST" password=testtest</div></pre></td></tr></table></figure><p>重建之后即可正常使用密码登录sys了，其中password指定的就是sys的密码</p><p>验证密码文件是否生效可登陆数据库后同若如下命令验证</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select * from v$pwfile_users;</div></pre></td></tr></table></figure><p>如果密码文件没生效，则查出的结果为空，如果密码生效了，则查出的是记录在密码文件中的用户，默认仅有SYS用户。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;起因&quot;&gt;&lt;a href=&quot;#起因&quot; class=&quot;headerlink&quot; title=&quot;起因&quot;&gt;&lt;/a&gt;起因&lt;/h3&gt;&lt;p&gt;之前通过rman将一台生产库恢复到了另外一台服务器上。今天使用sys用户连接数据库时，一直报用户名密码错误，后台通过&lt;strong&gt;sys / as sysdba&lt;/strong&gt;登录服务器之后，使用&lt;strong&gt;alter user sys identified by newpassword&lt;/strong&gt;修改密码之后依然不能使用密码登录数据库，因此才有如下解决方式。&lt;/p&gt;
    
    </summary>
    
      <category term="oracle" scheme="https://shijieqin.github.io/categories/oracle/"/>
    
    
      <category term="oracle" scheme="https://shijieqin.github.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>create LVM disk</title>
    <link href="https://shijieqin.github.io/2017/07/19/create-LVM-disk/"/>
    <id>https://shijieqin.github.io/2017/07/19/create-LVM-disk/</id>
    <published>2017-07-19T08:24:04.000Z</published>
    <updated>2017-07-19T08:24:04.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="创建物理分区"><a href="#创建物理分区" class="headerlink" title="创建物理分区"></a>创建物理分区</h3><h4 id="查看是否有未分区的磁盘"><a href="#查看是否有未分区的磁盘" class="headerlink" title="查看是否有未分区的磁盘"></a>查看是否有未分区的磁盘</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@srm-fs ~]# fdisk -l</div><div class="line">Disk /dev/xvda: 42.9 GB, 42949672960 bytes</div><div class="line">255 heads, 63 sectors/track, 5221 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x000d6814</div><div class="line">    Device Boot      Start         End      Blocks   Id  System</div><div class="line">/dev/xvda1               1         523     4194304   82  Linux swap / Solaris</div><div class="line">Partition 1 does not end on cylinder boundary.</div><div class="line">/dev/xvda2   *         523        5222    37747712   83  Linux</div><div class="line">Disk /dev/xvdb: 536.9 GB, 536870912000 bytes</div><div class="line">255 heads, 63 sectors/track, 65270 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x00000000</div><div class="line">Disk /dev/xvdc: 536.9 GB, 536870912000 bytes</div><div class="line">255 heads, 63 sectors/track, 65270 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x00000000</div></pre></td></tr></table></figure><p>发现有两个未使用的磁盘，这里以xvdb为例<br><a id="more"></a></p><h4 id="在磁盘xvdb上创建xvdb1分区"><a href="#在磁盘xvdb上创建xvdb1分区" class="headerlink" title="在磁盘xvdb上创建xvdb1分区"></a>在磁盘xvdb上创建xvdb1分区</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[root@srm-fs ~]# fdisk /dev/xvdb</div><div class="line">Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel</div><div class="line">Building a new DOS disklabel with disk identifier 0xf72f347d.</div><div class="line">Changes will remain in memory only, until you decide to write them.</div><div class="line">After that, of course, the previous content won&apos;t be recoverable.</div><div class="line">Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)</div><div class="line">WARNING: DOS-compatible mode is deprecated. It&apos;s strongly recommended to</div><div class="line">         switch off the mode (command &apos;c&apos;) and change display units to</div><div class="line">         sectors (command &apos;u&apos;).</div><div class="line">Command (m for help): n</div><div class="line">Command action</div><div class="line">   e   extended</div><div class="line">   p   primary partition (1-4)</div><div class="line">p</div><div class="line">Partition number (1-4): 1</div><div class="line">First cylinder (1-65270, default 1):</div><div class="line">Using default value 1</div><div class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1-65270, default 65270):</div><div class="line">Using default value 65270</div><div class="line">添加磁盘系统表id为8e(LVM的标识)</div><div class="line">Command (m for help): t</div><div class="line">Selected partition 1</div><div class="line">Hex code (type L to list codes): 8e</div><div class="line">Changed system type of partition 1 to 8e (Linux LVM)</div><div class="line">保存分区表</div><div class="line">Command (m for help): w</div><div class="line">The partition table has been altered!</div><div class="line">Calling ioctl() to re-read partition table.</div></pre></td></tr></table></figure><h3 id="将分区划分为物理卷，主要是添加LVM属性信息并划分PE存储单元"><a href="#将分区划分为物理卷，主要是添加LVM属性信息并划分PE存储单元" class="headerlink" title="将分区划分为物理卷，主要是添加LVM属性信息并划分PE存储单元."></a>将分区划分为物理卷，主要是添加LVM属性信息并划分PE存储单元.</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@srm-fs ~]# pvcreate /dev/xvdb1</div><div class="line">  Physical volume &quot;/dev/xvdb1&quot; successfully created</div><div class="line">[root@srm-fs ~]# pvs</div><div class="line">  PV         VG   Fmt  Attr PSize   PFree  </div><div class="line">  /dev/xvdb1      lvm2 a--  499.99g 499.99g</div><div class="line">[root@srm-fs ~]# pvdisplay</div><div class="line">  &quot;/dev/xvdb1&quot; is a new physical volume of &quot;499.99 GiB&quot;</div><div class="line">  --- NEW Physical volume ---</div><div class="line">  PV Name               /dev/xvdb1</div><div class="line">  VG Name               </div><div class="line">  PV Size               499.99 GiB</div><div class="line">  Allocatable           NO</div><div class="line">  PE Size               0   </div><div class="line">  Total PE              0</div><div class="line">  Free PE               0</div><div class="line">  Allocated PE          0</div><div class="line">  PV UUID               5KBToI-5jzg-P0ra-kdZO-3bt2-MRS2-Hbbjk3</div></pre></td></tr></table></figure><h3 id="创建卷组vg-atm-并将分区xvdb1加入卷组"><a href="#创建卷组vg-atm-并将分区xvdb1加入卷组" class="headerlink" title="创建卷组vg-atm, 并将分区xvdb1加入卷组"></a>创建卷组vg-atm, 并将分区xvdb1加入卷组</h3><p>其中PE为卷组的最小存储单元，可通过-s命令修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@srm-fs ~]# vgcreate vg-atm /dev/xvdb1</div><div class="line">  Volume group &quot;vg-atm&quot; successfully created</div><div class="line">[root@srm-fs ~]# vgs</div><div class="line">  VG     #PV #LV #SN Attr   VSize   VFree  </div><div class="line">  vg-atm   1   0   0 wz--n- 499.99g 499.99g</div><div class="line">[root@srm-fs ~]# vgdisplay</div><div class="line">  --- Volume group ---</div><div class="line">  VG Name               vg-atm</div><div class="line">  System ID             </div><div class="line">  Format                lvm2</div><div class="line">  Metadata Areas        1</div><div class="line">  Metadata Sequence No  1</div><div class="line">  VG Access             read/write</div><div class="line">  VG Status             resizable</div><div class="line">  MAX LV                0</div><div class="line">  Cur LV                0</div><div class="line">  Open LV               0</div><div class="line">  Max PV                0</div><div class="line">  Cur PV                1</div><div class="line">  Act PV                1</div><div class="line">  VG Size               499.99 GiB</div><div class="line">  PE Size               4.00 MiB</div><div class="line">  Total PE              127998</div><div class="line">  Alloc PE / Size       0 / 0   </div><div class="line">  Free  PE / Size       127998 / 499.99 GiB</div><div class="line">  VG UUID               8Enzk5-pm35-z6OQ-ee2v-RW4X-vp1n-00Z2Ua</div></pre></td></tr></table></figure></p><h4 id="从vg-atm卷组创建逻辑分区lv-atm1"><a href="#从vg-atm卷组创建逻辑分区lv-atm1" class="headerlink" title="从vg-atm卷组创建逻辑分区lv-atm1"></a>从vg-atm卷组创建逻辑分区lv-atm1</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@srm-fs ~]# lvcreate -l 127998 -n lv-atm1 vg-atm</div><div class="line">  Logical volume &quot;lv-atm1&quot; created</div><div class="line">其中，指定创建的逻辑分区大小有两种方式:</div><div class="line">-L 后面指定大小(e.g. 499G)不能超过卷组的free size，可通过vgdisplay查看</div><div class="line">-l 后面指定PE大小(e.g. 127998)不能超过卷组的free PE大小，可通过vgdisplay查看</div><div class="line">[root@srm-fs ~]# lvs</div><div class="line">  LV      VG     Attr       LSize   Pool Origin Data%  Move Log Cpy%Sync Convert</div><div class="line">  lv-atm1 vg-atm -wi-a----- 499.99g</div><div class="line"></div><div class="line">[root@srm-fs ~]# lvdisplay</div><div class="line">  --- Logical volume ---</div><div class="line">  LV Path                /dev/vg-atm/lv-atm1</div><div class="line">  LV Name                lv-atm1</div><div class="line">  VG Name                vg-atm</div><div class="line">  LV UUID                U8nc8o-aa2p-NeNw-JMie-mjoh-eRfo-wKdQuS</div><div class="line">  LV Write Access        read/write</div><div class="line">  LV Creation host, time srm-fs, 2017-06-07 10:42:57 +0800</div><div class="line">  LV Status              available</div><div class="line">  # open                 0</div><div class="line">  LV Size                499.99 GiB</div><div class="line">  Current LE             127998</div><div class="line">  Segments               1</div><div class="line">  Allocation             inherit</div><div class="line">  Read ahead sectors     auto</div><div class="line">  - currently set to     256</div><div class="line">  Block device           253:0</div></pre></td></tr></table></figure><h3 id="在逻辑分区lv-atm上创建文件系统"><a href="#在逻辑分区lv-atm上创建文件系统" class="headerlink" title="在逻辑分区lv-atm上创建文件系统"></a>在逻辑分区lv-atm上创建文件系统</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@srm-fs ~]# mkfs.ext4 /dev/vg-atm/lv-atm1</div><div class="line">mke2fs 1.41.12 (17-May-2010)</div><div class="line">Filesystem label=</div><div class="line">OS type: Linux</div><div class="line">Block size=4096 (log=2)</div><div class="line">Fragment size=4096 (log=2)</div><div class="line">Stride=0 blocks, Stripe width=0 blocks</div><div class="line">32768000 inodes, 131069952 blocks</div><div class="line">6553497 blocks (5.00%) reserved for the super user</div><div class="line">First data block=0</div><div class="line">Maximum filesystem blocks=4294967296</div><div class="line">4000 block groups</div><div class="line">32768 blocks per group, 32768 fragments per group</div><div class="line">8192 inodes per group</div><div class="line">Superblock backups stored on blocks:</div><div class="line">32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,</div><div class="line">4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968,</div><div class="line">102400000</div><div class="line">Writing inode tables: done                            </div><div class="line">Creating journal (32768 blocks): done</div><div class="line">Writing superblocks and filesystem accounting information: done</div><div class="line">This filesystem will be automatically checked every 25 mounts or</div><div class="line">180 days, whichever comes first.  Use tune2fs -c or -i to override.</div></pre></td></tr></table></figure><h3 id="挂载文件系统"><a href="#挂载文件系统" class="headerlink" title="挂载文件系统"></a>挂载文件系统</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@srm-fs ~]# mount /dev/vg-atm/lv-atm1 /u01</div><div class="line">[root@srm-fs ~]# df -h</div><div class="line">Filesystem                    Size  Used Avail Use% Mounted on</div><div class="line">/dev/xvda2                     36G  2.4G   32G   7% /</div><div class="line">tmpfs                         487M     0  487M   0% /dev/shm</div><div class="line">/dev/mapper/vg--atm-lv--atm1  493G  198M  467G   1% /u01</div><div class="line">[root@srm-fs ~]# mount | grep u01</div><div class="line">/dev/mapper/vg--atm-lv--atm1 on /u01 type ext4</div><div class="line">创建好之后,会在/dev/mapper/生成一个软连接名字为”卷组-逻辑卷”从上面的命令也可以看出来。</div><div class="line">[root@srm-fs ~]# ll /dev/vg-atm/lv-atm1</div><div class="line">lrwxrwxrwx 1 root root 7 Jun  7 13:32 /dev/vg-atm/lv-atm1 -&gt; ../dm-0</div></pre></td></tr></table></figure><h3 id="配置开机自动挂载"><a href="#配置开机自动挂载" class="headerlink" title="配置开机自动挂载"></a>配置开机自动挂载</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">查看新增分区的UUID</div><div class="line">[root@srm-fs ~]# blkid</div><div class="line">/dev/xvda1: UUID=&quot;25ec3bdb-ba24-4561-bcdc-802edf42b85f&quot; TYPE=&quot;swap&quot;</div><div class="line">/dev/xvda2: UUID=&quot;1a1ce4de-e56a-4e1f-864d-31b7d9dfb547&quot; TYPE=&quot;ext4&quot;</div><div class="line">/dev/xvdb1: UUID=&quot;5KBToI-5jzg-P0ra-kdZO-3bt2-MRS2-Hbbjk3&quot; TYPE=&quot;LVM2_member&quot;</div><div class="line">/dev/mapper/vg--atm-lv--atm1: UUID=&quot;eb80318b-480f-486c-8b7c-6093974139f8&quot; TYPE=&quot;ext4&quot;</div><div class="line">编辑/etc/fstab,添加如下内容</div><div class="line">UUID=eb80318b-480f-486c-8b7c-6093974139f8&quot; TYPE=&quot;ext4  /u01    ext4   defaults   1 1</div></pre></td></tr></table></figure><h3 id="添加新的物理分区至卷组vg-atm"><a href="#添加新的物理分区至卷组vg-atm" class="headerlink" title="添加新的物理分区至卷组vg-atm"></a>添加新的物理分区至卷组vg-atm</h3><p>同样需要先创建pv，具体步骤省略<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vgextend vg-atm /dev/xvdc1</div></pre></td></tr></table></figure></p><h3 id="扩展逻辑分区lv-atm"><a href="#扩展逻辑分区lv-atm" class="headerlink" title="扩展逻辑分区lv-atm"></a>扩展逻辑分区lv-atm</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">lvextend -L +500M /dev/vg-atm/lv-atm1</div><div class="line">路径为逻辑分区的路径，可通过lvdisplay查看</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;创建物理分区&quot;&gt;&lt;a href=&quot;#创建物理分区&quot; class=&quot;headerlink&quot; title=&quot;创建物理分区&quot;&gt;&lt;/a&gt;创建物理分区&lt;/h3&gt;&lt;h4 id=&quot;查看是否有未分区的磁盘&quot;&gt;&lt;a href=&quot;#查看是否有未分区的磁盘&quot; class=&quot;headerlink&quot; title=&quot;查看是否有未分区的磁盘&quot;&gt;&lt;/a&gt;查看是否有未分区的磁盘&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@srm-fs ~]# fdisk -l&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Disk /dev/xvda: 42.9 GB, 42949672960 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;255 heads, 63 sectors/track, 5221 cylinders&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Units = cylinders of 16065 * 512 = 8225280 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Sector size (logical/physical): 512 bytes / 512 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;I/O size (minimum/optimal): 512 bytes / 512 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Disk identifier: 0x000d6814&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    Device Boot      Start         End      Blocks   Id  System&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/dev/xvda1               1         523     4194304   82  Linux swap / Solaris&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Partition 1 does not end on cylinder boundary.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/dev/xvda2   *         523        5222    37747712   83  Linux&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Disk /dev/xvdb: 536.9 GB, 536870912000 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;255 heads, 63 sectors/track, 65270 cylinders&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Units = cylinders of 16065 * 512 = 8225280 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Sector size (logical/physical): 512 bytes / 512 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;I/O size (minimum/optimal): 512 bytes / 512 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Disk identifier: 0x00000000&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Disk /dev/xvdc: 536.9 GB, 536870912000 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;255 heads, 63 sectors/track, 65270 cylinders&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Units = cylinders of 16065 * 512 = 8225280 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Sector size (logical/physical): 512 bytes / 512 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;I/O size (minimum/optimal): 512 bytes / 512 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Disk identifier: 0x00000000&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;发现有两个未使用的磁盘，这里以xvdb为例&lt;br&gt;
    
    </summary>
    
      <category term="LINUX" scheme="https://shijieqin.github.io/categories/LINUX/"/>
    
      <category term="LVM" scheme="https://shijieqin.github.io/categories/LINUX/LVM/"/>
    
    
      <category term="LINUX" scheme="https://shijieqin.github.io/tags/LINUX/"/>
    
      <category term="LVM" scheme="https://shijieqin.github.io/tags/LVM/"/>
    
      <category term="DISK" scheme="https://shijieqin.github.io/tags/DISK/"/>
    
  </entry>
  
  <entry>
    <title>OpenVpn4Centos</title>
    <link href="https://shijieqin.github.io/2017/07/11/OpenVpn4Centos/"/>
    <id>https://shijieqin.github.io/2017/07/11/OpenVpn4Centos/</id>
    <published>2017-07-11T07:15:14.000Z</published>
    <updated>2017-07-11T07:15:14.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h3><ul><li>OpenVpn版本: 2.4.3  </li><li>Centos版本: 6.8  </li><li>本机IP: 192.168.5.3</li><li>实现功能：<ul><li>客户端需通过用户名密码登录</li><li>用户名密码为系统用户</li><li>不同用户分为不同网段</li><li>通过VPN服务器的iptables来限制不同网段的访问，间接限制用户<br>先实现证书登录，再实现用户名密码登录，也可以跳过证书登录的配置，直接实现用户名密码登录<a id="more"></a></li></ul></li></ul><table><thead><tr><th style="text-align:left">用户</th><th style="text-align:left">获得网段</th><th>可访问网段</th></tr></thead><tbody><tr><td style="text-align:left">普通用户</td><td style="text-align:left">10.0.2.0/24</td><td>192.168.3.0/24 192.168.4.0/24  192.168.5.0/24</td></tr><tr><td style="text-align:left">特殊用户</td><td style="text-align:left">10.0.1.0/24</td><td>192.168.0.0/24 192.168.1.0/24 192.168.5.0/24</td></tr><tr><td style="text-align:left">管理员</td><td style="text-align:left">10.0.0.0/24</td><td>192.168.0.0/16</td></tr></tbody></table><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><h4 id="安装epel库"><a href="#安装epel库" class="headerlink" title="安装epel库"></a>安装epel库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">wget http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm</div><div class="line">rpm -Uvh epel-release-6-8.noarch.rpm</div></pre></td></tr></table></figure><h4 id="安装openvpn"><a href="#安装openvpn" class="headerlink" title="安装openvpn"></a>安装openvpn</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install openvpn</div></pre></td></tr></table></figure><h4 id="安装easy-rs"><a href="#安装easy-rs" class="headerlink" title="安装easy-rs"></a>安装easy-rs</h4><p>该包用来制作ca证书，服务端证书，客户端证书。最新的为easy-rsa3<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wget https://github.com/OpenVPN/easy-rsa/archive/master.zip</div><div class="line">unzip master.zip</div><div class="line">mv easy-rsa-mater/ easy-rsa/</div><div class="line">cp -R easy-rsa/ /etc/openvpn/</div></pre></td></tr></table></figure></p><h4 id="编辑vars文件"><a href="#编辑vars文件" class="headerlink" title="编辑vars文件"></a>编辑vars文件</h4><ol><li><p>先进入/etc/openvpn/easy-rsa/easyrsa3目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd /etc/openvpn/easy-rsa/easyrsa3/</div></pre></td></tr></table></figure></li><li><p>复制vars.example 为vars</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp vars.example vars</div></pre></td></tr></table></figure></li><li><p>修改vars文件的如下字段</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">set_var EASYRSA_REQ_COUNTRY “CN” //根据自己情况更改</div><div class="line">set_var EASYRSA_REQ_PROVINCE “ShangHai”</div><div class="line">set_var EASYRSA_REQ_CITY “ShangHai”</div><div class="line">set_var EASYRSA_REQ_ORG “Test”</div><div class="line">set_var EASYRSA_REQ_EMAIL “test@test.com”</div><div class="line">set_var EASYRSA_REQ_OU “TestOpenVpn”</div></pre></td></tr></table></figure></li></ol><h4 id="初始化easyrsa"><a href="#初始化easyrsa" class="headerlink" title="初始化easyrsa"></a>初始化easyrsa</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /etc/openvpn/easy-rsa/easyrsa3/</div><div class="line">./easyrsa init-pki</div></pre></td></tr></table></figure><h4 id="创建CA-根-证书"><a href="#创建CA-根-证书" class="headerlink" title="创建CA(根)证书"></a>创建CA(根)证书</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">./easyrsa build-ca</div><div class="line"></div><div class="line">Generating a 2048 bit RSA private key</div><div class="line">…………………………………….+++</div><div class="line">……+++</div><div class="line"></div><div class="line">writing new private key to ‘/root/easy-rsa/easyrsa3/pki/private/ca.key’</div><div class="line">Enter PEM pass phrase:</div><div class="line">Verifying – Enter PEM pass phrase:</div><div class="line">—–</div><div class="line">You are about to be asked to enter information that will be incorporated</div><div class="line">into your certificate request.</div><div class="line">What you are about to enter is what is called a Distinguished Name or a DN.</div><div class="line">There are quite a few fields but you can leave some blank</div><div class="line">For some fields there will be a default value,</div><div class="line">If you enter ‘.’, the field will be left blank.</div><div class="line">—–</div><div class="line">Common Name (eg: your user, host, or server name) [Easy-RSA CA]:Test</div><div class="line">CA creation complete and you may now import and sign cert requests.</div><div class="line">Your new CA certificate file for publishing is at:</div><div class="line">/root/easy-rsa/easyrsa3/pki/ca.crt</div></pre></td></tr></table></figure><p>注意：在上述部分需要输入PEM密码 PEM pass phrase，输入两次，此密码必须记住，<br>不然以后不能为证书签名。还需要输入common name 通用名，这个你自己随便设置个独一无二的。</p><h4 id="创建服务器端证书"><a href="#创建服务器端证书" class="headerlink" title="创建服务器端证书"></a>创建服务器端证书</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">./easyrsa gen-req server nopass</div><div class="line"></div><div class="line"></div><div class="line">Generating a 2048 bit RSA private key</div><div class="line">……………………………………………………………………..+++</div><div class="line">……………………+++</div><div class="line">writing new private key to ‘/root/easy-rsa/easyrsa3/pki/private/server.key’</div><div class="line">—–</div><div class="line">You are about to be asked to enter information that will be incorporated</div><div class="line">into your certificate request.</div><div class="line">What you are about to enter is what is called a Distinguished Name or a DN.</div><div class="line">There are quite a few fields but you can leave some blank</div><div class="line">For some fields there will be a default value,</div><div class="line">If you enter ‘.’, the field will be left blank.</div><div class="line">—–</div><div class="line">Common Name (eg: your user, host, or server name) [server]:TestServer</div><div class="line">Keypair and certificate request completed. Your files are:</div><div class="line">req: /root/easy-rsa/easyrsa3/pki/reqs/server.req</div><div class="line">key: /root/easy-rsa/easyrsa3/pki/private/server.key</div></pre></td></tr></table></figure><p>该过程中需要输入common name，随意但是不要跟之前的根证书的一样</p><h4 id="签约服务端证书"><a href="#签约服务端证书" class="headerlink" title="签约服务端证书"></a>签约服务端证书</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">./easyrsa sign server server</div><div class="line"></div><div class="line"></div><div class="line">You are about to sign the following certificate.</div><div class="line">Please check over the details shown below for accuracy. Note that this request</div><div class="line">has not been cryptographically verified. Please be sure it came from a trusted</div><div class="line">source or that you have verified the request checksum with the sender.</div><div class="line">Request subject, to be signed as a server certificate for 3650 days:</div><div class="line">subject=</div><div class="line">commonName = TestServer</div><div class="line">Type the word ‘yes’ to continue, or any other input to abort.</div><div class="line">Confirm request details: yes</div><div class="line">Using configuration from /root/easy-rsa/easyrsa3/openssl-1.0.cnf</div><div class="line">Enter pass phrase for /root/easy-rsa/easyrsa3/pki/private/ca.key:</div><div class="line">Check that the request matches the signature</div><div class="line">Signature ok</div><div class="line">The Subject’s Distinguished Name is as follows</div><div class="line">commonName</div><div class="line">RINTABLE:’TestServer’</div><div class="line">Certificate is to be certified until Apr 20 06:02:10 2024 GMT (3650 days)</div><div class="line">Write out database with 1 new entries</div><div class="line">Data Base Updated</div><div class="line">Certificate created at: /root/easy-rsa/easyrsa3/pki/issued/server.crt</div></pre></td></tr></table></figure><p>该命令中.需要你确认生成，要输入yes，还需要你提供我们当时创建CA时候的密码。如果你忘记了密码，<br>那你就重头开始再来一次吧。</p><h4 id="创建Diffie-Hellman"><a href="#创建Diffie-Hellman" class="headerlink" title="创建Diffie-Hellman"></a>创建Diffie-Hellman</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">./easyrsa gen-dh</div><div class="line"></div><div class="line"></div><div class="line">Note: using Easy-RSA configuration from: ./vars</div><div class="line">Generating DH parameters, 2048 bit long safe prime, generator 2</div><div class="line">This is going to take a long time</div><div class="line">……..+……………………………….+..+…………………………………………………………………………………………………………………………….</div><div class="line">DH parameters of size 2048 created at /etc/openvpn/easy-rsa/easyrsa3/pki/dh.pem</div></pre></td></tr></table></figure><h4 id="创建客户端证书"><a href="#创建客户端证书" class="headerlink" title="创建客户端证书"></a>创建客户端证书</h4><p>以下是为了实现证书登录而做的操作。<br>为了避免与服务器端证书冲突，因此另外复制一份easyrsa到另一个文件夹下操作。<br>进入root目录新建client文件夹(也可以是任意目录，只要有权限访问)，文件夹可随意命名，<br>然后拷贝前面解压得到的easy-ras文件夹到client文件夹,进入下列目录,并初始化<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd /root/</div><div class="line">mkdir client</div><div class="line">cp -R easy-rsa/ client/</div><div class="line">cd client/easy-rsa/easyrsa3/</div><div class="line">./easyrsa init-pki</div></pre></td></tr></table></figure></p><ul><li><p>创建客户端key及生成证书（记住生成是自己输入的密码）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./easyrsa gen-req client (名字自定义)</div></pre></td></tr></table></figure></li><li><p>将的到的client.req导入然后签约证书</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd /etc/openvpn/easy-rsa/easyrsa3/</div><div class="line">./easyrsa import-req /root/client/easy-rsa/easyrsa3/pki/reqs/client.req client</div><div class="line">./easyrsa sign client client(后面这个为客户端证书的名字，前面的为固定格式)</div></pre></td></tr></table></figure></li></ul><p>过程跟签约server类似，需要输入CA证书的密码</p><h4 id="现在说一下我们上面都生成了什么东西"><a href="#现在说一下我们上面都生成了什么东西" class="headerlink" title="现在说一下我们上面都生成了什么东西"></a>现在说一下我们上面都生成了什么东西</h4><p>服务端：(/cetc/openvpn/easy-rsa/文件夹)</p><ul><li>/etc/openvpn/easy-rsa/easyrsa3/pki/ca.crt</li><li>/etc/openvpn/easy-rsa/easyrsa3/pki/reqs/server.req</li><li>/etc/openvpn/easy-rsa/easyrsa3/pki/reqs/client.req</li><li>/etc/openvpn/easy-rsa/easyrsa3/pki/private/ca.key</li><li>/etc/openvpn/easy-rsa/easyrsa3/pki/private/server.key</li><li>/etc/openvpn/easy-rsa/easyrsa3/pki/issued/server.crt</li><li>/etc/openvpn/easy-rsa/easyrsa3/pki/issued/client.crt</li><li>/etc/openvpn/easy-rsa/easyrsa3/pki/dh.pem</li></ul><p>客户端：(root/client/easy-rsa文件夹)</p><ul><li>/root/client/easy-rsa/easyrsa3/pki/private/client.key</li><li>/root/client/easy-rsa/easyrsa3/pki/reqs/client.req //这个文件被我们导入到了服务端,<pre><code>所以那里也有</code></pre><h4 id="将生成的证书拷贝到指定文件夹-etc-openvpn-keys"><a href="#将生成的证书拷贝到指定文件夹-etc-openvpn-keys" class="headerlink" title="将生成的证书拷贝到指定文件夹(/etc/openvpn/keys)"></a>将生成的证书拷贝到指定文件夹(/etc/openvpn/keys)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cp /etc/openvpn/easy-rsa/easyrsa3/pki/ca.crt /etc/openvpn/keys</div><div class="line">cp /etc/openvpn/easy-rsa/easyrsa3/pki/private/server.key /etc/openvpn/keys</div><div class="line">cp /etc/openvpn/easy-rsa/easyrsa3/pki/issued/server.crt /etc/openvpn/keys</div><div class="line">cp /etc/openvpn/easy-rsa/easyrsa3/pki/dh.pem /etc/openvpn/keys</div></pre></td></tr></table></figure></li></ul><h4 id="生成ta-key文件并移动到-etc-openvpn-keys"><a href="#生成ta-key文件并移动到-etc-openvpn-keys" class="headerlink" title="生成ta.key文件并移动到/etc/openvpn/keys"></a>生成ta.key文件并移动到/etc/openvpn/keys</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">openvpn --genkey --secret ta.key</div><div class="line">mv ta.key /etc/openvpn/keys</div></pre></td></tr></table></figure><h4 id="编辑server的配置文件"><a href="#编辑server的配置文件" class="headerlink" title="编辑server的配置文件"></a>编辑server的配置文件</h4><p>当你安装好了openvpn时候，他会提供一个server配置的文件例子，在<br>/usr/share/doc/openvpn-2.4.3/sample/sample-config-files<br>下会有一个server.conf文件，我们将这个文件复制到/etc/openvpn<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp /usr/share/doc/openvpn-2.4.3/sample/sample-config-files/server.conf /etc/openvpn</div></pre></td></tr></table></figure></p><p>修改配置文件为如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">local 192.168.5.3 #本地IP，既服务器的IP地址</div><div class="line">port 1194 #vpn端口</div><div class="line">proto udp #使用UDP协议，也可以选择tcp协议</div><div class="line">dev tun #相对应的tab，tab是桥接模式，tun为虚拟网卡模式</div><div class="line">ca /etc/openvpn/keys/ca.crt #ca证书</div><div class="line">cert /etc/openvpn/keys/server.crt #服务器端证书</div><div class="line">key /etc/openvpn/keys/server.key  #服务器端的key，需保密</div><div class="line">dh /etc/openvpn/keys/dh.pem #dh证书</div><div class="line">server 10.0.2.0 255.255.255.0 #普通vpn用户虚拟IP的网段</div><div class="line">ifconfig-pool-persist /etc/openvpn/ipp.txt #虚拟IP记录文件，防止重复分发IP</div><div class="line">push &quot;route 192.168.0.0 255.255.255.0&quot; #网客户端注入route规则，用来实现部分网段走vpn，</div><div class="line">                                        其他网段仍然走客户端电脑的默认链路</div><div class="line">push &quot;route 192.168.1.0 255.255.255.0&quot;</div><div class="line">push &quot;route 192.168.2.0 255.255.255.0&quot;</div><div class="line">push &quot;route 192.168.3.0 255.255.255.0&quot;</div><div class="line">push &quot;route 192.168.4.0 255.255.255.0&quot;</div><div class="line">push &quot;route 192.168.5.0 255.255.255.0&quot;</div><div class="line">client-config-dir /etc/openvpn/ccd #用户个性化配置目录，特殊用户与管理员用户</div><div class="line">                                    的网段就是通过这个文件夹下的配置实现的</div><div class="line">route 10.0.0.0 255.255.255.0 #添加本地route，将特殊用户与管理员用户</div><div class="line">                              的网段加入vpn服务器的路由表中</div><div class="line">route 10.0.1.0 255.255.255.0</div><div class="line">push &quot;dhcp-option DNS 114.114.114.114&quot; #为客户端电脑得到的虚拟IP推送DNS</div><div class="line">duplicate-cn #允许同一个证书或同一个用户同一时间多次登录</div><div class="line">keepalive 10 120 #客户端与服务器的心跳包，互相知道对方是否断开</div><div class="line">tls-auth /etc/openvpn/keys/ta.key 0 #ta证书，需保密</div><div class="line">cipher AES-256-CBC #加密规则</div><div class="line">comp-lzo #兼容旧的客户端</div><div class="line">max-clients 100 #客户端数量</div><div class="line">persist-key</div><div class="line">persist-tun</div><div class="line">status /etc/openvpn/logs/openvpn-status.log #日志文件</div><div class="line">log         /etc/openvpn/logs/openvpn.log #日志文件</div><div class="line">verb 3 #日志等级</div></pre></td></tr></table></figure><p>创建 /etc/openvpn/logs文件夹<br>创建 /etc/openvpn/ccd文件夹</p><h4 id="配置特殊用户的个性化配置"><a href="#配置特殊用户的个性化配置" class="headerlink" title="配置特殊用户的个性化配置"></a>配置特殊用户的个性化配置</h4><p>文件名必须与客户端证书名或者与下面即将配置的用户名密码登录的用户名一致，<br>一个用户一个对应的文件，如果没有，则按默认配置<br>这里假设client为特殊用户，既获得的网段在192.168.1.0/24。<br>需要创建client对应的客户端证书(如果使用用户名密码登录，需要创建对应用户)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">touch client</div><div class="line">vi client</div><div class="line"></div><div class="line">ifconfig-push 10.0.1.1 10.0.1.2</div><div class="line"># 这里是指定该用户的IP，既直接固定IP，而不是随机分配。暂时没找到指定IP段的方法。</div><div class="line">因此，通过固定IP的方式来达到特殊用户属于特殊网段</div><div class="line"># 这里指定的是一对IP，表示虚拟客户端和服务器的IP端点。</div><div class="line">它们必须从连续的/30子网网段中获取</div><div class="line">(这里是/30表示xxx.xxx.xxx.xxx/30，即子网掩码位数为30)，</div><div class="line">以便于与Windows客户端和TAP-Windows驱动兼容。暂时还没理解。</div><div class="line">明确地说，每个端点的IP地址对的最后8位字节必须取自下面的集合：</div><div class="line">[  1,  2]  [  5,  6]  [  9, 10]  [ 13, 14]</div><div class="line">[ 17, 18]  [ 21, 22]  [ 25, 26]  [ 29, 30]   </div><div class="line">[ 33, 34]  [ 37, 38]  [ 41, 42]  [ 45, 46]</div><div class="line">[ 49, 50]  [ 53, 54]  [ 57, 58]  [ 61, 62]   </div><div class="line">[ 65, 66]  [ 69, 70]  [ 73, 74]  [ 77, 78]</div><div class="line">[ 81, 82]  [ 85, 86]  [ 89, 90]  [ 93, 94]   </div><div class="line">[ 97, 98]  [101,102]  [105,106]  [109,110]   </div><div class="line">[113,114]  [117,118]  [121,122]  [125,126]   </div><div class="line">[129,130]  [133,134]  [137,138]  [141,142]   </div><div class="line">[145,146]  [149,150]  [153,154]  [157,158]</div><div class="line">[161,162]  [165,166]  [169,170]  [173,174]   </div><div class="line">[177,178]  [181,182]  [185,186]  [189,190]   </div><div class="line">[193,194]  [197,198]  [201,202]  [205,206]   </div><div class="line">[209,210]  [213,214]  [217,218]  [221,222]   </div><div class="line">[225,226]  [229,230]  [233,234]  [237,238]</div><div class="line">[241,242]  [245,246]  [249,250]  [253,254]</div></pre></td></tr></table></figure></p><h4 id="下载openvpn客户端，并进行配置"><a href="#下载openvpn客户端，并进行配置" class="headerlink" title="下载openvpn客户端，并进行配置"></a>下载openvpn客户端，并进行配置</h4><p>用sftp将我们在vpn服务器上生成的客户端证书和key下载到客户端电脑，包括如下四个文件</p><ul><li>/etc/openvpn/easy-rsa/easyrsa3/pki/ca.crt</li><li>/etc/openvpn/easy-rsa/easyrsa3/pki/issued/client.crt</li><li>/root/client/easy-rsa/easyrsa3/pki/private/client.key</li><li>/etc/openvpn/keys/ta.key<br>去官网下载openvpn客户端进行安装，然后安装目录找到simple-config，<br>默认为C:\Program Files\OpenVPN\sample-config\client.ovpn。<br>将client.ovpn 复制到openvpn的config目录下，<br>默认为C:\Program Files\OpenVPN\config<br>将下载到的四个文件同样放入config目录下，<br>默认为C:\Program Files\OpenVPN\config  </li></ul><p>修改配置文件为如下内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">client #标记为客户端</div><div class="line">dev tun #与服务器端配置一致</div><div class="line">proto udp #与服务器端配置一致</div><div class="line">remote 122.112.219.248 1194 #服务器端IP与端口</div><div class="line">resolv-retry infinite</div><div class="line">nobind</div><div class="line">persist-key</div><div class="line">persist-tun</div><div class="line">ca ca.crt #ca证书</div><div class="line">cert client.crt #客户端证书</div><div class="line">key client.key #客户端证书的key</div><div class="line">remote-cert-tls server #服务器证书的名字</div><div class="line">tls-auth ta.key 1 #ta证书，如果服务器端配置，则客户端必须配置</div><div class="line">cipher AES-256-CBC #与服务器端配置一致</div><div class="line">comp-lzo #与服务器端配置一致</div><div class="line">verb 3 #日志级别</div></pre></td></tr></table></figure></p><p>经过以上配置，客户端就能连接上vpn服务器了(服务器端的1194端口要开放)，但是并不能访问内网服务器，<br>因为vpn服务器没有配置虚拟ip的转发。</p><h4 id="配置服务器端iptables"><a href="#配置服务器端iptables" class="headerlink" title="配置服务器端iptables"></a>配置服务器端iptables</h4><p>通过如下命令来达到将某个网段的IP转发到主网卡上，以达到与内网服务器通信的目的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t nat -A POSTROUTING -s 10.0.1.0/24 -d 192.168.0.0/24 -o eth0 -j MASQUERADE</div></pre></td></tr></table></figure></p><p>为了实现不同用户不同权限，需要做如下操作来限制不同网段的用户的访问权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">iptables -t nat -A POSTROUTING -s 10.0.0.0/24 -o eth0 -j MASQUERADE</div><div class="line">iptables -t nat -A POSTROUTING -s 10.0.1.0/24 -d 192.168.0.0/24 -o eth0 -j MASQUERADE</div><div class="line">iptables -t nat -A POSTROUTING -s 10.0.1.0/24 -d 192.168.1.0/24 -o eth0 -j MASQUERADE</div><div class="line">iptables -t nat -A POSTROUTING -s 10.0.1.0/24 -d 192.168.5.0/24 -o eth0 -j MASQUERADE</div><div class="line">iptables -t nat -A POSTROUTING -s 10.0.2.0/24 -d 192.168.3.0/24 -o eth0 -j MASQUERADE</div><div class="line">iptables -t nat -A POSTROUTING -s 10.0.2.0/24 -d 192.168.4.0/24 -o eth0 -j MASQUERADE</div><div class="line">iptables -t nat -A POSTROUTING -s 10.0.2.0/24 -d 192.168.5.0/24 -o eth0 -j MASQUERADE</div></pre></td></tr></table></figure></p><p>经过如此配置，即可访问内网<br>配置完成后，使用如下命令保存iptables 规则到文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service iptables save</div></pre></td></tr></table></figure></p><h4 id="实现用户名密码登录"><a href="#实现用户名密码登录" class="headerlink" title="实现用户名密码登录"></a>实现用户名密码登录</h4><p>在经过以上配置后，再来实现用户名密码登录就简单多了，只需要改一些配置即可。</p><h5 id="修改服务器端配置"><a href="#修改服务器端配置" class="headerlink" title="修改服务器端配置"></a>修改服务器端配置</h5><p>编辑/etc/openvpn/server.conf,添加如下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">plugin /usr/lib64/openvpn/plugin/lib/openvpn-auth-pam.so login #我是64位操作系统</div><div class="line">client-cert-not-required #只需验证用户名密码，不要求客户端证书</div><div class="line">username-as-common-name #用户名做common-name，既用户名相当于客户端名，个性化的时候使用用户名即可。</div></pre></td></tr></table></figure></p><p>编辑客户端配置文件，既C:\Program Files\OpenVPN\sample-config\client.ovpn<br>注释掉如下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">;cert client.crt</div><div class="line">;key client.key</div></pre></td></tr></table></figure></p><p>添加如下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">auth-user-pass</div></pre></td></tr></table></figure></p><p>创建服务器用户，由于仅作为vpn用户登录，因此建议创建不带home目录，没有登录权限的用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">useradd -M user1 -s /sbin/nologin</div><div class="line">echo &quot;password&quot; | passwd user1 --stdin</div></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;声明&quot;&gt;&lt;a href=&quot;#声明&quot; class=&quot;headerlink&quot; title=&quot;声明&quot;&gt;&lt;/a&gt;声明&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;OpenVpn版本: 2.4.3  &lt;/li&gt;
&lt;li&gt;Centos版本: 6.8  &lt;/li&gt;
&lt;li&gt;本机IP: 192.168.5.3&lt;/li&gt;
&lt;li&gt;实现功能：&lt;ul&gt;
&lt;li&gt;客户端需通过用户名密码登录&lt;/li&gt;
&lt;li&gt;用户名密码为系统用户&lt;/li&gt;
&lt;li&gt;不同用户分为不同网段&lt;/li&gt;
&lt;li&gt;通过VPN服务器的iptables来限制不同网段的访问，间接限制用户&lt;br&gt;先实现证书登录，再实现用户名密码登录，也可以跳过证书登录的配置，直接实现用户名密码登录
    
    </summary>
    
      <category term="OpenVpn" scheme="https://shijieqin.github.io/categories/OpenVpn/"/>
    
    
      <category term="OpenVpn" scheme="https://shijieqin.github.io/tags/OpenVpn/"/>
    
  </entry>
  
  <entry>
    <title>s3fs on obs</title>
    <link href="https://shijieqin.github.io/2017/06/21/s3fs-on-obs/"/>
    <id>https://shijieqin.github.io/2017/06/21/s3fs-on-obs/</id>
    <published>2017-06-21T08:47:14.000Z</published>
    <updated>2017-06-21T08:47:14.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="s3fs简介"><a href="#s3fs简介" class="headerlink" title="s3fs简介"></a>s3fs简介</h3><p>s3fs 是一款用于 Amazon S3 在 Linux 环境下的命令行工具，并为商业和私人免费使用，只需支付对应的存储服务的费用。它的主要功能是能够把桶（Bucket）挂载到本地目录，进行文件、文件夹的拷入、拷出和删除等操作，即完成对桶内文件、文件夹的上传、下载和删除操作。<br><a id="more"></a></p><h3 id="下载s3fs"><a href="#下载s3fs" class="headerlink" title="下载s3fs"></a>下载s3fs</h3><p>登录网址 <a href="http://code.google.com/p/s3fs/downloads/list" target="_blank" rel="external">http://code.google.com/p/s3fs/downloads/list</a> 进入下载界面，选择相应<br>版本，单击“Download”进行下载。<br>本文档以s3fs-1.74.tar.gz为例</p><h3 id="安装s3fs"><a href="#安装s3fs" class="headerlink" title="安装s3fs"></a>安装s3fs</h3><h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">yum install fuse.x86_64 fuse-devel.x86_64 fuse-libs.x86_64 libconfuse-devel.x86_64 libconfuse.x86_64 gcc-c++.noarch curl.x86_64 libcurl-devel.x86_64 libcurl.x86_64 libxml2.x86_64 libxml2-devel.x86_64 openssl-devel.x86_64</div><div class="line"># 检查fuse版本(必须要大于2.8.4)</div><div class="line">rpm -qa | grep fuse</div><div class="line"># 若小于2.8.4，则需要用源码安装新版的fuse，如下</div><div class="line">yum remove fuse fuse-devel</div><div class="line">tar -xvf fuse-2.8.4.tar</div><div class="line">cd fuse-2.8.4</div><div class="line">./configure --prefix=/usr/local/fuse</div><div class="line">make</div><div class="line">make install</div><div class="line">echo /usr/local/fuse/lib &gt;&gt; /etc/ld.so.conf</div><div class="line">echo &quot;export PKG_CONFIG_PATH=/usr/lib/pkgconfig:/usr/lib64/pkgconfig/:/usr/local/fuse/lib/pkgconfig/&quot; &gt;&gt; /etc/profile</div><div class="line">source /etc/profile</div><div class="line">ldconfig</div><div class="line">modprobe fuse</div><div class="line">pkg-config --modversion fuse</div></pre></td></tr></table></figure><h4 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -zxvf s3fs-1.74.tar.gz</div></pre></td></tr></table></figure><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd s3fs-1.74</div><div class="line">./configure</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure><h4 id="配置秘钥"><a href="#配置秘钥" class="headerlink" title="配置秘钥"></a>配置秘钥</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vi /etc/passwd-s3fs</div><div class="line"># 添加秘钥，格式如下</div><div class="line">AK:SK</div><div class="line"># 更改权限</div><div class="line">chmod 640 /etc/passwd-s3fs</div></pre></td></tr></table></figure><h4 id="创建obs用户"><a href="#创建obs用户" class="headerlink" title="创建obs用户"></a>创建obs用户</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">groupadd obs</div><div class="line">useradd -g obs obs</div></pre></td></tr></table></figure><h4 id="用户obs用户创建cache文件夹"><a href="#用户obs用户创建cache文件夹" class="headerlink" title="用户obs用户创建cache文件夹"></a>用户obs用户创建cache文件夹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir .obs_cache</div></pre></td></tr></table></figure><h4 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">s3fs www.going-link.com /obs -o host=http://obs.myhwclouds.com -o umask=0022 -o uid=501 -o gid=501 -o use_cache=/home/obs/.obs_cache -o allow_other</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;s3fs简介&quot;&gt;&lt;a href=&quot;#s3fs简介&quot; class=&quot;headerlink&quot; title=&quot;s3fs简介&quot;&gt;&lt;/a&gt;s3fs简介&lt;/h3&gt;&lt;p&gt;s3fs 是一款用于 Amazon S3 在 Linux 环境下的命令行工具，并为商业和私人免费使用，只需支付对应的存储服务的费用。它的主要功能是能够把桶（Bucket）挂载到本地目录，进行文件、文件夹的拷入、拷出和删除等操作，即完成对桶内文件、文件夹的上传、下载和删除操作。&lt;br&gt;
    
    </summary>
    
      <category term="华为云" scheme="https://shijieqin.github.io/categories/%E5%8D%8E%E4%B8%BA%E4%BA%91/"/>
    
      <category term="obs" scheme="https://shijieqin.github.io/categories/%E5%8D%8E%E4%B8%BA%E4%BA%91/obs/"/>
    
    
      <category term="华为云" scheme="https://shijieqin.github.io/tags/%E5%8D%8E%E4%B8%BA%E4%BA%91/"/>
    
      <category term="obs" scheme="https://shijieqin.github.io/tags/obs/"/>
    
  </entry>
  
  <entry>
    <title>duplicity install</title>
    <link href="https://shijieqin.github.io/2017/06/20/duplicity-install/"/>
    <id>https://shijieqin.github.io/2017/06/20/duplicity-install/</id>
    <published>2017-06-20T10:17:26.000Z</published>
    <updated>2017-06-20T10:17:26.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="安装环境依赖"><a href="#安装环境依赖" class="headerlink" title="安装环境依赖"></a>安装环境依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum install -y gcc-c++ librsync python-lockfile python-urllib3 python-setuptools python-devel librsync-devel python-pip</div><div class="line"></div><div class="line">pip install oss2</div></pre></td></tr></table></figure><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">tar zxvf duplicity.tar.gz</div><div class="line">cd duplicity</div><div class="line">python setup.py install</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;安装环境依赖&quot;&gt;&lt;a href=&quot;#安装环境依赖&quot; class=&quot;headerlink&quot; title=&quot;安装环境依赖&quot;&gt;&lt;/a&gt;安装环境依赖&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gut
      
    
    </summary>
    
      <category term="duplicity" scheme="https://shijieqin.github.io/categories/duplicity/"/>
    
      <category term="install" scheme="https://shijieqin.github.io/categories/duplicity/install/"/>
    
    
      <category term="duplicity" scheme="https://shijieqin.github.io/tags/duplicity/"/>
    
  </entry>
  
  <entry>
    <title>redis sentinel</title>
    <link href="https://shijieqin.github.io/2017/06/15/redis-sentinel/"/>
    <id>https://shijieqin.github.io/2017/06/15/redis-sentinel/</id>
    <published>2017-06-15T05:37:36.000Z</published>
    <updated>2017-06-15T05:37:36.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="更新日志"><a href="#更新日志" class="headerlink" title="更新日志"></a>更新日志</h3><ul><li>修改redis-sentinel的配置文件, 添加sentinel auth-pass mymaster 123456， 解决新版redis, master宕机后不能自动切换的问题<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3>该文章只是简单的记录redis sentinel的安装过程，并没有深度优化，只能保证安装完成后可以使用。后续再继续优化。<br>master ip: 100.65.9.250<br>slave1 ip: 100.65.16.158<br>slave2 ip: 100.65.16.162<a id="more"></a><h3 id="Redis安装"><a href="#Redis安装" class="headerlink" title="Redis安装"></a>Redis安装</h3>redis的安装包去redis官网下载<h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install gcc gcc-c++ tcl</div></pre></td></tr></table></figure></li></ul><h4 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">tar -zxvf redis-3.2.9.tar.gz</div><div class="line">cd redis-3.2.9</div><div class="line">make</div></pre></td></tr></table></figure><p>这一步可能出现如下错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">cd src &amp;&amp; make all</div><div class="line">make[1]: Entering directory `/root/redis-3.2.9/src&apos;</div><div class="line">    CC adlist.o</div><div class="line">In file included from adlist.c:34:</div><div class="line">zmalloc.h:50:31: error: jemalloc/jemalloc.h: No such file or directory</div><div class="line">zmalloc.h:55:2: error: #error &quot;Newer version of jemalloc required&quot;</div><div class="line">make[1]: *** [adlist.o] Error 1</div><div class="line">make[1]: Leaving directory `/root/redis-3.2.9/src&apos;</div><div class="line">make: *** [all] Error 2</div></pre></td></tr></table></figure></p><p>执行如下命令解决<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make distclean</div></pre></td></tr></table></figure></p><p>再重新make</p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd src</div><div class="line">make install PREFIX=/usr/local/redis</div><div class="line">cd ..</div><div class="line">cp redis.conf /usr/local/redis/</div><div class="line">cp sentinel.conf /usr/local/redis/</div></pre></td></tr></table></figure><h4 id="配置master和slave的配置文件"><a href="#配置master和slave的配置文件" class="headerlink" title="配置master和slave的配置文件"></a>配置master和slave的配置文件</h4><p>编辑/usr/local/redis/redis.conf<br>修改如下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">bind 0.0.0.0</div><div class="line"># 访问master的密码 由于master和slave会互换，所以两个密码都最好配上</div><div class="line">masterauth 123456</div><div class="line"># redis的访问密码</div><div class="line">requirepass 123456</div><div class="line"># 开启守护模式  </div><div class="line">daemonize yes  </div><div class="line"># 指定数据存储目录  </div><div class="line">dir /data/redis  </div><div class="line"># 打开aof持久化  </div><div class="line">appendonly yes  </div><div class="line"># 每秒一次aof写  </div><div class="line">appendfsync everysec</div><div class="line"># 修改日志路径</div><div class="line">logfile &quot;/var/log/redis.log&quot;</div></pre></td></tr></table></figure></p><h4 id="配置slave的配置文件"><a href="#配置slave的配置文件" class="headerlink" title="配置slave的配置文件"></a>配置slave的配置文件</h4><p>在以上配置文件的基础上添加如下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 指定所属的主机  </div><div class="line">slaveof 100.65.9.250 6379  </div><div class="line"># 指定从机&quot;只读&quot;  </div><div class="line">slave-read-only yes</div></pre></td></tr></table></figure></p><h4 id="配置sentinel配置文件"><a href="#配置sentinel配置文件" class="headerlink" title="配置sentinel配置文件"></a>配置sentinel配置文件</h4><p>编辑所有服务器的/usr/local/redis/sentinel.conf文件<br>添加或修改如下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">bind 0.0.0.0</div><div class="line">daemonize yes</div><div class="line">logfile &quot;/var/log/sentinel.log&quot;</div><div class="line"># sentinel需要监控的master/slaver信息，格式为sentinel monitor &lt;mastername&gt; &lt;masterIP&gt; &lt;masterPort&gt; &lt;quorum&gt;  </div><div class="line"># 其中&lt;quorum&gt;应该小于集群中slave的个数，当失效的节点数超过了&lt;quorum&gt;,则认为整个体系结构失效</div><div class="line">sentinel monitor mymaster 100.65.9.250 6379 2</div><div class="line">sentinel auth-pass mymaster 123456</div><div class="line"># master被当前sentinel实例认定为失效的间隔时间，格式为sentinel down-after-milliseconds &lt;mastername&gt; &lt;milliseconds&gt;</div><div class="line">sentinel down-after-milliseconds mymaster 10000</div><div class="line"># 当新master产生时，同时进行“slaveof”到新master并进行同步复制的slave个数  </div><div class="line"># 在salve执行salveof同步时，将会终止客户端请求。  </div><div class="line"># 此值较大,意味着“集群”终止客户端请求的时间总和和较大。  </div><div class="line"># 此值较小,意味着“集群”在故障转移期间，多个salve向客户端提供服务时仍然使用旧数据。</div><div class="line">sentinel parallel-syncs mymaster 1</div><div class="line"># failover过期时间。当failover开始后，在此时间内仍然没有触发任何failover操作，当前sentinel将会认为此次failoer失败。</div><div class="line">sentinel failover-timeout mymaster 60000</div></pre></td></tr></table></figure></p><h4 id="启动三台服务器的redis"><a href="#启动三台服务器的redis" class="headerlink" title="启动三台服务器的redis"></a>启动三台服务器的redis</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/redis/bin/redis-server /usr/local/redis/redis.conf</div></pre></td></tr></table></figure><h4 id="启动三台服务器的sentinel"><a href="#启动三台服务器的sentinel" class="headerlink" title="启动三台服务器的sentinel"></a>启动三台服务器的sentinel</h4><p>先确保redis已经启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/redis/bin/redis-sentinel /usr/local/redis/sentinel.conf</div></pre></td></tr></table></figure></p><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><h4 id="在任意一个节点上查看主从机的复制信息"><a href="#在任意一个节点上查看主从机的复制信息" class="headerlink" title="在任意一个节点上查看主从机的复制信息"></a>在任意一个节点上查看主从机的复制信息</h4><h5 id="查看master节点信息"><a href="#查看master节点信息" class="headerlink" title="查看master节点信息"></a>查看master节点信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@redis ~]# /usr/local/redis/bin/redis-cli -h 100.65.9.250 -p 6379 -a 123456 info Replication</div><div class="line"># Replication</div><div class="line">role:master</div><div class="line">connected_slaves:2</div><div class="line">slave0:ip=100.65.16.158,port=6379,state=online,offset=2437,lag=0</div><div class="line">slave1:ip=100.65.16.162,port=6379,state=online,offset=2437,lag=0</div><div class="line">master_repl_offset:2437</div><div class="line">repl_backlog_active:1</div><div class="line">repl_backlog_size:1048576</div><div class="line">repl_backlog_first_byte_offset:2</div><div class="line">repl_backlog_histlen:2436</div></pre></td></tr></table></figure><h5 id="查看slave节点信息"><a href="#查看slave节点信息" class="headerlink" title="查看slave节点信息"></a>查看slave节点信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@redis ~]# /usr/local/redis/bin/redis-cli -h 100.65.16.158 -p 6379 -a 123456 info Replication</div><div class="line"># Replication</div><div class="line">role:slave</div><div class="line">master_host:100.65.9.250</div><div class="line">master_port:6379</div><div class="line">master_link_status:up</div><div class="line">master_last_io_seconds_ago:9</div><div class="line">master_sync_in_progress:0</div><div class="line">slave_repl_offset:2605</div><div class="line">slave_priority:100</div><div class="line">slave_read_only:1</div><div class="line">connected_slaves:0</div><div class="line">master_repl_offset:0</div><div class="line">repl_backlog_active:0</div><div class="line">repl_backlog_size:1048576</div><div class="line">repl_backlog_first_byte_offset:0</div><div class="line">repl_backlog_histlen:0</div></pre></td></tr></table></figure><h4 id="测试数据"><a href="#测试数据" class="headerlink" title="测试数据"></a>测试数据</h4><h5 id="客户端连接master-set一条测试数据"><a href="#客户端连接master-set一条测试数据" class="headerlink" title="客户端连接master set一条测试数据"></a>客户端连接master set一条测试数据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@redis ~]# /usr/local/redis/bin/redis-cli -h 100.65.9.250 -p 6379 -a 123456</div><div class="line">100.65.9.250:6379&gt; set test thisistest</div><div class="line">OK</div><div class="line">100.65.9.250:6379&gt;</div></pre></td></tr></table></figure><h5 id="客户端连接任意slave查看数据"><a href="#客户端连接任意slave查看数据" class="headerlink" title="客户端连接任意slave查看数据"></a>客户端连接任意slave查看数据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@redis ~]# /usr/local/redis/bin/redis-cli -h 100.65.16.158 -p 6379 -a 123456</div><div class="line">100.65.16.158:6379&gt; get test</div><div class="line">&quot;thisistest&quot;</div><div class="line">100.65.16.158:6379&gt;</div></pre></td></tr></table></figure><h4 id="测试主从检测"><a href="#测试主从检测" class="headerlink" title="测试主从检测"></a>测试主从检测</h4><p>关闭一台slave节点，然后检测节点信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@redis ~]# /usr/local/redis/bin/redis-cli -h 100.65.9.250 -p 6379 -a 123456 info Replication</div><div class="line"># Replication</div><div class="line">role:master</div><div class="line">connected_slaves:1</div><div class="line">slave0:ip=100.65.16.162,port=6379,state=online,offset=4082,lag=0</div><div class="line">master_repl_offset:4082</div><div class="line">repl_backlog_active:1</div><div class="line">repl_backlog_size:1048576</div><div class="line">repl_backlog_first_byte_offset:2</div><div class="line">repl_backlog_histlen:4081</div></pre></td></tr></table></figure></p><p>发现少了一个slave节点<br>再启动关闭的slave节点，并检测<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@redis ~]# /usr/local/redis/bin/redis-cli -h 100.65.9.250 -p 6379 -a 123456 info Replication</div><div class="line"># Replication</div><div class="line">role:master</div><div class="line">connected_slaves:2</div><div class="line">slave0:ip=100.65.16.162,port=6379,state=online,offset=4362,lag=0</div><div class="line">slave1:ip=100.65.16.158,port=6379,state=online,offset=4362,lag=0</div><div class="line">master_repl_offset:4362</div><div class="line">repl_backlog_active:1</div><div class="line">repl_backlog_size:1048576</div><div class="line">repl_backlog_first_byte_offset:2</div><div class="line">repl_backlog_histlen:4361</div></pre></td></tr></table></figure></p><p>发现检测到slave节点又变为了2<br>关闭master，然后检测节点信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@redis ~]# /usr/local/redis/bin/redis-cli -h 100.65.16.162 -p 6379 -a 123456 info Replication</div><div class="line"># Replication</div><div class="line">role:slave</div><div class="line">master_host:100.65.9.250</div><div class="line">master_port:6379</div><div class="line">master_link_status:down</div><div class="line">master_last_io_seconds_ago:-1</div><div class="line">master_sync_in_progress:0</div><div class="line">slave_repl_offset:4586</div><div class="line">master_link_down_since_seconds:27</div><div class="line">slave_priority:100</div><div class="line">slave_read_only:1</div><div class="line">connected_slaves:0</div><div class="line">master_repl_offset:0</div><div class="line">repl_backlog_active:0</div><div class="line">repl_backlog_size:1048576</div><div class="line">repl_backlog_first_byte_offset:0</div><div class="line">repl_backlog_histlen:0</div></pre></td></tr></table></figure></p><p>发现并没有马上选举出新的master，还是就得master，这段时间是不可写的。<br>过一段时间后，重新检测，发现选举出了新的master。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;更新日志&quot;&gt;&lt;a href=&quot;#更新日志&quot; class=&quot;headerlink&quot; title=&quot;更新日志&quot;&gt;&lt;/a&gt;更新日志&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;修改redis-sentinel的配置文件, 添加sentinel auth-pass mymaster 123456， 解决新版redis, master宕机后不能自动切换的问题&lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;该文章只是简单的记录redis sentinel的安装过程，并没有深度优化，只能保证安装完成后可以使用。后续再继续优化。&lt;br&gt;master ip: 100.65.9.250&lt;br&gt;slave1 ip: 100.65.16.158&lt;br&gt;slave2 ip: 100.65.16.162
    
    </summary>
    
      <category term="redis" scheme="https://shijieqin.github.io/categories/redis/"/>
    
    
      <category term="redis" scheme="https://shijieqin.github.io/tags/redis/"/>
    
      <category term="sentinel" scheme="https://shijieqin.github.io/tags/sentinel/"/>
    
      <category term="HA" scheme="https://shijieqin.github.io/tags/HA/"/>
    
  </entry>
  
  <entry>
    <title>hwcloud user guid</title>
    <link href="https://shijieqin.github.io/2017/06/13/hwcloud-user-guid/"/>
    <id>https://shijieqin.github.io/2017/06/13/hwcloud-user-guid/</id>
    <published>2017-06-13T01:56:03.000Z</published>
    <updated>2017-06-13T01:56:03.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>该文章旨在记录在使用华为云的过程中遇到的各种坑以及解决方案。<br><a id="more"></a></p><h3 id="无公网-IP-的云服务器访问-Internet"><a href="#无公网-IP-的云服务器访问-Internet" class="headerlink" title="无公网 IP 的云服务器访问 Internet"></a>无公网 IP 的云服务器访问 Internet</h3><h4 id="操作场景"><a href="#操作场景" class="headerlink" title="操作场景"></a>操作场景</h4><p>华为官方的说法如下：<br>为保证安全和节省公网IP资源，通常只为特定的云服务器配置公网IP，可直接访问 Internet，其他云服务器只配置私网IP，无法直接访问Internet。因此，当只配置了私网 IP的云服务器需要访问Internet，执行软件升级、给系统打补丁或者其它需求时，可选 择一台绑定了公网IP的云服务器作为代理云服务器，为其他无公网IP的云服务器提供访 问通道，正常访问Internet。<br>为了让无公网 IP 的云服务器访问 Internet 需要手动配置网关。  </p><h4 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h4><ul><li>已拥有一台绑定了公网IP的云服务器作为代理云服务器。 本节操作中，以代理云服务器的操作系统是CentOS 6.5为例。</li><li>代理云服务器和其他需要访问Internet的云服务器需要访问外网的网卡均处于同一网段，并且在同一安 全组内。</li><li>我代理服务器的网段为192.168.2.0/24 网关为192.168.2.1</li><li>代理服务器内网ip为192.168.2.254</li><li>我的无公网 IP 的服务器的主网卡网段为192.168.0.0/24 网关为192.168.0.1。</li><li>无公网 IP 服务器的主网卡如果与代理服务器不在一个网段，则可以再添加一个与代理服务器在一个网段的网卡。</li></ul><h4 id="配置代理服务器"><a href="#配置代理服务器" class="headerlink" title="配置代理服务器"></a>配置代理服务器</h4><ol><li>登录管理控制台将代理服务器的网卡的“源/目的检查”选项 设置为“OFF”。</li><li>登录代理服务器，ping 下百度或谷歌测试网络连通性</li><li><p>查看代理云服务器的 IP 转发功能是否开启</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /proc/sys/net/ipv4/ip_forward</div></pre></td></tr></table></figure><ul><li>回显为“0”表示关闭，请执行<a href="#1.4">步骤4</a>。</li><li>回显为“1”表示开启，请执行<a href="#1.5">步骤5</a>。</li></ul></li><li><p><span id="1.4">配置 IP 转发<br>编辑 /etc/sysctl.conf ，将 net.ipv4.ip_forward 的值改为 “1”，并执行如下命令使配置文件生效</span></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sysctl -p /etc/sysctl.conf</div></pre></td></tr></table></figure></li><li><p><span id="1.5">清除 IPTABLES 规则</span></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -F</div></pre></td></tr></table></figure></li><li><p>配置SNAT</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t nat -A POSTROUTING -o eth0 -s 192.168.2.0/24 -j SNAT --to 192.168.2.254</div></pre></td></tr></table></figure></li><li><p>验证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t nat --list</div></pre></td></tr></table></figure></li></ol><p>回显类似下图，表示配置成功<br><img src="/images/1.png" alt=""></p><ol><li>保存 IPTABLES 配置<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service iptables save</div></pre></td></tr></table></figure></li></ol><h4 id="配置无公网-IP-的云服务器"><a href="#配置无公网-IP-的云服务器" class="headerlink" title="配置无公网 IP 的云服务器"></a>配置无公网 IP 的云服务器</h4><p>这里直接设置静态路由表来实现，重启服务器仍然生效</p><ol><li><p>配置默认网关</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@srm-app ~]# echo &quot;GATEWAY=192.168.2.254&quot; &gt;&gt; /etc/sysconfig/network</div></pre></td></tr></table></figure></li><li><p>配置静态路由表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/sysconfig/static-routes</div></pre></td></tr></table></figure></li></ol><p>添加如下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">any net 169.254.169.254/32 gw 192.168.2.1 eth1</div><div class="line">any net 169.254.169.254/32 gw 192.168.0.1 eth0</div><div class="line">any net 192.168.2.0/24 gw 192.168.2.1 eth1</div><div class="line">any net 192.168.0.0/16 gw 192.168.0.1 eth0</div><div class="line">any net 100.125.0.0/16 gw 192.168.0.1 eth0</div></pre></td></tr></table></figure></p><p>其中</p><ul><li>169.254.169.254/32 为华为官方文档特别说明要添加的</li><li>192.168.2.0/24 这个网段必须要添加</li><li>192.168.0.0/16 添加这个网段是我所有内网服务器的网段，添加这个网段是为了让我内网之间互相访问的时候不走代理服务器</li><li>100.125.0.0/16 这个网段是华为云的负载均衡的内网网段，添加这个网段是为了让负载均衡在访问服务器的时候不走代理<ol><li>重启网络服务<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service network restart</div></pre></td></tr></table></figure></li></ol></li></ul><p>ping外网来验证</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;该文章旨在记录在使用华为云的过程中遇到的各种坑以及解决方案。&lt;br&gt;
    
    </summary>
    
      <category term="华为云" scheme="https://shijieqin.github.io/categories/%E5%8D%8E%E4%B8%BA%E4%BA%91/"/>
    
      <category term="ELB" scheme="https://shijieqin.github.io/categories/%E5%8D%8E%E4%B8%BA%E4%BA%91/ELB/"/>
    
    
      <category term="华为云" scheme="https://shijieqin.github.io/tags/%E5%8D%8E%E4%B8%BA%E4%BA%91/"/>
    
      <category term="网络" scheme="https://shijieqin.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="ELB" scheme="https://shijieqin.github.io/tags/ELB/"/>
    
  </entry>
  
  <entry>
    <title>first blog from atom</title>
    <link href="https://shijieqin.github.io/2017/06/09/first-blog-from-atom/"/>
    <id>https://shijieqin.github.io/2017/06/09/first-blog-from-atom/</id>
    <published>2017-06-09T13:26:03.000Z</published>
    <updated>2017-06-09T13:26:03.000Z</updated>
    
    <content type="html"><![CDATA[<p>comming soon…</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;comming soon…&lt;/p&gt;

      
    
    </summary>
    
      <category term="test" scheme="https://shijieqin.github.io/categories/test/"/>
    
    
      <category term="test" scheme="https://shijieqin.github.io/tags/test/"/>
    
  </entry>
  
</feed>
