<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ShijieQin</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://shijieqin.github.io/"/>
  <updated>2018-01-12T07:11:56.000Z</updated>
  <id>https://shijieqin.github.io/</id>
  
  <author>
    <name>Shijie Qin</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>shell 编程</title>
    <link href="https://shijieqin.github.io/2018/01/12/shell-%E7%BC%96%E7%A8%8B/"/>
    <id>https://shijieqin.github.io/2018/01/12/shell-编程/</id>
    <published>2018-01-12T07:11:56.000Z</published>
    <updated>2018-01-12T07:11:56.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>记录shell编程出现的坑</p><h3 id="SHELL-参数"><a href="#SHELL-参数" class="headerlink" title="SHELL 参数"></a>SHELL 参数</h3><ul><li>${parameter:?word}</li></ul><p><em>当parameter指示的参数没有被设值的时候，将会通过标准错误的方式显示word中的语句。</em></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;描述&quot;&gt;&lt;a href=&quot;#描述&quot; class=&quot;headerlink&quot; title=&quot;描述&quot;&gt;&lt;/a&gt;描述&lt;/h3&gt;&lt;p&gt;记录shell编程出现的坑&lt;/p&gt;
&lt;h3 id=&quot;SHELL-参数&quot;&gt;&lt;a href=&quot;#SHELL-参数&quot; class=&quot;headerl
      
    
    </summary>
    
      <category term="shell" scheme="https://shijieqin.github.io/categories/shell/"/>
    
    
      <category term="shell" scheme="https://shijieqin.github.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>asmlib创建的磁盘在线扩容</title>
    <link href="https://shijieqin.github.io/2018/01/11/asmlib%E5%88%9B%E5%BB%BA%E7%9A%84%E7%A3%81%E7%9B%98%E5%9C%A8%E7%BA%BF%E6%89%A9%E5%AE%B9/"/>
    <id>https://shijieqin.github.io/2018/01/11/asmlib创建的磁盘在线扩容/</id>
    <published>2018-01-11T11:35:45.000Z</published>
    <updated>2018-01-11T11:35:45.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>本环境的asm磁盘是通过asmlib创建的，不适用于scsi的磁盘。</p><p>新增磁盘为/dev/xvdd</p><a id="more"></a><h3 id="操作过程"><a href="#操作过程" class="headerlink" title="操作过程"></a>操作过程</h3><h4 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">[root@srm-db ~]# fdisk /dev/xvdd </div><div class="line">Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel</div><div class="line">Building a new DOS disklabel with disk identifier 0x36af11d0.</div><div class="line">Changes will remain in memory only, until you decide to write them.</div><div class="line">After that, of course, the previous content won&apos;t be recoverable.</div><div class="line"></div><div class="line">Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)</div><div class="line"></div><div class="line">WARNING: DOS-compatible mode is deprecated. It&apos;s strongly recommended to</div><div class="line">         switch off the mode (command &apos;c&apos;) and change display units to</div><div class="line">         sectors (command &apos;u&apos;).</div><div class="line"></div><div class="line">Command (m for help): n</div><div class="line">Command action</div><div class="line">   e   extended</div><div class="line">   p   primary partition (1-4)</div><div class="line">p</div><div class="line">Partition number (1-4): 1</div><div class="line">First cylinder (1-65270, default 1): </div><div class="line">Using default value 1</div><div class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1-65270, default 65270): </div><div class="line">Using default value 65270</div><div class="line"></div><div class="line">Command (m for help): w</div><div class="line">The partition table has been altered!</div><div class="line"></div><div class="line">Calling ioctl() to re-read partition table.</div><div class="line">Syncing disks.</div><div class="line">[root@srm-db ~]#</div></pre></td></tr></table></figure><h4 id="查看现有ASM磁盘"><a href="#查看现有ASM磁盘" class="headerlink" title="查看现有ASM磁盘"></a>查看现有ASM磁盘</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@srm-db ~]# oracleasm listdisks</div><div class="line">DATA</div><div class="line">DATA2</div></pre></td></tr></table></figure><h4 id="添加新的asm磁盘"><a href="#添加新的asm磁盘" class="headerlink" title="添加新的asm磁盘"></a>添加新的asm磁盘</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@srm-db ~]# oracleasm createdisk DATA3 /dev/xvdd1</div><div class="line">Writing disk header: done</div><div class="line">Instantiating disk: done</div><div class="line">[root@srm-db ~]# oracleasm listdisks</div><div class="line">DATA</div><div class="line">DATA2</div><div class="line">DATA3</div><div class="line">[root@srm-db ~]#</div></pre></td></tr></table></figure><h4 id="查看数据库中记录的asm磁盘"><a href="#查看数据库中记录的asm磁盘" class="headerlink" title="查看数据库中记录的asm磁盘"></a>查看数据库中记录的asm磁盘</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">[root@srm-db ~]# su - grid</div><div class="line">[grid@srm-db ~]$ sqlplus  / as sysasm </div><div class="line"></div><div class="line">SQL*Plus: Release 12.2.0.1.0 Production on Thu Jan 11 19:42:07 2018</div><div class="line"></div><div class="line">Copyright (c) 1982, 2016, Oracle.  All rights reserved.</div><div class="line"></div><div class="line"></div><div class="line">Connected to:</div><div class="line">Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit Production</div><div class="line"></div><div class="line">SQL&gt; select name, path, mode_status, state, disk_number,failgroup from v$asm_disk;</div><div class="line"></div><div class="line">NAME</div><div class="line">------------------------------</div><div class="line">PATH</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">MODE_ST STATE DISK_NUMBER FAILGROUP</div><div class="line">------- -------- ----------- ------------------------------</div><div class="line"></div><div class="line">/dev/oracleasm/disks/DATA3</div><div class="line">ONLINENORMAL   0</div><div class="line"></div><div class="line">DATA_0000</div><div class="line">/dev/oracleasm/disks/DATA</div><div class="line">ONLINENORMAL   0 DATA_0000</div><div class="line"></div><div class="line">NAME</div><div class="line">------------------------------</div><div class="line">PATH</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">MODE_ST STATE DISK_NUMBER FAILGROUP</div><div class="line">------- -------- ----------- ------------------------------</div><div class="line"></div><div class="line">DATA_0001</div><div class="line">/dev/oracleasm/disks/DATA2</div><div class="line">ONLINENORMAL   1 DATA_0001</div><div class="line"></div><div class="line"></div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p>新增的asm磁盘为<code>/dev/oracleasm/disks/DATA3</code></p><h4 id="查看磁盘组名称"><a href="#查看磁盘组名称" class="headerlink" title="查看磁盘组名称"></a>查看磁盘组名称</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select group_number,name,TOTAL_MB, FREE_MB from v$asm_diskgroup</div><div class="line">  2  ;</div><div class="line"></div><div class="line">GROUP_NUMBER NAME      TOTAL_MB  FREE_MB</div><div class="line">------------ ------------------------------ ---------- ----------</div><div class="line">   1 DATA       1023988    36588</div><div class="line"></div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p>DATA磁盘组就是要扩容的磁盘组</p><h4 id="扩容DATA磁盘组"><a href="#扩容DATA磁盘组" class="headerlink" title="扩容DATA磁盘组"></a>扩容DATA磁盘组</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">SQL&gt; alter diskgroup DATA add disk &apos;/dev/oracleasm/disks/DATA3&apos; rebalance power 10;</div><div class="line"></div><div class="line">Diskgroup altered.</div><div class="line"></div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h4 id="观察reblance"><a href="#观察reblance" class="headerlink" title="观察reblance"></a>观察reblance</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select * from v$asm_operation;</div><div class="line"></div><div class="line">GROUP_NUMBER OPERA PASS      STAT      POWER ACTUAL      SOFAR   EST_WORK</div><div class="line">------------ ----- --------- ---- ---------- ---------- ---------- ----------</div><div class="line">  EST_RATE EST_MINUTES ERROR_CODECON_ID</div><div class="line">---------- ----------- -------------------------------------------- ----------</div><div class="line">   1 REBAL COMPACT   WAIT  10     10  0    0</div><div class="line"> 0     0     0</div><div class="line"></div><div class="line">   1 REBAL REBALANCE RUN  10     10       553182304</div><div class="line">      2268    33     0</div><div class="line"></div><div class="line">   1 REBAL REBUILD   DONE  10     10  0    0</div><div class="line"> 0     0     0</div><div class="line"></div><div class="line"></div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p>当没有输出时，则表明reblance完成</p><h4 id="修改reblance-power"><a href="#修改reblance-power" class="headerlink" title="修改reblance power"></a>修改reblance power</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ALTER DISKGROUP DATA REBALANCE POWER 1;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h3&gt;&lt;p&gt;本环境的asm磁盘是通过asmlib创建的，不适用于scsi的磁盘。&lt;/p&gt;
&lt;p&gt;新增磁盘为/dev/xvdd&lt;/p&gt;
    
    </summary>
    
      <category term="oracle" scheme="https://shijieqin.github.io/categories/oracle/"/>
    
      <category term="asm" scheme="https://shijieqin.github.io/categories/oracle/asm/"/>
    
    
      <category term="oracle" scheme="https://shijieqin.github.io/tags/oracle/"/>
    
      <category term="asm" scheme="https://shijieqin.github.io/tags/asm/"/>
    
  </entry>
  
  <entry>
    <title>DG Broker配置</title>
    <link href="https://shijieqin.github.io/2017/12/31/DG-Broker%E9%85%8D%E7%BD%AE/"/>
    <id>https://shijieqin.github.io/2017/12/31/DG-Broker配置/</id>
    <published>2017-12-31T08:20:18.000Z</published>
    <updated>2017-12-31T08:20:18.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>Dgmgrl表示Data Guard Manager Command Line Interface，用来管理维护Dataguard，而且该命令系统自带不需要额外安装，命令简单易上手，容易学习，比sqlplus用来更加简单一些.</p><p>本文参考了如下几篇文档：</p><blockquote><p><a href="https://community.oracle.com/docs/DOC-1007327" target="_blank" rel="external">https://community.oracle.com/docs/DOC-1007327</a></p><p><a href="http://blog.csdn.net/u011364306/article/details/50523117" target="_blank" rel="external">http://blog.csdn.net/u011364306/article/details/50523117</a></p><p><a href="http://blog.csdn.net/u011364306/article/details/50534654" target="_blank" rel="external">http://blog.csdn.net/u011364306/article/details/50534654</a></p></blockquote><a id="more"></a><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p><strong><em>注：本文的配置是基于我的另一篇文章<a href="/2017/12/28/Oracle11g-dataguard配置/" title="Oracle11g-dataguard配置">Oracle11g-dataguard配置</a>搭建出来的dg环境进行的配置</em></strong></p><h4 id="配置监听"><a href="#配置监听" class="headerlink" title="配置监听"></a>配置监听</h4><p>主备库都需要配置监听，需添加如下监听内容</p><p>主库(srmcloud)：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">LISTENER =</div><div class="line">  (DESCRIPTION_LIST =</div><div class="line">    (DESCRIPTION =</div><div class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = srmcloud)(PORT = 1521))</div><div class="line">    )</div><div class="line">  )</div><div class="line">SID_LIST_LISTENER=</div><div class="line">  (SID_LIST =</div><div class="line">    (SID_DESC =</div><div class="line">      (GLOBAL_DBNAME = srmcloud)</div><div class="line">      (ORACLE_HOME = /home/oracle/opt/oracle/product/11.2.0/dbhome_1)</div><div class="line">      (SID_NAME = srmcloud)</div><div class="line">    )</div><div class="line">    (SID_DESC =</div><div class="line">      (GLOBAL_DBNAME = srmcloud_dgmgrl)</div><div class="line">      (ORACLE_HOME = /home/oracle/opt/oracle/product/11.2.0/dbhome_1)</div><div class="line">      (SID_NAME = srmcloud)</div><div class="line">    )</div><div class="line">  )</div></pre></td></tr></table></figure><p>其中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(SID_DESC =</div><div class="line">      (GLOBAL_DBNAME = srmcloud_dgmgrl)</div><div class="line">      (ORACLE_HOME = /home/oracle/opt/oracle/product/11.2.0/dbhome_1)</div><div class="line">      (SID_NAME = srmcloud)</div><div class="line">    )</div></pre></td></tr></table></figure><p>为新添加的代码，GLOBAL_DBNAME一定要以<code>dgmgrl</code>结尾，备库一样，修改为如下内容</p><p>备库(srmclouddg)：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">LISTENER =</div><div class="line">  (DESCRIPTION_LIST =</div><div class="line">    (DESCRIPTION =</div><div class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = srmclouddg)(PORT = 1521))</div><div class="line">    )</div><div class="line">  )</div><div class="line">SID_LIST_LISTENER=</div><div class="line">  (SID_LIST =</div><div class="line">    (SID_DESC =</div><div class="line">      (GLOBAL_DBNAME = srmclouddg)</div><div class="line">      (ORACLE_HOME = /home/oracle/opt/oracle/product/11.2.0/dbhome_1)</div><div class="line">      (SID_NAME = srmcloud)</div><div class="line">    )</div><div class="line">    (SID_DESC =</div><div class="line">      (GLOBAL_DBNAME = srmclouddg_dgmgrl)</div><div class="line">      (ORACLE_HOME = /home/oracle/opt/oracle/product/11.2.0/dbhome_1)</div><div class="line">      (SID_NAME = srmcloud)</div><div class="line">    )</div><div class="line">  )</div></pre></td></tr></table></figure><p><strong><em>注：添加完成后，重启主备库的监听</em></strong></p><h4 id="配置DG-Broker-multiplexed-configuration-files"><a href="#配置DG-Broker-multiplexed-configuration-files" class="headerlink" title="配置DG Broker multiplexed configuration files"></a>配置DG Broker multiplexed configuration files</h4><p>如下操作在<strong>主备库</strong>都需要执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter system set dg_broker_config_file1=&apos;/home/oracle/opt/oracle/oradata/srmcloud/dg_config1.dat&apos; scope=both;</div><div class="line">System altered.</div><div class="line">SQL&gt; alter system set dg_broker_config_file2=&apos;/home/oracle/opt/oracle/oradata/srmcloud/dg_config2.dat&apos; scope=both;</div><div class="line">System altered.</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h4 id="start-the-Broker"><a href="#start-the-Broker" class="headerlink" title="start the Broker"></a>start the Broker</h4><p>如下操作在<strong>主备库</strong>都需要执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter system set dg_broker_start=true scope=both;</div><div class="line">System altered.</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p>这时可以查看后台启动了一个dmon进程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[oracle@srmcloud ~]$ ps -ef | grep dmon</div><div class="line">oracle   20464     1  0 05:54 ?        00:00:00 ora_dmon_srmcloud</div><div class="line">oracle   20579 18643  0 06:16 pts/1    00:00:00 grep dmon</div><div class="line">[oracle@srmcloud ~]$</div></pre></td></tr></table></figure><h4 id="配置Broker-Configuration"><a href="#配置Broker-Configuration" class="headerlink" title="配置Broker Configuration"></a>配置Broker Configuration</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[oracle@srmcloud ~]$ dgmgrl sys/handhand</div><div class="line">DGMGRL for Linux: Version 11.2.0.4.0 - 64bit Production</div><div class="line">Copyright (c) 2000, 2009, Oracle. All rights reserved.</div><div class="line">Welcome to DGMGRL, type &quot;help&quot; for information.</div><div class="line">Connected.</div><div class="line">DGMGRL&gt; create configuration srmcloud_srmclouddg_config as primary database is srmcloudconnect identifier is &apos;srmcloud&apos;;</div><div class="line">Configuration &quot;srmcloud_srmclouddg_config&quot; created with primary database &quot;srmcloud&quot;</div><div class="line">DGMGRL&gt;</div></pre></td></tr></table></figure><p><strong><em>注：</em></strong></p><ul><li><strong><em>其中identifier后面的内容是tns中配置的tnsname</em></strong></li><li><strong><em>有文章说在oracle12c中，由于配置了LOG_ARCHIVE_DEST_n的参数，导致报如下错误，Error: ORA-16698: LOG_ARCHIVE_DEST_n parameter set for object to be added，这种问题在11g中不会出现，至于12c是否真的会出现，可自行测试，解决办法就是将LOG_ARCHIVE_DEST_n参数置为空，等配置好之后再改回去。</em></strong></li></ul><h4 id="Add-the-standby-to-the-configuration"><a href="#Add-the-standby-to-the-configuration" class="headerlink" title="Add the standby to the configuration"></a>Add the standby to the configuration</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">DGMGRL&gt; add database srmclouddg as connect identifier is &apos;srmclouddg&apos;;</div><div class="line">Database &quot;srmclouddg&quot; added</div><div class="line">DGMGRL&gt;show configuration</div><div class="line">Configuration - srmcloud_srmclouddg_config</div><div class="line">  Protection Mode: MaxPerformance</div><div class="line">  Databases:</div><div class="line">    srmcloud   - Primary database</div><div class="line">    srmclouddg - Physical standby database</div><div class="line">Fast-Start Failover: DISABLED</div><div class="line">Configuration Status:</div><div class="line">DISABLED</div><div class="line">DGMGRL&gt;</div></pre></td></tr></table></figure><h4 id="Enable-that-Configuration"><a href="#Enable-that-Configuration" class="headerlink" title="Enable that Configuration."></a>Enable that Configuration.</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">DGMGRL&gt; enable configuration;</div><div class="line">Enabled.</div><div class="line">DGMGRL&gt;  show configuration</div><div class="line">Configuration - srmcloud_srmclouddg_config</div><div class="line">  Protection Mode: MaxPerformance</div><div class="line">  Databases:</div><div class="line">    srmcloud   - Primary database</div><div class="line">    srmclouddg - Physical standby database</div><div class="line">Fast-Start Failover: DISABLED</div><div class="line">Configuration Status:</div><div class="line">SUCCESS</div><div class="line">DGMGRL&gt;</div></pre></td></tr></table></figure><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><h4 id="验证切换"><a href="#验证切换" class="headerlink" title="验证切换"></a>验证切换</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">DGMGRL&gt; switchover to srmclouddg;</div><div class="line">Performing switchover NOW, please wait...</div><div class="line">Operation requires a connection to instance &quot;srmcloud&quot; on database &quot;srmclouddg&quot;</div><div class="line">Connecting to instance &quot;srmcloud&quot;...</div><div class="line">Connected.</div><div class="line">New primary database &quot;srmclouddg&quot; is opening...</div><div class="line">Operation requires startup of instance &quot;srmcloud&quot; on database &quot;srmcloud&quot;</div><div class="line">Starting instance &quot;srmcloud&quot;...</div><div class="line">ORACLE instance started.</div><div class="line">Database mounted.</div><div class="line">Database opened.</div><div class="line">Switchover succeeded, new primary is &quot;srmclouddg&quot;</div><div class="line">DGMGRL&gt; show configuration;</div><div class="line">Configuration - srmcloud_srmclouddg_config</div><div class="line">  Protection Mode: MaxPerformance</div><div class="line">  Databases:</div><div class="line">    srmclouddg - Primary database</div><div class="line">    srmcloud   - Physical standby database</div><div class="line">Fast-Start Failover: DISABLED</div><div class="line">Configuration Status:</div><div class="line">SUCCESS</div><div class="line">DGMGRL&gt;</div></pre></td></tr></table></figure><h4 id="验证手动关闭，并启动备机，自动启用日志应用"><a href="#验证手动关闭，并启动备机，自动启用日志应用" class="headerlink" title="验证手动关闭，并启动备机，自动启用日志应用"></a>验证手动关闭，并启动备机，自动启用日志应用</h4><p>之前需要手动启动日志应用才可以。</p><p>这里使用的是上一步切换过的主备库，主库为srmclouddg，备库为srmcloud</p><p>备库：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt; shutdown immediate;</div><div class="line">Database closed.</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p>主库：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">DGMGRL&gt; show database srmcloud</div><div class="line">Database - srmcloud</div><div class="line">  Role:            PHYSICAL STANDBY</div><div class="line">  Intended State:  OFFLINE</div><div class="line">  Transport Lag:   (unknown)</div><div class="line">  Apply Lag:       (unknown)</div><div class="line">  Apply Rate:      (unknown)</div><div class="line">  Real Time Query: OFF</div><div class="line">  Instance(s):</div><div class="line">    srmcloud</div><div class="line">Database Status:</div><div class="line">SHUTDOWN</div><div class="line">DGMGRL&gt;</div></pre></td></tr></table></figure><p>备库：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">SQL&gt; startup;</div><div class="line">ORACLE instance started.</div><div class="line">Total System Global Area 1553305600 bytes</div><div class="line">Fixed Size                  2253544 bytes</div><div class="line">Variable Size            1426066712 bytes</div><div class="line">Database Buffers          117440512 bytes</div><div class="line">Redo Buffers                7544832 bytes</div><div class="line">Database mounted.</div><div class="line">Database opened.</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p>主库：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">tabase - srmcloud</div><div class="line">  Role:            PHYSICAL STANDBY</div><div class="line">  Intended State:  APPLY-ON</div><div class="line">  Transport Lag:   0 seconds (computed 0 seconds ago)</div><div class="line">  Apply Lag:       0 seconds (computed 0 seconds ago)</div><div class="line">  Apply Rate:      0 Byte/s</div><div class="line">  Real Time Query: ON</div><div class="line">  Instance(s):</div><div class="line">    srmcloud</div><div class="line">Database Status:</div><div class="line">SUCCESS</div><div class="line">DGMGRL&gt;</div></pre></td></tr></table></figure><p>可以看出，自动启用了日志应用，不需要在sqlplus中输入alter database recover managed standby database …类似的语句，并且备库自动启动为<code>PHYSICAL STANDBY</code>的角色，不需要手动指定，OPEN_MODE自动为<code>READ ONLY WITH APPLY</code>模式，也不需要手动指定</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;Dgmgrl表示Data Guard Manager Command Line Interface，用来管理维护Dataguard，而且该命令系统自带不需要额外安装，命令简单易上手，容易学习，比sqlplus用来更加简单一些.&lt;/p&gt;
&lt;p&gt;本文参考了如下几篇文档：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://community.oracle.com/docs/DOC-1007327&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://community.oracle.com/docs/DOC-1007327&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.csdn.net/u011364306/article/details/50523117&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/u011364306/article/details/50523117&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.csdn.net/u011364306/article/details/50534654&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/u011364306/article/details/50534654&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="oracle" scheme="https://shijieqin.github.io/categories/oracle/"/>
    
      <category term="dg" scheme="https://shijieqin.github.io/categories/oracle/dg/"/>
    
      <category term="broker" scheme="https://shijieqin.github.io/categories/oracle/dg/broker/"/>
    
      <category term="dgmgrl" scheme="https://shijieqin.github.io/categories/oracle/dg/broker/dgmgrl/"/>
    
    
      <category term="oracle" scheme="https://shijieqin.github.io/tags/oracle/"/>
    
      <category term="dg" scheme="https://shijieqin.github.io/tags/dg/"/>
    
      <category term="broker" scheme="https://shijieqin.github.io/tags/broker/"/>
    
      <category term="dgmgrl" scheme="https://shijieqin.github.io/tags/dgmgrl/"/>
    
  </entry>
  
  <entry>
    <title>Oracle11g dataguard配置</title>
    <link href="https://shijieqin.github.io/2017/12/28/Oracle11g-dataguard%E9%85%8D%E7%BD%AE/"/>
    <id>https://shijieqin.github.io/2017/12/28/Oracle11g-dataguard配置/</id>
    <published>2017-12-28T09:49:27.000Z</published>
    <updated>2017-12-28T09:49:27.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>DG的配置过程，参考了如下两篇文章：</p><blockquote><p><a href="http://www.cnblogs.com/tippoint/archive/2013/04/18/3029019.html" target="_blank" rel="external">http://www.cnblogs.com/tippoint/archive/2013/04/18/3029019.html</a></p><p><a href="http://blog.itpub.net/29324876/viewspace-1246133/" target="_blank" rel="external">http://blog.itpub.net/29324876/viewspace-1246133/</a></p></blockquote><p>主库IP:10.211.55.6</p><p>备库IP:10.211.55.7</p><p>安装之前使用如下命令同步主备库的时间</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ntpdate -u 0.centos.pool.ntp.org</div></pre></td></tr></table></figure><a id="more"></a><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="判断DG是否已安装"><a href="#判断DG是否已安装" class="headerlink" title="判断DG是否已安装"></a>判断DG是否已安装</h4><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select * from v$option where parameter = 'Oracle Data Guard';</div><div class="line">PARAMETER               VALUE</div><div class="line"><span class="comment">-------------------     ---------</span></div><div class="line">Oracle Data Guard       TRUE</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p>如果是true表示已经安装可以配置，否则需要安装相应组件。</p><h4 id="设置主库为强制记录日志"><a href="#设置主库为强制记录日志" class="headerlink" title="设置主库为强制记录日志"></a>设置主库为强制记录日志</h4><p>默认情况下数据库操作会记录redo log，但是在一些特定的情况下可以使用nologging来不生成redo信息</p><ul><li>表的批量INSERT（通过/<em>+APPEND </em>/提示使用“直接路径插入“。或采用SQL*Loader直接路径加载）。表数据不生成redo，但是 </li></ul><p>所有索引修改会生成redo，但是所有索引修改会生成redo（尽管表不生成日志，但这个表上的索引却会生成redo！）。 </p><ul><li>LOB操作（对大对象的更新不必生成日志）。 </li><li>通过CREATE TABLE AS SELECT创建表</li><li>各种ALTER TABLE操作，如MOVE和SPLIT</li><li>在一些表迁移和表空间迁移中，可以使用alter table a nologging;或者alter tablespace snk nologging;在操作完成后再修改回logging状态。</li></ul><p>这里需要多说一句，如果你使用nologging导入大批量数据，以后对这些数据的修改会在redo或者archive log中，但是基准的数据是没有的，所以一旦介质损坏是无法完全恢复的，必须在使用nologging完成切换回logging后，做一次全备或者0级备份。</p><h5 id="强制记录日志"><a href="#强制记录日志" class="headerlink" title="强制记录日志"></a>强制记录日志</h5><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter database force logging;</div><div class="line">Database altered.</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h5 id="检查状态-YES为强制"><a href="#检查状态-YES为强制" class="headerlink" title="检查状态(YES为强制)"></a>检查状态(YES为强制)</h5><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select name,force_logging from v$database;</div><div class="line">NAME                        FORCE_LOG</div><div class="line"><span class="comment">--------------------------- ---------</span></div><div class="line">SRMCLOUD                    YES</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h5 id="如果需要在主库添加或者删除数据文件时，这些文件也会在备份添加或删除，使用如下"><a href="#如果需要在主库添加或者删除数据文件时，这些文件也会在备份添加或删除，使用如下" class="headerlink" title="如果需要在主库添加或者删除数据文件时，这些文件也会在备份添加或删除，使用如下"></a>如果需要在主库添加或者删除数据文件时，这些文件也会在备份添加或删除，使用如下</h5><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter system set standby_file_management = 'AUTO';</div><div class="line">System altered.</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h4 id="创建standby-log-files"><a href="#创建standby-log-files" class="headerlink" title="创建standby log files"></a>创建standby log files</h4><p>从库使用standby log files来保存从主库接收到的重做日志。既然主要是从库在使用，那为什么需要在主库上也建立standby log files ? 原因主要由两个：一是主库可能转换为备库，而备库是需要有standby log files的 二是如果主库建立了standby log files那备库会自动建立。</p><p>创建standby log files需要注意两点：</p><ul><li>standby log files的大小和redo log files一样</li></ul><ul><li>一般而言， standbyredo 日志文件组数要比 primary 数据库的 online redo 日志文件组数至少多一个。推荐 standbyredo 日志组数量基于 primary 数据库的线程数(这里的线程数可以理解为 rac 结构中的 rac节点数)。有一个推荐的公式可以做参考：(每线程的日志组数+1)<em>最大线程数<br>假设现在节点是1个，则=(3+1)</em>1=4<br>如果是双节点       则=(3+1)*2=8<br>这里我们创建4个standby logfile:</li></ul><h5 id="查询redo日志大小"><a href="#查询redo日志大小" class="headerlink" title="查询redo日志大小"></a>查询redo日志大小</h5><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select group#,bytes/1024/1024 as M from v$log;</div><div class="line">    GROUP#          M</div><div class="line"><span class="comment">---------- ----------</span></div><div class="line">         1        100</div><div class="line">         2        100</div><div class="line">         3        100</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p>这里是100M，三个</p><h5 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h5><p>不建议组号group#紧挨着redo，因为后续redo有可能调整，这里我们从建立从11到14的standby logfile</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter database add standby logfile group 11 '/home/oracle/opt/oracle/oradata/srmcloud/standby11.log' size 100M;</div><div class="line">Database altered.</div><div class="line">SQL&gt; alter database add standby logfile group 12 '/home/oracle/opt/oracle/oradata/srmcloud/standby12.log' size 100M;</div><div class="line">Database altered.</div><div class="line">SQL&gt; alter database add standby logfile group 13 '/home/oracle/opt/oracle/oradata/srmcloud/standby13.log' size 100M;</div><div class="line">Database altered.</div><div class="line">SQL&gt; alter database add standby logfile group 14 '/home/oracle/opt/oracle/oradata/srmcloud/standby14.log' size 100M;</div><div class="line">Database altered.</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h4 id="创建密码文件并传输给备库"><a href="#创建密码文件并传输给备库" class="headerlink" title="创建密码文件并传输给备库"></a>创建密码文件并传输给备库</h4><p>一般数据库默认就有密码文件，存放在$ORACLE_HOME/dbs/orapwSID  这里为orapwsrmcloud</p><p>如果没有</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sql&gt; orapwd file=$ORACLE_HOME/dbs/orapwsrmcloud password=oracle;</div></pre></td></tr></table></figure><p>检查REMOTE_LOGIN_PASSWORDFILE值是否为 EXCLUSIVE：</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sql&gt; show parameter REMOTE_LOGIN_PASSWORDFILE;</div></pre></td></tr></table></figure><p>如果值不是EXCLUSIVE，则：</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sql&gt; alter system set remote_login_passwordfile=exclusive scope=spfile;</div></pre></td></tr></table></figure><p>如果存在或者创建完成，将密码文件传输到standby 库的对应目录，并授权</p><h4 id="处理控制文件"><a href="#处理控制文件" class="headerlink" title="处理控制文件"></a>处理控制文件</h4><h5 id="查看控制文件位置"><a href="#查看控制文件位置" class="headerlink" title="查看控制文件位置"></a>查看控制文件位置</h5><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select name from v$controlfile;</div><div class="line">NAME</div><div class="line"><span class="comment">--------------------------------------------------------------------------------</span></div><div class="line">/home/oracle/opt/oracle/oradata/srmcloud/control01.ctl</div><div class="line">/home/oracle/opt/oracle/oradata/srmcloud/control02.ctl</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h5 id="生成standby控制文件"><a href="#生成standby控制文件" class="headerlink" title="生成standby控制文件"></a>生成standby控制文件</h5><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">SQL&gt; shutdown immediate</div><div class="line">Database closed.</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div><div class="line">SQL&gt; startup mount</div><div class="line">ORACLE instance started.</div><div class="line">Total System Global Area 1553305600 bytes</div><div class="line">Fixed Size                  2253544 bytes</div><div class="line">Variable Size            1426066712 bytes</div><div class="line">Database Buffers          117440512 bytes</div><div class="line">Redo Buffers                7544832 bytes</div><div class="line">Database mounted.</div><div class="line">SQL&gt; alter database create standby controlfile as '/tmp/standby_control01.ctl';</div><div class="line">Database altered.</div><div class="line">SQL&gt; alter database open;</div><div class="line">Database altered.</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h5 id="然后在备库建立对应的目录-并授权"><a href="#然后在备库建立对应的目录-并授权" class="headerlink" title="然后在备库建立对应的目录,并授权"></a>然后在备库建立对应的目录,并授权</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[oracle@srmclouddg software]$ mkdir -p /home/oracle/opt/oracle/oradata/srmcloud/</div><div class="line">[oracle@srmclouddg software]$ chown oracle:oinstall /home/oracle/opt/oracle/oradata/srmcloud</div></pre></td></tr></table></figure><p>拷贝主库的控制文件到备库</p><h4 id="db-name和db-unique-name"><a href="#db-name和db-unique-name" class="headerlink" title="db_name和db_unique_name"></a>db_name和db_unique_name</h4><p>默认db_name和db_unique_name和实例名是一致的，这里是srmcloud。需要注意在DG中主库和从库的db_unique_name是不能一致的，需要区分开的。这里我们设置主库的db_unique_name为srmcloud，从库为srmclouddg。</p><h5 id="查看db-unique-name"><a href="#查看db-unique-name" class="headerlink" title="查看db_unique_name"></a>查看db_unique_name</h5><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt; show parameter db_unique_name</div><div class="line">NAME             TYPE              VALUE</div><div class="line"><span class="comment">--------------   ---------------   ------------------  </span></div><div class="line">db_unique_name   string            srmcloud</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h5 id="设置db-unique-name"><a href="#设置db-unique-name" class="headerlink" title="设置db_unique_name"></a>设置db_unique_name</h5><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter system set db_unique_name=srmcloud scope=spfile;</div><div class="line">System altered.</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p><strong><em>注意虽然默认db_unique_name和db_name是一致的，但是需要显式设置，否则在spfile中没有此参数</em></strong></p><h4 id="闪回"><a href="#闪回" class="headerlink" title="闪回"></a>闪回</h4><p>略</p><h4 id="SQL-NET设置"><a href="#SQL-NET设置" class="headerlink" title="SQL*NET设置"></a>SQL*NET设置</h4><h5 id="配置主库监听-listener-ora"><a href="#配置主库监听-listener-ora" class="headerlink" title="配置主库监听(listener.ora)"></a>配置主库监听(listener.ora)</h5><p>虽然可以通过netca来进行配置，但是除了这个默认的外，我们还需要一个静态注册SID_LIST_LISTENER，如果没有此从参数，而且dataguard启动顺序不正确，主库会报PING[ARC1]:Heartbeat failed to connect to standby ‘<em>*</em>‘.Error is 12514导致归档无法完成<br>配置如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">LISTENER =</div><div class="line">  (DESCRIPTION_LIST =</div><div class="line">    (DESCRIPTION =</div><div class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = srmcloud)(PORT = 1521))</div><div class="line">    )</div><div class="line">  )</div><div class="line">SID_LIST_LISTENER=</div><div class="line">  (SID_LIST =</div><div class="line">    (SID_DESC =</div><div class="line">      (GLOBAL_DBNAME = srmcloud)</div><div class="line">      (ORACLE_HOME = /home/oracle/opt/oracle/product/11.2.0/dbhome_1)</div><div class="line">      (SID_NAME = srmcloud)</div><div class="line">    )</div><div class="line">  )</div></pre></td></tr></table></figure><h5 id="配置tns"><a href="#配置tns" class="headerlink" title="配置tns"></a>配置tns</h5><p>配置如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">SRMCLOUD =</div><div class="line">   (DESCRIPTION =</div><div class="line">     (ADDRESS_LIST =</div><div class="line">       (ADDRESS = (PROTOCOL = TCP)(HOST = 10.211.55.6)(PORT = 1521))</div><div class="line">     )</div><div class="line">     (CONNECT_DATA =</div><div class="line">       (SERVICE_NAME = srmcloud)</div><div class="line">     )</div><div class="line">   )</div><div class="line">SRMCLOUDDG =</div><div class="line">   (DESCRIPTION =</div><div class="line">     (ADDRESS_LIST =</div><div class="line">       (ADDRESS = (PROTOCOL = TCP)(HOST = 10.211.55.7)(PORT = 1521))</div><div class="line">     )</div><div class="line">     (CONNECT_DATA =</div><div class="line">       (SERVICE_NAME = srmclouddg)</div><div class="line">     )</div><div class="line">   )</div></pre></td></tr></table></figure><h5 id="传输到备库并修改listener-ora"><a href="#传输到备库并修改listener-ora" class="headerlink" title="传输到备库并修改listener.ora"></a>传输到备库并修改listener.ora</h5><p>如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">LISTENER =</div><div class="line">  (DESCRIPTION_LIST =</div><div class="line">    (DESCRIPTION =</div><div class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = srmclouddg)(PORT = 1521))</div><div class="line">    )</div><div class="line">  )</div><div class="line">SID_LIST_LISTENER=</div><div class="line">  (SID_LIST =</div><div class="line">    (SID_DESC =</div><div class="line">      (GLOBAL_DBNAME = srmclouddg)</div><div class="line">      (ORACLE_HOME = /home/oracle/opt/oracle/product/11.2.0/dbhome_1)</div><div class="line">      (SID_NAME = srmcloud)</div><div class="line">    )</div><div class="line">  )</div></pre></td></tr></table></figure><h4 id="日志传输配置"><a href="#日志传输配置" class="headerlink" title="日志传输配置"></a>日志传输配置</h4><h5 id="查看是否启用归档"><a href="#查看是否启用归档" class="headerlink" title="查看是否启用归档"></a>查看是否启用归档</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">SQL&gt; Archive log list;</div><div class="line">Database log mode              No Archive Mode</div><div class="line">Automatic archival             Disabled</div><div class="line">Archive destination            USE_DB_RECOVERY_FILE_DEST</div><div class="line">Oldest online log sequence     35</div><div class="line">Current log sequence           37</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h5 id="启用归档并设置归档日志路径"><a href="#启用归档并设置归档日志路径" class="headerlink" title="启用归档并设置归档日志路径"></a>启用归档并设置归档日志路径</h5><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter system set log_archive_dest_1='LOCATION=/home/oracle/opt/oracle/archive1 valid_for=(all_logfiles,primary_role) db_unique_name=srmcloud' scope=spfile;</div><div class="line">System altered.</div><div class="line">SQL&gt; shutdown immediate;</div><div class="line">Database closed.</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div><div class="line">SQL&gt; startup mount;</div><div class="line">ORACLE instance started.</div><div class="line">Total System Global Area 1553305600 bytes</div><div class="line">Fixed Size                  2253544 bytes</div><div class="line">Variable Size            1426066712 bytes</div><div class="line">Database Buffers          117440512 bytes</div><div class="line">Redo Buffers                7544832 bytes</div><div class="line">Database mounted.</div><div class="line">SQL&gt; alter database archivelog;</div><div class="line">Database altered.</div><div class="line">SQL&gt; alter database open;</div><div class="line">Database altered.</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h5 id="配置归档日志到备份库"><a href="#配置归档日志到备份库" class="headerlink" title="配置归档日志到备份库"></a>配置归档日志到备份库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter system set log_archive_dest_2=&apos;SERVICE=srmclouddg lgwr sync valid_for=(online_logfile,primary_role) db_unique_name=srmclouddg&apos;;</div><div class="line">System altered.</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p><strong><em>要注意STANDBY_ARCHIVE_DEST 参数不需要，已经被官方弃用。设置此参数后启动数据库，只会报 ORA-32004: obsolete or deprecated parameter(s) specified for RDBMS instance 错。</em></strong></p><h4 id="配置FAL-SERVER"><a href="#配置FAL-SERVER" class="headerlink" title="配置FAL_SERVER"></a>配置FAL_SERVER</h4><p>这个参数指定当日志传输出现问题时，备库到哪里去找缺少的归档日志。它用在备库接收的到的重做日志间有缺口的时候。这种情况会发生在日志传输出现中断时，比如你需要对备库进行维护操作。在备库维护期间，没有日志传输过来，这时缺口就出现了。设置了这个参数，备库就会主动去寻找那些缺少的日志，并要求主库进行传输。<br>你是主库,就填写:fal_server=从库<br>从库上就反过来:fal_server=主库<br><strong><em>注意:FAL_CLIENT在11g中已经废弃，虽然可以配置但是已经不起作用了</em></strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter system set FAL_SERVER=srmclouddg;</div><div class="line">System altered.</div></pre></td></tr></table></figure><h4 id="Data-Guard-配置里的另外一个库的名字"><a href="#Data-Guard-配置里的另外一个库的名字" class="headerlink" title="Data Guard 配置里的另外一个库的名字"></a>Data Guard 配置里的另外一个库的名字</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter system set log_archive_config = &apos;dg_config=(srmcloud,srmclouddg)&apos;;</div><div class="line">System altered.</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; create pfile from spfile;</div></pre></td></tr></table></figure><p>手工修改pfile，如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">srmcloud.__db_cache_size=687865856</div><div class="line">srmcloud.__java_pool_size=16777216</div><div class="line">srmcloud.__large_pool_size=33554432</div><div class="line">srmcloud.__oracle_base=&apos;/home/oracle/opt/oracle&apos;#ORACLE_BASE set from environment</div><div class="line">srmcloud.__pga_aggregate_target=469762048</div><div class="line">srmcloud.__sga_target=1090519040</div><div class="line">srmcloud.__shared_io_pool_size=0</div><div class="line">srmcloud.__shared_pool_size=335544320</div><div class="line">srmcloud.__streams_pool_size=0</div><div class="line">*.audit_file_dest=&apos;/home/oracle/opt/oracle/admin/srmcloud/adump&apos;</div><div class="line">*.audit_trail=&apos;db&apos;</div><div class="line">*.compatible=&apos;11.2.0.4.0&apos;</div><div class="line">*.control_files=&apos;/home/oracle/opt/oracle/oradata/srmcloud/control01.ctl&apos;,&apos;/home/oracle/opt/oracle/oradata/srmcloud/control02.ctl&apos;</div><div class="line">*.db_block_size=32768</div><div class="line">*.db_domain=&apos;&apos;</div><div class="line">*.db_name=&apos;srmcloud&apos;</div><div class="line">*.db_recovery_file_dest=&apos;/home/oracle/opt/oracle/fast_recovery_area&apos;</div><div class="line">*.db_recovery_file_dest_size=5218762752</div><div class="line">*.db_unique_name=&apos;SRMCLOUD&apos;</div><div class="line">*.diagnostic_dest=&apos;/home/oracle/opt/oracle&apos;</div><div class="line">*.dispatchers=&apos;(PROTOCOL=TCP) (SERVICE=srmcloudXDB)&apos;</div><div class="line">*.fal_server=&apos;SRMCLOUDDG&apos;</div><div class="line">*.job_queue_processes=1000</div><div class="line">*.log_archive_config=&apos;dg_config=(srmcloud,srmclouddg)&apos;</div><div class="line">*.log_archive_dest_1=&apos;LOCATION=/home/oracle/opt/oracle/archive1 valid_for=(all_logfiles,primary_role) db_unique_name=srmcloud&apos;</div><div class="line">*.log_archive_dest_2=&apos;SERVICE=srmclouddg lgwr sync valid_for=(online_logfile,primary_role) db_unique_name=srmclouddg&apos;</div><div class="line">*.log_archive_dest_state_1=enable</div><div class="line">*.log_archive_dest_state_2=enable</div><div class="line">*.log_archive_format=&apos;srmcloud_%t_%s_%r.dbf&apos;</div><div class="line">*.memory_target=1546649600</div><div class="line">*.open_cursors=300</div><div class="line">*.processes=1500</div><div class="line">*.remote_login_passwordfile=&apos;EXCLUSIVE&apos;</div><div class="line">*.sessions=1655</div><div class="line">*.standby_file_management=&apos;AUTO&apos;</div><div class="line">*.undo_tablespace=&apos;UNDOTBS1&apos;</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">SQL&gt; shutdown immediate;</div><div class="line">Database closed.</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div><div class="line">SQL&gt; create spfile from pfile;</div><div class="line">File created.</div><div class="line">SQL&gt; startup;</div><div class="line">ORACLE instance started.</div><div class="line">Total System Global Area 1553305600 bytes</div><div class="line">Fixed Size                  2253544 bytes</div><div class="line">Variable Size            1426066712 bytes</div><div class="line">Database Buffers          117440512 bytes</div><div class="line">Redo Buffers                7544832 bytes</div><div class="line">Database mounted.</div><div class="line">Database opened.</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h4 id="传输pfile到备库并修改"><a href="#传输pfile到备库并修改" class="headerlink" title="传输pfile到备库并修改"></a>传输pfile到备库并修改</h4><p>只需修改如下项即可:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">*.db_name=&apos;srmcloud&apos;</div><div class="line">*.db_unique_name=&apos;SRMCLOUDDG&apos;</div><div class="line">*.fal_server=&apos;SRMCLOUD&apos;</div><div class="line">*.log_archive_config=&apos;dg_config=(srmclouddg,srmcloud)&apos;</div><div class="line">*.log_archive_dest_1=&apos;LOCATION=/home/oracle/opt/oracle/archive1 valid_for=(all_logfiles,primary_role) db_unique_name=srmclouddg&apos;</div><div class="line">*.log_archive_dest_2=&apos;SERVICE=srmcloud lgwr sync valid_for=(online_logfile,primary_role) db_unique_name=srmcloud&apos;</div></pre></td></tr></table></figure><h4 id="传输主库数据到备库"><a href="#传输主库数据到备库" class="headerlink" title="传输主库数据到备库"></a>传输主库数据到备库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[oracle@srmcloud ~]$ scp -rp /home/oracle/opt/oracle/oradata/srmcloud/ oracle@10.211.55.7:/home/oracle/opt/oracle/oradata/</div></pre></td></tr></table></figure><p>建立相关目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@srmclouddg srmcloud]# mkdir -p  /home/oracle/opt/oracle/admin/srmcloud/</div><div class="line">[root@srmclouddg srmcloud]# cd  /home/oracle/opt/oracle/admin/srmcloud/</div><div class="line">[root@srmclouddg srmcloud]# pwd</div><div class="line">/home/oracle/opt/oracle/admin/srmcloud</div><div class="line">[root@srmclouddg srmcloud]# mkdir adump dpdump pfile</div><div class="line">[root@srmclouddg srmcloud]# ll</div><div class="line">total 12</div><div class="line">drwxr-xr-x 2 root root 4096 Dec 28 21:38 adump</div><div class="line">drwxr-xr-x 2 root root 4096 Dec 28 21:38 dpdump</div><div class="line">drwxr-xr-x 2 root root 4096 Dec 28 21:38 pfile</div><div class="line">[root@srmclouddg srmcloud]# chown -R  oracle:oinstall /home/oracle/opt/oracle/admin</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[oracle@srmclouddg dbs]$ mkdir -p /home/oracle/opt/oracle/fast_recovery_area</div></pre></td></tr></table></figure><h4 id="使用pfile启动备库到nomount"><a href="#使用pfile启动备库到nomount" class="headerlink" title="使用pfile启动备库到nomount"></a>使用pfile启动备库到nomount</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">SQL&gt; startup nomount pfile=&apos;/home/oracle/opt/oracle/product/11.2.0/dbhome_1/dbs/initsrmcloud.ora&apos;;</div><div class="line">ORACLE instance started.</div><div class="line">Total System Global Area 1553305600 bytes</div><div class="line">Fixed Size                  2253544 bytes</div><div class="line">Variable Size            1426066712 bytes</div><div class="line">Database Buffers          117440512 bytes</div><div class="line">Redo Buffers                7544832 bytes</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p><strong><em>注意：要启动备库监听</em></strong></p><h4 id="Duplicate复制主库到备库"><a href="#Duplicate复制主库到备库" class="headerlink" title="Duplicate复制主库到备库"></a>Duplicate复制主库到备库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div></pre></td><td class="code"><pre><div class="line">[oracle@srmcloud ~]$ rman target sys/handhand@SRMCLOUD auxiliary sys/handhand@SRMCLOUDDG</div><div class="line">Recovery Manager: Release 11.2.0.4.0 - Production on Thu Dec 28 23:11:34 2017</div><div class="line">Copyright (c) 1982, 2011, Oracle and/or its affiliates.  All rights reserved.</div><div class="line">connected to target database: SRMCLOUD (DBID=3572656870)</div><div class="line">connected to auxiliary database: SRMCLOUD (not mounted)</div><div class="line">RMAN&gt; duplicate target database for standby from active database spfile set db_unique_name &apos;SRMCLOUD&apos; nofilenamecheck;</div><div class="line">Starting Duplicate Db at 28-DEC-17</div><div class="line">using target database control file instead of recovery catalog</div><div class="line">allocated channel: ORA_AUX_DISK_1</div><div class="line">channel ORA_AUX_DISK_1: SID=10 device type=DISK</div><div class="line">contents of Memory Script:</div><div class="line">&#123;</div><div class="line">   backup as copy reuse</div><div class="line">   targetfile  &apos;/home/oracle/opt/oracle/product/11.2.0/dbhome_1/dbs/orapwsrmcloud&apos; auxiliary format</div><div class="line"> &apos;/home/oracle/opt/oracle/product/11.2.0/dbhome_1/dbs/orapwsrmcloud&apos;   targetfile</div><div class="line"> &apos;/home/oracle/opt/oracle/product/11.2.0/dbhome_1/dbs/spfilesrmcloud.ora&apos; auxiliary format</div><div class="line"> &apos;/home/oracle/opt/oracle/product/11.2.0/dbhome_1/dbs/spfilesrmcloud.ora&apos;   ;</div><div class="line">   sql clone &quot;alter system set spfile= &apos;&apos;/home/oracle/opt/oracle/product/11.2.0/dbhome_1/dbs/spfilesrmcloud.ora&apos;&apos;&quot;;</div><div class="line">&#125;</div><div class="line">executing Memory Script</div><div class="line">Starting backup at 28-DEC-17</div><div class="line">allocated channel: ORA_DISK_1</div><div class="line">channel ORA_DISK_1: SID=1157 device type=DISK</div><div class="line">Finished backup at 28-DEC-17</div><div class="line">sql statement: alter system set spfile= &apos;&apos;/home/oracle/opt/oracle/product/11.2.0/dbhome_1/dbs/spfilesrmcloud.ora&apos;&apos;</div><div class="line">contents of Memory Script:</div><div class="line">&#123;</div><div class="line">   sql clone &quot;alter system set  db_unique_name =</div><div class="line"> &apos;&apos;SRMCLOUD&apos;&apos; comment=</div><div class="line"> &apos;&apos;&apos;&apos; scope=spfile&quot;;</div><div class="line">   shutdown clone immediate;</div><div class="line">   startup clone nomount;</div><div class="line">&#125;</div><div class="line">executing Memory Script</div><div class="line">sql statement: alter system set  db_unique_name =  &apos;&apos;SRMCLOUD&apos;&apos; comment= &apos;&apos;&apos;&apos; scope=spfile</div><div class="line">Oracle instance shut down</div><div class="line">connected to auxiliary database (not started)</div><div class="line">Oracle instance started</div><div class="line">Total System Global Area    1553305600 bytes</div><div class="line">Fixed Size                     2253544 bytes</div><div class="line">Variable Size               1426066712 bytes</div><div class="line">Database Buffers             117440512 bytes</div><div class="line">Redo Buffers                   7544832 bytes</div><div class="line">contents of Memory Script:</div><div class="line">&#123;</div><div class="line">   backup as copy current controlfile for standby auxiliary format  &apos;/home/oracle/opt/oracle/oradata/srmcloud/control01.ctl&apos;;</div><div class="line">   restore clone controlfile to  &apos;/home/oracle/opt/oracle/oradata/srmcloud/control02.ctl&apos; from</div><div class="line"> &apos;/home/oracle/opt/oracle/oradata/srmcloud/control01.ctl&apos;;</div><div class="line">&#125;</div><div class="line">executing Memory Script</div><div class="line">Starting backup at 28-DEC-17</div><div class="line">using channel ORA_DISK_1</div><div class="line">channel ORA_DISK_1: starting datafile copy</div><div class="line">copying standby control file</div><div class="line">output file name=/home/oracle/opt/oracle/product/11.2.0/dbhome_1/dbs/snapcf_srmcloud.f tag=TAG20171228T231151 RECID=3 STAMP=963961911</div><div class="line">channel ORA_DISK_1: datafile copy complete, elapsed time: 00:00:01</div><div class="line">Finished backup at 28-DEC-17</div><div class="line">Starting restore at 28-DEC-17</div><div class="line">allocated channel: ORA_AUX_DISK_1</div><div class="line">channel ORA_AUX_DISK_1: SID=9 device type=DISK</div><div class="line">channel ORA_AUX_DISK_1: copied control file copy</div><div class="line">Finished restore at 28-DEC-17</div><div class="line">contents of Memory Script:</div><div class="line">&#123;</div><div class="line">   sql clone &apos;alter database mount standby database&apos;;</div><div class="line">&#125;</div><div class="line">executing Memory Script</div><div class="line">sql statement: alter database mount standby database</div><div class="line">RMAN-05538: WARNING: implicitly using DB_FILE_NAME_CONVERT</div><div class="line">contents of Memory Script:</div><div class="line">&#123;   set newname for tempfile  1 to</div><div class="line"> &quot;/home/oracle/opt/oracle/oradata/srmcloud/temp01.dbf&quot;;</div><div class="line">   switch clone tempfile all;</div><div class="line">   set newname for datafile  1 to</div><div class="line"> &quot;/home/oracle/opt/oracle/oradata/srmcloud/system01.dbf&quot;;</div><div class="line">   set newname for datafile  2 to</div><div class="line"> &quot;/home/oracle/opt/oracle/oradata/srmcloud/sysaux01.dbf&quot;;</div><div class="line">   set newname for datafile  3 to</div><div class="line"> &quot;/home/oracle/opt/oracle/oradata/srmcloud/undotbs01.dbf&quot;;</div><div class="line">   set newname for datafile  4 to</div><div class="line"> &quot;/home/oracle/opt/oracle/oradata/srmcloud/users01.dbf&quot;;</div><div class="line">   backup as copy reuse</div><div class="line">   datafile  1 auxiliary format</div><div class="line"> &quot;/home/oracle/opt/oracle/oradata/srmcloud/system01.dbf&quot;   datafile</div><div class="line"> 2 auxiliary format</div><div class="line"> &quot;/home/oracle/opt/oracle/oradata/srmcloud/sysaux01.dbf&quot;   datafile</div><div class="line"> 3 auxiliary format</div><div class="line"> &quot;/home/oracle/opt/oracle/oradata/srmcloud/undotbs01.dbf&quot;   datafile</div><div class="line"> 4 auxiliary format</div><div class="line"> &quot;/home/oracle/opt/oracle/oradata/srmcloud/users01.dbf&quot;   ;</div><div class="line">   sql &apos;alter system archive log current&apos;;</div><div class="line">&#125;</div><div class="line">executing Memory Script</div><div class="line">executing command: SET NEWNAME</div><div class="line">renamed tempfile 1 to /home/oracle/opt/oracle/oradata/srmcloud/temp01.dbf in control file</div><div class="line">executing command: SET NEWNAME</div><div class="line">executing command: SET NEWNAME</div><div class="line">executing command: SET NEWNAME</div><div class="line">executing command: SET NEWNAME</div><div class="line">Starting backup at 28-DEC-17</div><div class="line">using channel ORA_DISK_1</div><div class="line">channel ORA_DISK_1: starting datafile copy</div><div class="line">input datafile file number=00002 name=/home/oracle/opt/oracle/oradata/srmcloud/sysaux01.dbf</div><div class="line">output file name=/home/oracle/opt/oracle/oradata/srmcloud/sysaux01.dbf tag=TAG20171228T231202</div><div class="line">channel ORA_DISK_1: datafile copy complete, elapsed time: 00:00:15</div><div class="line">channel ORA_DISK_1: starting datafile copy</div><div class="line">input datafile file number=00003 name=/home/oracle/opt/oracle/oradata/srmcloud/undotbs01.dbf</div><div class="line">output file name=/home/oracle/opt/oracle/oradata/srmcloud/undotbs01.dbf tag=TAG20171228T231202</div><div class="line">channel ORA_DISK_1: datafile copy complete, elapsed time: 00:00:15</div><div class="line">channel ORA_DISK_1: starting datafile copy</div><div class="line">input datafile file number=00001 name=/home/oracle/opt/oracle/oradata/srmcloud/system01.dbf</div><div class="line">output file name=/home/oracle/opt/oracle/oradata/srmcloud/system01.dbf tag=TAG20171228T231202</div><div class="line">channel ORA_DISK_1: datafile copy complete, elapsed time: 00:00:07</div><div class="line">channel ORA_DISK_1: starting datafile copy</div><div class="line">input datafile file number=00004 name=/home/oracle/opt/oracle/oradata/srmcloud/users01.dbf</div><div class="line">output file name=/home/oracle/opt/oracle/oradata/srmcloud/users01.dbf tag=TAG20171228T231202</div><div class="line">channel ORA_DISK_1: datafile copy complete, elapsed time: 00:00:01</div><div class="line">Finished backup at 28-DEC-17</div><div class="line">sql statement: alter system archive log current</div><div class="line">contents of Memory Script:</div><div class="line">&#123;</div><div class="line">   switch clone datafile all;</div><div class="line">&#125;</div><div class="line">executing Memory Script</div><div class="line">datafile 1 switched to datafile copy</div><div class="line">input datafile copy RECID=3 STAMP=963961972 file name=/home/oracle/opt/oracle/oradata/srmcloud/system01.dbf</div><div class="line">datafile 2 switched to datafile copy</div><div class="line">input datafile copy RECID=4 STAMP=963961972 file name=/home/oracle/opt/oracle/oradata/srmcloud/sysaux01.dbf</div><div class="line">datafile 3 switched to datafile copy</div><div class="line">input datafile copy RECID=5 STAMP=963961972 file name=/home/oracle/opt/oracle/oradata/srmcloud/undotbs01.dbf</div><div class="line">datafile 4 switched to datafile copy</div><div class="line">input datafile copy RECID=6 STAMP=963961972 file name=/home/oracle/opt/oracle/oradata/srmcloud/users01.dbf</div><div class="line">Finished Duplicate Db at 28-DEC-17</div><div class="line">RMAN&gt; quit</div></pre></td></tr></table></figure><h4 id="关闭，并使用pfile重启数据库，并创建spfile"><a href="#关闭，并使用pfile重启数据库，并创建spfile" class="headerlink" title="关闭，并使用pfile重启数据库，并创建spfile"></a>关闭，并使用pfile重启数据库，并创建spfile</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">SQL&gt; shutdown immediate;</div><div class="line">ORA-01109: database not open</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div><div class="line">SQL&gt; startup nomount pfile=&apos;/home/oracle/opt/oracle/product/11.2.0/dbhome_1/dbs/initsrmcloud.ora&apos;;</div><div class="line">ORACLE instance started.</div><div class="line">Total System Global Area 1553305600 bytes</div><div class="line">Fixed Size                  2253544 bytes</div><div class="line">Variable Size            1426066712 bytes</div><div class="line">Database Buffers          117440512 bytes</div><div class="line">Redo Buffers                7544832 bytes</div><div class="line">SQL&gt; alter database mount standby database;</div><div class="line">Database altered.</div><div class="line">SQL&gt; show parameter db_unique_name</div><div class="line">NAME                                 TYPE</div><div class="line">------------------------------------ ---------------------------------</div><div class="line">VALUE</div><div class="line">------------------------------</div><div class="line">db_unique_name                       string</div><div class="line">SRMCLOUDDG</div><div class="line">SQL&gt; create spfile from pfile;</div><div class="line">File created.</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h4 id="关闭数据库，使用spfile重启数据库"><a href="#关闭数据库，使用spfile重启数据库" class="headerlink" title="关闭数据库，使用spfile重启数据库"></a>关闭数据库，使用spfile重启数据库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">SQL&gt; shutdown immediate;</div><div class="line">ORA-01109: database not open</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div><div class="line">SQL&gt; startup nomount;</div><div class="line">ORACLE instance started.</div><div class="line">Total System Global Area 1553305600 bytes</div><div class="line">Fixed Size                  2253544 bytes</div><div class="line">Variable Size            1426066712 bytes</div><div class="line">Database Buffers          117440512 bytes</div><div class="line">Redo Buffers                7544832 bytes</div><div class="line">SQL&gt; alter database mount standby database;</div><div class="line">Database altered.</div><div class="line">SQL&gt; alter database open read only;</div><div class="line">Database altered.</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h4 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select SEQUENCE#,FIRST_TIME,NEXT_TIME ,APPLIED from v$archived_log order by 1;</div><div class="line"> SEQUENCE# FIRST_TIME      NEXT_TIME       APPLIED</div><div class="line">---------- --------------- --------------- ---------------------------</div><div class="line">        40 28-DEC-17       28-DEC-17       NO</div><div class="line">        41 28-DEC-17       28-DEC-17       NO</div><div class="line">        42 28-DEC-17       28-DEC-17       NO</div><div class="line">        43 28-DEC-17       28-DEC-17       NO</div><div class="line">        44 28-DEC-17       28-DEC-17       NO</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p>已接收，但未应用</p><h4 id="开启备库日志应用"><a href="#开启备库日志应用" class="headerlink" title="开启备库日志应用"></a>开启备库日志应用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter database recover managed standby database using current logfile disconnect from session;</div><div class="line">Database altered.</div><div class="line">SQL&gt; select SEQUENCE#,FIRST_TIME,NEXT_TIME ,APPLIED from v$archived_log order by 1;</div><div class="line"> SEQUENCE# FIRST_TIME      NEXT_TIME       APPLIED</div><div class="line">---------- --------------- --------------- ---------------------------</div><div class="line">        40 28-DEC-17       28-DEC-17       YES</div><div class="line">        41 28-DEC-17       28-DEC-17       YES</div><div class="line">        42 28-DEC-17       28-DEC-17       YES</div><div class="line">        43 28-DEC-17       28-DEC-17       YES</div><div class="line">        44 28-DEC-17       28-DEC-17       YES</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><h4 id="数据传输验证"><a href="#数据传输验证" class="headerlink" title="数据传输验证"></a>数据传输验证</h4><h5 id="在主库创建用户"><a href="#在主库创建用户" class="headerlink" title="在主库创建用户"></a>在主库创建用户</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">SQL&gt;  create user test identified by test;</div><div class="line">User created.</div><div class="line">SQL&gt; select username from dba_users where username=&apos;TEST&apos;;</div><div class="line">USERNAME</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">TEST</div></pre></td></tr></table></figure><h5 id="在备库查询TEST用户是否存在"><a href="#在备库查询TEST用户是否存在" class="headerlink" title="在备库查询TEST用户是否存在"></a>在备库查询TEST用户是否存在</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select username from dba_users where username=&apos;TEST&apos;;</div><div class="line">USERNAME</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">TEST</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p>dg数据传输正常</p><h4 id="主备切换验证"><a href="#主备切换验证" class="headerlink" title="主备切换验证"></a>主备切换验证</h4><p>#####主库切换为备库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter database commit to switchover to physical standby with session shutdown;</div><div class="line">Database altered.</div><div class="line">SQL&gt; startup mount;</div><div class="line">ORACLE instance started.</div><div class="line">Total System Global Area 1553305600 bytes</div><div class="line">Fixed Size                  2253544 bytes</div><div class="line">Variable Size            1426066712 bytes</div><div class="line">Database Buffers          117440512 bytes</div><div class="line">Redo Buffers                7544832 bytes</div><div class="line">Database mounted.</div><div class="line">SQL&gt; select database_role from v$database;</div><div class="line">DATABASE_ROLE</div><div class="line">------------------------------------------------</div><div class="line">PHYSICAL STANDBY</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h5 id="备库切换为主库"><a href="#备库切换为主库" class="headerlink" title="备库切换为主库"></a>备库切换为主库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select database_role from v$database;</div><div class="line">DATABASE_ROLE</div><div class="line">------------------------------------------------</div><div class="line">PHYSICAL STANDBY</div><div class="line">SQL&gt; select open_mode from v$database;</div><div class="line">OPEN_MODE</div><div class="line">------------------------------------------------------------</div><div class="line">READ ONLY WITH APPLY</div><div class="line">SQL&gt; alter database commit to switchover to primary with session shutdown;</div><div class="line">Database altered.</div><div class="line">SQL&gt; select database_role from v$database;</div><div class="line">DATABASE_ROLE</div><div class="line">------------------------------------------------</div><div class="line">PRIMARY</div><div class="line">SQL&gt; select open_mode from v$database;</div><div class="line">OPEN_MODE</div><div class="line">------------------------------------------------------------</div><div class="line">MOUNTED</div><div class="line">SQL&gt; alter database open;</div><div class="line">Database altered.</div><div class="line">SQL&gt; select open_mode from v$database;</div><div class="line">OPEN_MODE</div><div class="line">------------------------------------------------------------</div><div class="line">READ WRITE</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><h5 id="启动原主库-现在为备库-为read-only模式，并启用日志自动应用"><a href="#启动原主库-现在为备库-为read-only模式，并启用日志自动应用" class="headerlink" title="启动原主库(现在为备库)为read only模式，并启用日志自动应用"></a>启动原主库(现在为备库)为read only模式，并启用日志自动应用</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter database open read only;</div><div class="line">Database altered.</div><div class="line">SQL&gt; alter database recover managed standby database using current logfile disconnect from session;</div><div class="line">Database altered.</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p>至此，DG配置完成</p><h3 id="管理"><a href="#管理" class="headerlink" title="管理"></a>管理</h3><p>dataguard启动关闭顺序</p><h4 id="监听"><a href="#监听" class="headerlink" title="监听"></a>监听</h4><p>先启从库再起主库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lsnrctl start</div></pre></td></tr></table></figure><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><h5 id="先起从库"><a href="#先起从库" class="headerlink" title="先起从库"></a>先起从库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sql&gt;startup nomount</div><div class="line">sql&gt;alter database mount standby database;</div><div class="line">sql&gt;alter database open read only;</div><div class="line">sql&gt;alter database recover managed standby database using current logfile disconnect from session;</div></pre></td></tr></table></figure><h5 id="再启主库"><a href="#再启主库" class="headerlink" title="再启主库"></a>再启主库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sql&gt;startup</div></pre></td></tr></table></figure><h4 id="关闭-和开启正好相反"><a href="#关闭-和开启正好相反" class="headerlink" title="关闭(和开启正好相反)"></a>关闭(和开启正好相反)</h4><h5 id="先关主库："><a href="#先关主库：" class="headerlink" title="先关主库："></a>先关主库：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sql&gt;shutdown immediate</div></pre></td></tr></table></figure><h5 id="再关从库："><a href="#再关从库：" class="headerlink" title="再关从库："></a>再关从库：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sql&gt;alter database recover managed standby database cancel;</div><div class="line">sql&gt;shutdown immediate;</div></pre></td></tr></table></figure><h3 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h3><p>介绍一篇dg文章，写的比我好</p><p><a href="https://community.oracle.com/docs/DOC-1007058" target="_blank" rel="external">https://community.oracle.com/docs/DOC-1007058</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;DG的配置过程，参考了如下两篇文章：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cnblogs.com/tippoint/archive/2013/04/18/3029019.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.cnblogs.com/tippoint/archive/2013/04/18/3029019.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.itpub.net/29324876/viewspace-1246133/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.itpub.net/29324876/viewspace-1246133/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;主库IP:10.211.55.6&lt;/p&gt;
&lt;p&gt;备库IP:10.211.55.7&lt;/p&gt;
&lt;p&gt;安装之前使用如下命令同步主备库的时间&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;ntpdate -u 0.centos.pool.ntp.org&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="oracle" scheme="https://shijieqin.github.io/categories/oracle/"/>
    
      <category term="dataguard" scheme="https://shijieqin.github.io/categories/oracle/dataguard/"/>
    
    
      <category term="oracle" scheme="https://shijieqin.github.io/tags/oracle/"/>
    
      <category term="dataguard" scheme="https://shijieqin.github.io/tags/dataguard/"/>
    
  </entry>
  
  <entry>
    <title>oracle 12C 单实例PDB插入到RAC环境下出现的问题</title>
    <link href="https://shijieqin.github.io/2017/12/24/oracle-12C-%E5%8D%95%E5%AE%9E%E4%BE%8BPDB%E6%8F%92%E5%85%A5%E5%88%B0RAC%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>https://shijieqin.github.io/2017/12/24/oracle-12C-单实例PDB插入到RAC环境下出现的问题/</id>
    <published>2017-12-24T03:49:33.000Z</published>
    <updated>2017-12-24T03:49:33.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>本文记录在oracle 12C，通过pdb插拔的方式将单实例转换为rac环境出现的问题。</p><a id="more"></a><h3 id="undo表空间被占用"><a href="#undo表空间被占用" class="headerlink" title="undo表空间被占用"></a>undo表空间被占用</h3><h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4><p>在迁移过程中，由于修改过源pdb的默认undo表空间，导致插入到rac环境的时候，出现undo表空间被占用的情况。</p><p><strong><em>注：这里，使用的是local undo的模式</em></strong></p><h4 id="问题重现"><a href="#问题重现" class="headerlink" title="问题重现"></a>问题重现</h4><h5 id="切换至测试pdb"><a href="#切换至测试pdb" class="headerlink" title="切换至测试pdb"></a>切换至测试pdb</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter session set container = TEST;</div><div class="line">Session altered.</div></pre></td></tr></table></figure><h5 id="查询默认undo表空间，及数据文件位置"><a href="#查询默认undo表空间，及数据文件位置" class="headerlink" title="查询默认undo表空间，及数据文件位置"></a>查询默认undo表空间，及数据文件位置</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select tablespace_name,</div><div class="line">       file_name,</div><div class="line">       AUTOEXTENSIBLE,</div><div class="line">       bytes / 1024 / 1024 size_mb</div><div class="line">  from dba_data_files</div><div class="line"> where tablespace_name like '%UNDO%'; </div><div class="line">TABLESPACE_NAME    FILE_NAME                                              AUTOEXTEN    SIZE_MB</div><div class="line"><span class="comment">---------------    ---------------------------------------------------    ---------    ----------</span></div><div class="line">UNDOTBS1           /u01/app/oracle/oradata/SRMCLOUD/test/undotbs01.dbf    YES          1515</div></pre></td></tr></table></figure><h5 id="修改默认undo表空间"><a href="#修改默认undo表空间" class="headerlink" title="修改默认undo表空间"></a>修改默认undo表空间</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">SQL&gt; create undo tablespace undotbs2 datafile '/u01/app/oracle/oradata/SRMCLOUD/test/undotbs02.dbf' size 100m autoextend on;</div><div class="line">Tablespace created.</div><div class="line">SQL&gt; alter system set undo_tablespace='UNDOTBS2' scope=both;</div><div class="line">System altered.</div><div class="line">SQL&gt; drop tablespace UNDOTBS1 including contents and datafiles;</div><div class="line">Tablespace dropped.</div><div class="line">SQL&gt; show parameter undo</div><div class="line">NAME                                 TYPE                                 VALUE</div><div class="line"><span class="comment">------------------------------------ ---------------------------------    ------------------------------</span></div><div class="line">temp_undo_enabled                    boolean                              FALSE</div><div class="line">undo_management                      string                               AUTO</div><div class="line">undo_retention                       integer                              900</div><div class="line">undo_tablespace                      string                               UNDOTBS2</div></pre></td></tr></table></figure><h5 id="切换回CDB"><a href="#切换回CDB" class="headerlink" title="切换回CDB"></a>切换回CDB</h5><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter session set container = CDB$ROOT</div></pre></td></tr></table></figure><h5 id="拔出测试PDB"><a href="#拔出测试PDB" class="headerlink" title="拔出测试PDB"></a>拔出测试PDB</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter pluggable database TEST close immediate;</div><div class="line">Pluggable database altered.</div><div class="line">SQL&gt; alter pluggable database TEST unplug into '/u01/app/oracle/oradata/SRMCLOUD/test.xml';</div><div class="line">Pluggable database altered.</div><div class="line">SQL&gt; drop pluggable database TEST KEEP DATAFILES;</div><div class="line">Pluggable database dropped.</div></pre></td></tr></table></figure><h5 id="在rac下插入pdb"><a href="#在rac下插入pdb" class="headerlink" title="在rac下插入pdb"></a>在rac下插入pdb</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SQL&gt; CREATE PLUGGABLE DATABASE test USING '/u01/app/oracle/test.xml' SOURCE_FILE_NAME_CONVERT = ('/u01/app/oracle/oradata/SRMCLOUD/test/', '/u01/app/oracle/test/') MOVE FILE_NAME_CONVERT = ('/u01/app/oracle/test/', '+DATA/srmcloud/test/');</div><div class="line">Pluggable database created.</div></pre></td></tr></table></figure><h5 id="启动新插入的pdb"><a href="#启动新插入的pdb" class="headerlink" title="启动新插入的pdb"></a>启动新插入的pdb</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter pluggable database TEST open instances=all;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">pluggable</span> <span class="keyword">database</span> <span class="keyword">TEST</span> <span class="keyword">open</span> instances=all</div><div class="line">*</div><div class="line"><span class="keyword">ERROR</span> <span class="keyword">at</span> line <span class="number">1</span>:</div><div class="line">ORA<span class="number">-65107</span>: <span class="keyword">Error</span> encountered <span class="keyword">when</span> processing the <span class="keyword">current</span> task <span class="keyword">on</span> <span class="keyword">instance</span>:<span class="number">1</span></div><div class="line">ORA<span class="number">-30013</span>: <span class="keyword">undo</span> <span class="keyword">tablespace</span> <span class="string">'UNDOTBS2'</span> <span class="keyword">is</span> currently <span class="keyword">in</span> <span class="keyword">use</span></div></pre></td></tr></table></figure><h5 id="问题描述2"><a href="#问题描述2" class="headerlink" title="问题描述2"></a>问题描述2</h5><p>以上就重现了错误过程。</p><p>刚开始只是以为更改了默认undo表空间的名称，导致在插入oracle rac环境下的时候，oracle自动添加新的undo失败。(oracle 12c rac下，每个实例上的pdb使用的是不同的undo表空间)</p><p>针对以上猜想，尝试更改undo表空间为默认的名称后，重新插入，仍然失败</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter pluggable database TEST open instances=all;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">pluggable</span> <span class="keyword">database</span> <span class="keyword">TEST</span> <span class="keyword">open</span> instances=all</div><div class="line">*</div><div class="line"><span class="keyword">ERROR</span> <span class="keyword">at</span> line <span class="number">1</span>:</div><div class="line">ORA<span class="number">-65107</span>: <span class="keyword">Error</span> encountered <span class="keyword">when</span> processing the <span class="keyword">current</span> task <span class="keyword">on</span> <span class="keyword">instance</span>:<span class="number">1</span></div><div class="line">ORA<span class="number">-30013</span>: <span class="keyword">undo</span> <span class="keyword">tablespace</span> <span class="string">'UNDOTBS1'</span> <span class="keyword">is</span> currently <span class="keyword">in</span> <span class="keyword">use</span></div></pre></td></tr></table></figure><h5 id="发现原因"><a href="#发现原因" class="headerlink" title="发现原因"></a>发现原因</h5><p>通过对比修改前与修改后的拔出文件<strong>test.xml</strong>发现，修改后比修改前，在拔出文件中多了一行如下参数</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">spfile</span>&gt;</span>*.undo_tablespace='UNDOTBS1'<span class="tag">&lt;/<span class="name">spfile</span>&gt;</span></div></pre></td></tr></table></figure><p>由于这个参数的原因，导致pdb在插入的时候，统一把undo表空间指向为’UNDOTBS1’导致的。</p><p>解决方法就是，删除这一行数据即可。</p><h5 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SQL&gt;  alter pluggable database TEST open instances=all;</div><div class="line">Pluggable database altered.</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;本文记录在oracle 12C，通过pdb插拔的方式将单实例转换为rac环境出现的问题。&lt;/p&gt;
    
    </summary>
    
      <category term="oracle 12C" scheme="https://shijieqin.github.io/categories/oracle-12C/"/>
    
      <category term="RAC" scheme="https://shijieqin.github.io/categories/oracle-12C/RAC/"/>
    
      <category term="PDB" scheme="https://shijieqin.github.io/categories/oracle-12C/RAC/PDB/"/>
    
    
      <category term="oracle 12C" scheme="https://shijieqin.github.io/tags/oracle-12C/"/>
    
      <category term="RAC" scheme="https://shijieqin.github.io/tags/RAC/"/>
    
      <category term="PDB" scheme="https://shijieqin.github.io/tags/PDB/"/>
    
  </entry>
  
  <entry>
    <title>RAC删除节点</title>
    <link href="https://shijieqin.github.io/2017/12/05/RAC%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9/"/>
    <id>https://shijieqin.github.io/2017/12/05/RAC删除节点/</id>
    <published>2017-12-05T05:59:58.000Z</published>
    <updated>2017-12-05T05:59:58.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>删除节点node03</p><p>其中：</p><ul><li>数据库名为orcl</li><li>node03的实例名为orcl3</li></ul><a id="more"></a><h3 id="停止node03的数据库实例"><a href="#停止node03的数据库实例" class="headerlink" title="停止node03的数据库实例"></a>停止node03的数据库实例</h3><p>在任意一个可用节点上，这里用node01，grid用户执行如下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">srvctl stop instance -d orcl -i orcl3</div></pre></td></tr></table></figure><h3 id="卸载node03上的数据库实例"><a href="#卸载node03上的数据库实例" class="headerlink" title="卸载node03上的数据库实例"></a>卸载node03上的数据库实例</h3><p>在任意一个可用节点上，这里用node01，oracle用户执行如下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dbca -silent -deleteInstance -nodeList node03 -gdbName orcl -instanceName orcl3 -sysDBAUserName sys -sysDBAPassword Hand1234</div></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[oracle@node01 ~]$ dbca -silent -deleteInstance -nodeList node03 -gdbName orcl -instanceName orcl3 -sysDBAUserName sys -sysDBAPassword Hand1234</div><div class="line">Deleting instance</div><div class="line">1% complete</div><div class="line">2% complete</div><div class="line">6% complete</div><div class="line">13% complete</div><div class="line">20% complete</div><div class="line">26% complete</div><div class="line">33% complete</div><div class="line">40% complete</div><div class="line">46% complete</div><div class="line">53% complete</div><div class="line">60% complete</div><div class="line">66% complete</div><div class="line">Completing instance management.</div><div class="line">100% complete</div><div class="line">Look at the log file &quot;/u01/app/oracle/cfgtoollogs/dbca/orcl0.log&quot; for further details.</div></pre></td></tr></table></figure><p>node01上，grid用户，执行如下命令验证是否删除</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">srvctl config database -d orcl</div></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">[grid@node01 ~]$ srvctl config database -d orcl</div><div class="line">Database unique name: orcl</div><div class="line">Database name: orcl</div><div class="line">Oracle home: /u01/app/oracle/product/12.2.0/dbhome_1</div><div class="line">Oracle user: oracle</div><div class="line">Spfile: +DATA/ORCL/PARAMETERFILE/spfile.277.961430953</div><div class="line">Password file: +DATA/ORCL/PASSWORD/pwdorcl.256.961427153</div><div class="line">Domain: myCluster.com</div><div class="line">Start options: open</div><div class="line">Stop options: immediate</div><div class="line">Database role: PRIMARY</div><div class="line">Management policy: AUTOMATIC</div><div class="line">Server pools:</div><div class="line">Disk Groups: DATA</div><div class="line">Mount point paths:</div><div class="line">Services:</div><div class="line">Type: RAC</div><div class="line">Start concurrency:</div><div class="line">Stop concurrency:</div><div class="line">OSDBA group: dba</div><div class="line">OSOPER group: oper</div><div class="line">Database instances: orcl1,orcl2</div><div class="line">Configured nodes: node01,node02</div><div class="line">CSS critical: no</div><div class="line">CPU count: 0</div><div class="line">Memory target: 0</div><div class="line">Maximum memory: 0</div><div class="line">Default network number for database services:</div><div class="line">Database is administrator managed</div></pre></td></tr></table></figure><p>重点关注 Database instance，发现没有orcl3</p><h3 id="停止node03的lisenter"><a href="#停止node03的lisenter" class="headerlink" title="停止node03的lisenter"></a>停止node03的lisenter</h3><p>在任意一个可用节点上，这里用node01，grid用户执行如下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">srvctl disable listener -l LISTENER -n node03</div><div class="line">srvctl stop listener -l LISTENER -n node03</div></pre></td></tr></table></figure><h3 id="在node1上更新inventory"><a href="#在node1上更新inventory" class="headerlink" title="在node1上更新inventory"></a>在node1上更新inventory</h3><p>node01，oracle用户，执行如下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[oracle@node01 ~]$ echo $ORACLE_HOME</div><div class="line">/u01/app/oracle/product/12.2.0/dbhome_1</div><div class="line">[oracle@node01 bin]$ cd $ORACLE_HOME/oui/bin</div><div class="line">[oracle@node01 bin]$ ./runInstaller -updatenodelist ORACLE_HOME=/u01/app/oracle/product/12.2.0/dbhome_1 &quot;CLUSTER_NODES=&#123;node01,node02&#125;&quot;</div><div class="line"></div><div class="line">Starting Oracle Universal Installer...</div><div class="line">Checking swap space: must be greater than 500 MB.   Actual 8191 MB    Passed</div><div class="line">The inventory pointer is located at /etc/oraInst.loc</div><div class="line">&apos;UpdateNodeList&apos; was successful.</div></pre></td></tr></table></figure><h3 id="在node03运行deinstall"><a href="#在node03运行deinstall" class="headerlink" title="在node03运行deinstall"></a>在node03运行deinstall</h3><p>node03，oracle用户，执行如下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[oracle@node03 ~]$ cd $ORACLE_HOME/deinstall </div><div class="line">[oracle@node03 deinstall]$ ./deinstall -local</div></pre></td></tr></table></figure><h3 id="GRID层面删除node03"><a href="#GRID层面删除node03" class="headerlink" title="GRID层面删除node03"></a>GRID层面删除node03</h3><h4 id="检查"><a href="#检查" class="headerlink" title="检查"></a>检查</h4><p>node01上，grid用户，执行如下面命令检查</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[grid@node01 ~]$ olsnodes -s -t</div><div class="line">node01  Active  Unpinned</div><div class="line">node02  Active  Unpinned</div><div class="line">node03  Active  Unpinned</div></pre></td></tr></table></figure><p>如果为node03pinned,使用如下命令设为Unpinned</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">crsctl unpin css-n node03</div></pre></td></tr></table></figure><h4 id="在node03节点执行以root用户执行deconfig"><a href="#在node03节点执行以root用户执行deconfig" class="headerlink" title="在node03节点执行以root用户执行deconfig"></a>在node03节点执行以root用户执行deconfig</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@node03 ~]# cd /u01/app/12.2.0/grid/crs/install/</div><div class="line">[root@node03 install]# ./rootcrs.sh -deconfig -deinstall -force</div></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">[root@node03 install]# ./rootcrs.sh -deconfig -deinstall -force</div><div class="line">Using configuration parameter file: /u01/app/12.2.0/grid/crs/install/crsconfig_params</div><div class="line">The log of current session can be found at:</div><div class="line">  /u01/app/grid/crsdata/node03/crsconfig/crsdeconfig_node03_2017-12-05_05-23-51PM.log</div><div class="line">CRS-2791: Starting shutdown of Oracle High Availability Services-managed resources on &apos;node03&apos;</div><div class="line">CRS-2673: Attempting to stop &apos;ora.crsd&apos; on &apos;node03&apos;</div><div class="line">CRS-2790: Starting shutdown of Cluster Ready Services-managed resources on server &apos;node03&apos;</div><div class="line">CRS-2673: Attempting to stop &apos;ora.DATA.dg&apos; on &apos;node03&apos;</div><div class="line">CRS-2673: Attempting to stop &apos;ora.OCR_VOT_GIMR.dg&apos; on &apos;node03&apos;</div><div class="line">CRS-2673: Attempting to stop &apos;ora.chad&apos; on &apos;node03&apos;</div><div class="line">CRS-2677: Stop of &apos;ora.OCR_VOT_GIMR.dg&apos; on &apos;node03&apos; succeeded</div><div class="line">CRS-2677: Stop of &apos;ora.DATA.dg&apos; on &apos;node03&apos; succeeded</div><div class="line">CRS-2673: Attempting to stop &apos;ora.asm&apos; on &apos;node03&apos;</div><div class="line">CRS-2677: Stop of &apos;ora.asm&apos; on &apos;node03&apos; succeeded</div><div class="line">CRS-2673: Attempting to stop &apos;ora.ASMNET1LSNR_ASM.lsnr&apos; on &apos;node03&apos;</div><div class="line">CRS-2677: Stop of &apos;ora.chad&apos; on &apos;node03&apos; succeeded</div><div class="line">CRS-2677: Stop of &apos;ora.ASMNET1LSNR_ASM.lsnr&apos; on &apos;node03&apos; succeeded</div><div class="line">CRS-2792: Shutdown of Cluster Ready Services-managed resources on &apos;node03&apos; has completed</div><div class="line">CRS-2677: Stop of &apos;ora.crsd&apos; on &apos;node03&apos; succeeded</div><div class="line">CRS-2673: Attempting to stop &apos;ora.asm&apos; on &apos;node03&apos;</div><div class="line">CRS-2673: Attempting to stop &apos;ora.crf&apos; on &apos;node03&apos;</div><div class="line">CRS-2673: Attempting to stop &apos;ora.gpnpd&apos; on &apos;node03&apos;</div><div class="line">CRS-2673: Attempting to stop &apos;ora.mdnsd&apos; on &apos;node03&apos;</div><div class="line">CRS-2677: Stop of &apos;ora.crf&apos; on &apos;node03&apos; succeeded</div><div class="line">CRS-2677: Stop of &apos;ora.gpnpd&apos; on &apos;node03&apos; succeeded</div><div class="line">CRS-2677: Stop of &apos;ora.mdnsd&apos; on &apos;node03&apos; succeeded</div><div class="line">CRS-2677: Stop of &apos;ora.asm&apos; on &apos;node03&apos; succeeded</div><div class="line">CRS-2673: Attempting to stop &apos;ora.cluster_interconnect.haip&apos; on &apos;node03&apos;</div><div class="line">CRS-2677: Stop of &apos;ora.cluster_interconnect.haip&apos; on &apos;node03&apos; succeeded</div><div class="line">CRS-2673: Attempting to stop &apos;ora.ctssd&apos; on &apos;node03&apos;</div><div class="line">CRS-2673: Attempting to stop &apos;ora.evmd&apos; on &apos;node03&apos;</div><div class="line">CRS-2677: Stop of &apos;ora.ctssd&apos; on &apos;node03&apos; succeeded</div><div class="line">CRS-2677: Stop of &apos;ora.evmd&apos; on &apos;node03&apos; succeeded</div><div class="line">CRS-2673: Attempting to stop &apos;ora.cssd&apos; on &apos;node03&apos;</div><div class="line">CRS-2677: Stop of &apos;ora.cssd&apos; on &apos;node03&apos; succeeded</div><div class="line">CRS-2673: Attempting to stop &apos;ora.gipcd&apos; on &apos;node03&apos;</div><div class="line">CRS-2677: Stop of &apos;ora.gipcd&apos; on &apos;node03&apos; succeeded</div><div class="line">CRS-2793: Shutdown of Oracle High Availability Services-managed resources on &apos;node03&apos; has completed</div><div class="line">CRS-4133: Oracle High Availability Services has been stopped.</div><div class="line">2017/12/05 17:24:42 CLSRSC-4006: Removing Oracle Trace File Analyzer (TFA) Collector.</div><div class="line">2017/12/05 17:24:55 CLSRSC-4007: Successfully removed Oracle Trace File Analyzer (TFA) Collector.</div><div class="line">2017/12/05 17:24:57 CLSRSC-336: Successfully deconfigured Oracle Clusterware stack on this node</div></pre></td></tr></table></figure><h4 id="验证结果"><a href="#验证结果" class="headerlink" title="验证结果"></a>验证结果</h4><p>node01上，grid用户，执行如下面命令检查</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[grid@node01 ~]$ olsnodes -s -t</div><div class="line">node01  Active  Unpinned</div><div class="line">node02  Active  Unpinned</div><div class="line">node03  Inactive        Unpinned</div></pre></td></tr></table></figure><p>node03为Inactive</p><h4 id="在node01上删除节点node03的节点信息"><a href="#在node01上删除节点node03的节点信息" class="headerlink" title="在node01上删除节点node03的节点信息"></a>在node01上删除节点node03的节点信息</h4><p>node01上，root用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# cd /u01/app/12.2.0/grid/bin/</div><div class="line">[root@node01 bin]# ./crsctl delete node -n node03</div><div class="line">CRS-4661: Node node03 successfully deleted.</div></pre></td></tr></table></figure><p>node01上，grid用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[grid@node01 ~]$ olsnodes -s -t</div><div class="line">node01  Active  Unpinned</div><div class="line">node02  Active  Unpinned</div></pre></td></tr></table></figure><h4 id="更新node03节点列表"><a href="#更新node03节点列表" class="headerlink" title="更新node03节点列表"></a>更新node03节点列表</h4><p>node03上，grid用户，执行如下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[grid@node03 ~]$ cd /u01/app/12.2.0/grid/oui/bin/</div><div class="line">[grid@node03 bin]$ ./runInstaller -updateNodeList ORACLE_HOME=/u01/app/12.2.0/grid/ &quot;CLUSTER_NODES=&#123;node03&#125;&quot; CRS=TRUE  -local</div><div class="line">Starting Oracle Universal Installer...</div><div class="line">Checking swap space: must be greater than 500 MB.   Actual 8191 MB    Passed</div><div class="line">The inventory pointer is located at /etc/oraInst.loc</div><div class="line">&apos;UpdateNodeList&apos; was successful.</div></pre></td></tr></table></figure><h4 id="在node03上删除grid"><a href="#在node03上删除grid" class="headerlink" title="在node03上删除grid"></a>在node03上删除grid</h4><p>node03上，grid用户，执行如下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[grid@node03 bin]$ cd /u01/app/12.2.0/grid/deinstall/</div><div class="line">[grid@node03 deinstall]$ ./deinstall -local</div></pre></td></tr></table></figure><h4 id="node01节点上更新节点列表"><a href="#node01节点上更新节点列表" class="headerlink" title="node01节点上更新节点列表"></a>node01节点上更新节点列表</h4><p>node01上，grid用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[grid@node01 ~]$ cd /u01/app/12.2.0/grid/oui/bin/</div><div class="line">[grid@node01 bin]$ ./runInstaller -updateNodeList ORACLE_HOME=/u01/app/12.2.0/grid &quot;CLUSTER_NODES=&#123;node01,node02&#125;&quot; CRS=TRUE -silent</div><div class="line">Starting Oracle Universal Installer...</div><div class="line">Checking swap space: must be greater than 500 MB.   Actual 8191 MB    Passed</div><div class="line">The inventory pointer is located at /etc/oraInst.loc</div><div class="line">&apos;UpdateNodeList&apos; was successful.</div></pre></td></tr></table></figure><h4 id="验证是否删除成功"><a href="#验证是否删除成功" class="headerlink" title="验证是否删除成功"></a>验证是否删除成功</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[grid@node01 bin]$ cluvfy stage -post nodedel -n node03</div><div class="line">Verifying Node Removal ...</div><div class="line">  Verifying CRS Integrity ...PASSED</div><div class="line">  Verifying Clusterware Version Consistency ...PASSED</div><div class="line">Verifying Node Removal ...PASSED</div><div class="line">Post-check for node removal was successful.</div><div class="line">CVU operation performed:      stage -post nodedel</div><div class="line">Date:                         Dec 5, 2017 6:23:06 PM</div><div class="line">CVU home:                     /u01/app/12.2.0/grid/</div><div class="line">User:                         grid</div></pre></td></tr></table></figure><h3 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h3><p>如果出现vip没有删除的情况，可使用如下命令删除vip</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd /u01/app/12.2.0/grid/bin</div><div class="line">[root@bin]# srvctl stop vip ora.node03.vip</div><div class="line">[root@bin]# srvctl remove vip ora.node03.vip</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;目的&quot;&gt;&lt;a href=&quot;#目的&quot; class=&quot;headerlink&quot; title=&quot;目的&quot;&gt;&lt;/a&gt;目的&lt;/h3&gt;&lt;p&gt;删除节点node03&lt;/p&gt;
&lt;p&gt;其中：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;数据库名为orcl&lt;/li&gt;
&lt;li&gt;node03的实例名为orcl3&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="oracle" scheme="https://shijieqin.github.io/categories/oracle/"/>
    
      <category term="rac" scheme="https://shijieqin.github.io/categories/oracle/rac/"/>
    
    
      <category term="oracle" scheme="https://shijieqin.github.io/tags/oracle/"/>
    
      <category term="rac" scheme="https://shijieqin.github.io/tags/rac/"/>
    
  </entry>
  
  <entry>
    <title>Oracle RAC 12CR2添加新节点</title>
    <link href="https://shijieqin.github.io/2017/12/01/Oracle-RAC-12CR2%E6%B7%BB%E5%8A%A0%E6%96%B0%E8%8A%82%E7%82%B9/"/>
    <id>https://shijieqin.github.io/2017/12/01/Oracle-RAC-12CR2添加新节点/</id>
    <published>2017-12-01T06:20:37.000Z</published>
    <updated>2017-12-01T06:20:37.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="网段声明"><a href="#网段声明" class="headerlink" title="网段声明"></a>网段声明</h3><p>在之前安装的rac基础上添加新节点，启动node01、node02为原rac，node03为新添加节点</p><table><thead><tr><th>Name</th><th>node01</th><th>node02</th><th>node03</th></tr></thead><tbody><tr><td>Public IP</td><td>192.168.1.14</td><td>192.168.1.15</td><td>192.168.1.16</td></tr><tr><td>Private IP</td><td>192.168.6.2</td><td>192.168.6.3</td><td>192.168.6.4</td></tr><tr><td>Virtual IP</td><td>192.168.1.17</td><td>192.168.1.18</td><td>192.168.1.22</td></tr><tr><td>SCAN IP</td><td>192.168.1.19</td><td>192.168.1.120</td><td>192.168.1.21</td></tr><tr><td>NET IP</td><td>192.168.2.95</td><td>192.168.2.96</td><td>192.168.2.55</td></tr></tbody></table><a id="more"></a><h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><p>参考<a href="/2017/11/23/hwcloud上的Oracle-RAC-12cR2安装手册-1-环境的准备/" title="hwcloud上的Oracle RAC 12cR2安装手册(1)—环境准备">hwcloud上的Oracle RAC 12cR2安装手册(1)—环境准备</a>做如下准备：</p><ul><li>IP分配</li><li>安全组</li><li>修改主机名</li><li>配置host解析</li><li>关闭libvirt</li><li>禁用ZEROCONF</li><li>安装依赖</li><li>配置swap</li><li>配置内核</li><li>关闭NTP</li><li>配置PAM</li><li>修改limit文件</li><li>关闭SELinux</li><li>创建用户，用户组和文件夹</li><li>配置grid和oracle用户的环境变量</li><li>配置ssh互信</li><li>挂载共享存储到node03上，安装asmlib，使用<code>oracleasm scandisks</code>扫描磁盘组</li></ul><h3 id="安装Grid"><a href="#安装Grid" class="headerlink" title="安装Grid"></a>安装Grid</h3><h4 id="环境检查"><a href="#环境检查" class="headerlink" title="环境检查"></a>环境检查</h4><p>node01上，grid用户，执行如下命令进行node03的环境检查</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cluvfy stage -pre nodeadd -n node03 -fixup -verbose</div></pre></td></tr></table></figure><p>执行结果如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">CVU operation performed:      stage -pre nodeadd</div><div class="line">Date:                         Dec 1, 2017 3:40:21 PM</div><div class="line">CVU home:                     /u01/app/12.2.0/grid/</div><div class="line">User:                         grid</div><div class="line">******************************************************************************************</div><div class="line">Following is the list of fixable prerequisites selected to fix in this session</div><div class="line">******************************************************************************************</div><div class="line">--------------                ---------------     ----------------</div><div class="line">Check failed.                 Failed on nodes     Reboot required?</div><div class="line">--------------                ---------------     ----------------</div><div class="line">Package: cvuqdisk-1.0.10-1    node03              no</div><div class="line">Execute &quot;/tmp/CVU_12.2.0.1.0_grid/runfixup.sh&quot; as root user on nodes &quot;node03&quot; to perform the fix up operations manually</div><div class="line">Press ENTER key to continue after execution of &quot;/tmp/CVU_12.2.0.1.0_grid/runfixup.sh&quot; has completed on nodes &quot;node03&quot;</div></pre></td></tr></table></figure><p>根据提示，在node03上用root用户执行修复脚本，结果如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Press ENTER key to continue after execution of &quot;/tmp/CVU_12.2.0.1.0_grid/runfixup.sh&quot; has completed on nodes &quot;node03&quot;</div><div class="line">Fix: Package: cvuqdisk-1.0.10-1</div><div class="line">  Node Name                             Status</div><div class="line">  ------------------------------------  ------------------------</div><div class="line">  node03                                successful</div><div class="line">Result:</div><div class="line">&quot;Package: cvuqdisk-1.0.10-1&quot; was successfully fixed on all the applicable nodes</div><div class="line">[grid@node01 ~]$</div></pre></td></tr></table></figure><h4 id="临时禁用dns解析"><a href="#临时禁用dns解析" class="headerlink" title="临时禁用dns解析"></a>临时禁用dns解析</h4><p>由于grid安装时会校验dns中是否能检查到节点信息，图形化安装时可以手动忽略，这里静默添加，不能忽略，会报错退出，如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">INFO:  [Dec 1, 2017 4:46:51 PM] resolv.conf Integrity: resolv.conf Integrity</div><div class="line">INFO:  [Dec 1, 2017 4:46:51 PM] Severity:CRITICAL</div><div class="line">INFO:  [Dec 1, 2017 4:46:51 PM] OverallStatus:VERIFICATION_FAILED</div><div class="line">INFO:  [Dec 1, 2017 4:46:51 PM] *********************************************</div><div class="line">INFO:  [Dec 1, 2017 4:46:51 PM] (Linux) resolv.conf Integrity: This task checks consistency of file /etc/resolv.conf file across nodes</div><div class="line">INFO:  [Dec 1, 2017 4:46:51 PM] Severity:CRITICAL</div><div class="line">INFO:  [Dec 1, 2017 4:46:51 PM] OverallStatus:VERIFICATION_FAILED</div></pre></td></tr></table></figure><p>所以临时禁用，如下：</p><p>node01, node02, node03节点，root用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mv /etc/resolv.conf /etc/resolv.conf.bak</div></pre></td></tr></table></figure><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>node01上，grid用户，执行如下命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd $ORACLE_HOME/addnode</div><div class="line">./addnode.sh -silent &quot;CLUSTER_NEW_NODES=&#123;node03&#125;&quot; &quot;CLUSTER_NEW_VIRTUAL_HOSTNAMES=&#123;node03-vip.myCluster.com&#125;&quot; &quot;CLUSTER_NEW_PUBLIC_HOSTNAMES=&#123;node03.myCluster.com&#125;&quot; &quot;CLUSTER_NEW_NODE_ROLES=&#123;HUB&#125;&quot;</div></pre></td></tr></table></figure><p><strong><em>注：</em></strong></p><p><strong><em>以上参数都参考图形化安装时的配置</em></strong></p><p>结果如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">As a root user, execute the following script(s):</div><div class="line">1. /u01/app/oraInventory/orainstRoot.sh</div><div class="line">2. /u01/app/12.2.0/grid/root.sh</div><div class="line"></div><div class="line">Execute /u01/app/oraInventory/orainstRoot.sh on the following nodes: </div><div class="line">[node03]</div><div class="line">Execute /u01/app/12.2.0/grid/root.sh on the following nodes: </div><div class="line">[node03]</div><div class="line"></div><div class="line">The scripts can be executed in parallel on all the nodes.</div><div class="line"></div><div class="line">..................................................   100% Done.</div><div class="line">Successfully Setup Software.</div></pre></td></tr></table></figure><p>根据提示，用root用户在node03执行<code>/u01/app/oraInventory/orainstRoot.sh</code>，<code>/u01/app/12.2.0/grid/root.sh</code>即可</p><h3 id="安装oracle软件"><a href="#安装oracle软件" class="headerlink" title="安装oracle软件"></a>安装oracle软件</h3><p>node01上，oracle用户，执行如下命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd $ORACLE_HOME/addnode</div><div class="line">./addnode.sh -silent &quot;CLUSTER_NEW_NODES=&#123;node03&#125;&quot;</div></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">As a root user, execute the following script(s):</div><div class="line">1. /u01/app/oracle/product/12.2.0/dbhome_1/root.sh</div><div class="line"></div><div class="line">Execute /u01/app/oracle/product/12.2.0/dbhome_1/root.sh on the following nodes: </div><div class="line">[node03]</div><div class="line"></div><div class="line"></div><div class="line">..................................................   100% Done.</div><div class="line">Successfully Setup Software.</div></pre></td></tr></table></figure><p>根据提示，使用root用户，在node03上执行<code>/u01/app/oracle/product/12.2.0/dbhome_1/root.sh</code>即可</p><h3 id="安装instance"><a href="#安装instance" class="headerlink" title="安装instance"></a>安装instance</h3><p>node01上，oracle用户，执行如下命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dbca -silent -addInstance -nodeName node03 -gdbName orcl.myCluster.com -instanceName orcl3 -sysDBAUserName sys -sysDBAPassword Hand1234</div></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[oracle@node01 ~]$ dbca -silent -addInstance -nodeName node03 -gdbName orcl.myCluster.com -instanceName orcl3 -sysDBAUserName sys -sysDBAPassword Hand1234</div><div class="line">Adding instance</div><div class="line">1% complete</div><div class="line">2% complete</div><div class="line">6% complete</div><div class="line">13% complete</div><div class="line">20% complete</div><div class="line">26% complete</div><div class="line">33% complete</div><div class="line">40% complete</div><div class="line">46% complete</div><div class="line">53% complete</div><div class="line">66% complete</div><div class="line">Completing instance management.</div><div class="line">76% complete</div><div class="line">100% complete</div><div class="line">Look at the log file &quot;/u01/app/oracle/cfgtoollogs/dbca/orcl/orcl.log&quot; for further details.</div></pre></td></tr></table></figure><p><strong><em>注：</em></strong></p><ul><li><strong><em>安装过程中，出现找不到磁盘组的情况</em></strong></li><li><strong><em>后把u01文件夹按之前的授权重新授权，重启服务器出现原来的RAC无法启动的问题，报错为CRS-0184 Cannot Communicate With The Crs Daemon in Oracle</em></strong></li><li><strong><em>通过在三个节点(其实只需在无法启动的节点)执行安装grid时和oracle生成的root.sh文件之后，能够正常启动数据库</em></strong></li><li><strong><em>安装第三个节点的实例能找到ASM磁盘</em></strong></li></ul><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><h4 id="集群层"><a href="#集群层" class="headerlink" title="集群层"></a>集群层</h4><ul><li>crsctl check crs</li><li>crsctl check cluster -all</li><li>crsctl status res -t</li></ul><h4 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h4><ul><li>srvctl status nodeapps</li><li>srvctl status asm</li><li>srvctl status listener</li><li>srvctl status instance -d orcl -i orcl1,orcl2,orcl3</li></ul><h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>记得恢复/etc/resolv.conf ！！！</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;网段声明&quot;&gt;&lt;a href=&quot;#网段声明&quot; class=&quot;headerlink&quot; title=&quot;网段声明&quot;&gt;&lt;/a&gt;网段声明&lt;/h3&gt;&lt;p&gt;在之前安装的rac基础上添加新节点，启动node01、node02为原rac，node03为新添加节点&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;node01&lt;/th&gt;
&lt;th&gt;node02&lt;/th&gt;
&lt;th&gt;node03&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Public IP&lt;/td&gt;
&lt;td&gt;192.168.1.14&lt;/td&gt;
&lt;td&gt;192.168.1.15&lt;/td&gt;
&lt;td&gt;192.168.1.16&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Private IP&lt;/td&gt;
&lt;td&gt;192.168.6.2&lt;/td&gt;
&lt;td&gt;192.168.6.3&lt;/td&gt;
&lt;td&gt;192.168.6.4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Virtual IP&lt;/td&gt;
&lt;td&gt;192.168.1.17&lt;/td&gt;
&lt;td&gt;192.168.1.18&lt;/td&gt;
&lt;td&gt;192.168.1.22&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SCAN IP&lt;/td&gt;
&lt;td&gt;192.168.1.19&lt;/td&gt;
&lt;td&gt;192.168.1.120&lt;/td&gt;
&lt;td&gt;192.168.1.21&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;NET IP&lt;/td&gt;
&lt;td&gt;192.168.2.95&lt;/td&gt;
&lt;td&gt;192.168.2.96&lt;/td&gt;
&lt;td&gt;192.168.2.55&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="oracle" scheme="https://shijieqin.github.io/categories/oracle/"/>
    
      <category term="rac" scheme="https://shijieqin.github.io/categories/oracle/rac/"/>
    
    
      <category term="oracle" scheme="https://shijieqin.github.io/tags/oracle/"/>
    
      <category term="rac" scheme="https://shijieqin.github.io/tags/rac/"/>
    
  </entry>
  
  <entry>
    <title>hwcloud上的Oracle-RAC-12cR2安装手册(4)--数据库实例的创建</title>
    <link href="https://shijieqin.github.io/2017/11/30/hwcloud%E4%B8%8A%E7%9A%84Oracle-RAC-12cR2%E5%AE%89%E8%A3%85%E6%89%8B%E5%86%8C-4-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E4%BE%8B%E7%9A%84%E5%88%9B%E5%BB%BA/"/>
    <id>https://shijieqin.github.io/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/</id>
    <published>2017-11-30T05:50:02.000Z</published>
    <updated>2017-11-30T05:50:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>node01上，oracle用户，执行<code>dbca</code>，如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[oracle@node01 ~]$ dbca</div></pre></td></tr></table></figure><p>安装过程如下：</p><a id="more"></a><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step1.png" alt="创建一个数据库" title="创建一个数据库"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step2.png" alt="高级配置" title="高级配置"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step3.png" alt="安装RAC，选择自定义数据库" title="安装RAC，选择自定义数据库"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step4.png" alt="选择所有节点" title="选择所有节点"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step5.png" alt="设置全局数据库名和SID前缀，选择创建空白容器数据库" title="设置全局数据库名和SID前缀，选择创建空白容器数据库"><p><strong><em>注：</em></strong><br><strong><em>此处的SID前缀需要与环境变量里的ORACLE_SID对应：</em></strong><br><strong><em>例如，SID前缀设置orcl，ORACLE_SID需要设置为orcl1和orcl2。</em></strong></p><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step6.png" alt="选择ASM存储类型并选择DATA磁盘组" title="选择ASM存储类型并选择DATA磁盘组"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step7-2.png" alt="启用快速闪回去，并选择DATA磁盘组，大小根据实际需求设置，忽略提示，直接确定" title="启用快速闪回去，并选择DATA磁盘组，大小根据实际需求设置，忽略提示，直接确定"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step8.png" alt="默认" title="默认"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step9.png" alt="选择自动共享内存管理，并设置MEMORY_TARGET，建议物理内存的80%" title="选择自动共享内存管理，并设置MEMORY_TARGET，建议物理内存的80%"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step9-2.png" alt="块大小设置为32768B，进程数设置为1500" title="块大小设置为32768B，进程数设置为1500"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step9-3.png" alt="字符集选择AL32UTF8" title="字符集选择AL32UTF8"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step9-4.png" alt="选择专用服务器模式" title="选择专用服务器模式"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step10.png" alt="不启用EM" title="不启用EM"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step11.png" alt="使用统一密码" title="使用统一密码"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step12.png" alt="创建数据库" title="创建数据库"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step12-2.png" alt="忽略警告，确认" title="忽略警告，确认"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step13.png" alt="检查" title="检查"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step13-2.png" alt="忽略" title="忽略"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step13-3.png" alt="确认" title="确认"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step14.png" alt="配置完成" title="配置完成"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step15.png" alt="安装进行中" title="安装进行中"><img src="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/Step16.png" alt="安装完成，关闭" title="安装完成，关闭"><p>node01、node02上，oracle用户，执行<code>lsnrctl status</code>查看实例运行状态</p><p>node01：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">[oracle@node01 ~]$ lsnrctl status</div><div class="line">LSNRCTL for Linux: Version 12.2.0.1.0 - Production on 30-NOV-2017 17:27:08</div><div class="line">Copyright (c) 1991, 2016, Oracle.  All rights reserved.</div><div class="line">Connecting to (ADDRESS=(PROTOCOL=tcp)(HOST=)(PORT=1521))</div><div class="line">STATUS of the LISTENER</div><div class="line">------------------------</div><div class="line">Alias                     LISTENER</div><div class="line">Version                   TNSLSNR for Linux: Version 12.2.0.1.0 - Production</div><div class="line">Start Date                29-NOV-2017 18:45:30</div><div class="line">Uptime                    0 days 22 hr. 41 min. 37 sec</div><div class="line">Trace Level               off</div><div class="line">Security                  ON: Local OS Authentication</div><div class="line">SNMP                      OFF</div><div class="line">Listener Parameter File   /u01/app/12.2.0/grid/network/admin/listener.ora</div><div class="line">Listener Log File         /u01/app/grid/diag/tnslsnr/node01/listener/alert/log.xml</div><div class="line">Listening Endpoints Summary...</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=LISTENER)))</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.14)(PORT=1521)))</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.17)(PORT=1521)))</div><div class="line">Services Summary...</div><div class="line">Service &quot;+ASM&quot; has 1 instance(s).</div><div class="line">  Instance &quot;+ASM1&quot;, status READY, has 1 handler(s) for this service...</div><div class="line">Service &quot;+ASM_DATA&quot; has 1 instance(s).</div><div class="line">  Instance &quot;+ASM1&quot;, status READY, has 1 handler(s) for this service...</div><div class="line">Service &quot;+ASM_OCR_VOT_GIMR&quot; has 1 instance(s).</div><div class="line">  Instance &quot;+ASM1&quot;, status READY, has 1 handler(s) for this service...</div><div class="line">Service &quot;orcl.myCluster.com&quot; has 1 instance(s).</div><div class="line">  Instance &quot;orcl1&quot;, status READY, has 1 handler(s) for this service...</div><div class="line">Service &quot;orclXDB.myCluster.com&quot; has 1 instance(s).</div><div class="line">  Instance &quot;orcl1&quot;, status READY, has 1 handler(s) for this service...</div><div class="line">The command completed successfully</div></pre></td></tr></table></figure><p>node02：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">[oracle@node02 ~]$ lsnrctl status</div><div class="line">LSNRCTL for Linux: Version 12.2.0.1.0 - Production on 30-NOV-2017 17:29:46</div><div class="line">Copyright (c) 1991, 2016, Oracle.  All rights reserved.</div><div class="line">Connecting to (ADDRESS=(PROTOCOL=tcp)(HOST=)(PORT=1521))</div><div class="line">STATUS of the LISTENER</div><div class="line">------------------------</div><div class="line">Alias                     LISTENER</div><div class="line">Version                   TNSLSNR for Linux: Version 12.2.0.1.0 - Production</div><div class="line">Start Date                29-NOV-2017 18:57:02</div><div class="line">Uptime                    0 days 22 hr. 32 min. 43 sec</div><div class="line">Trace Level               off</div><div class="line">Security                  ON: Local OS Authentication</div><div class="line">SNMP                      OFF</div><div class="line">Listener Parameter File   /u01/app/12.2.0/grid/network/admin/listener.ora</div><div class="line">Listener Log File         /u01/app/grid/diag/tnslsnr/node02/listener/alert/log.xml</div><div class="line">Listening Endpoints Summary...</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=LISTENER)))</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.15)(PORT=1521)))</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.18)(PORT=1521)))</div><div class="line">Services Summary...</div><div class="line">Service &quot;+ASM&quot; has 1 instance(s).</div><div class="line">  Instance &quot;+ASM2&quot;, status READY, has 1 handler(s) for this service...</div><div class="line">Service &quot;+ASM_DATA&quot; has 1 instance(s).</div><div class="line">  Instance &quot;+ASM2&quot;, status READY, has 1 handler(s) for this service...</div><div class="line">Service &quot;+ASM_OCR_VOT_GIMR&quot; has 1 instance(s).</div><div class="line">  Instance &quot;+ASM2&quot;, status READY, has 1 handler(s) for this service...</div><div class="line">Service &quot;orcl.myCluster.com&quot; has 1 instance(s).</div><div class="line">  Instance &quot;orcl2&quot;, status READY, has 1 handler(s) for this service...</div><div class="line">Service &quot;orclXDB.myCluster.com&quot; has 1 instance(s).</div><div class="line">  Instance &quot;orcl2&quot;, status READY, has 1 handler(s) for this service...</div><div class="line">The command completed successfully</div></pre></td></tr></table></figure><p>node01、node02上，oracle用户，执行<code>sqlplus / as sysdba</code>尝试登录数据库，并执行<code>show pdbs;</code>查看pdb状态</p><p>node01：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[oracle@node01 ~]$ sqlplus / as sysdba</div><div class="line">SQL*Plus: Release 12.2.0.1.0 Production on Thu Nov 30 17:37:41 2017</div><div class="line">Copyright (c) 1982, 2016, Oracle.  All rights reserved.</div><div class="line">Connected to:</div><div class="line">Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit Production</div><div class="line">SQL&gt; show pdbs;</div><div class="line">    CON_ID CON_NAME                       OPEN MODE  RESTRICTED</div><div class="line">---------- ------------------------------ ---------- ----------</div><div class="line">         2 PDB$SEED                       READ ONLY  NO</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p>node02:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[oracle@node02 ~]$ sqlplus / as sysdba</div><div class="line">SQL*Plus: Release 12.2.0.1.0 Production on Thu Nov 30 17:39:15 2017</div><div class="line">Copyright (c) 1982, 2016, Oracle.  All rights reserved.</div><div class="line">Connected to:</div><div class="line">Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit Production</div><div class="line">SQL&gt; show pdbs;</div><div class="line">    CON_ID CON_NAME                       OPEN MODE  RESTRICTED</div><div class="line">---------- ------------------------------ ---------- ----------</div><div class="line">         2 PDB$SEED                       READ ONLY  NO</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p>至此，完成了数据库实例的创建，ORACLE RAC安装完成，后面测试ORACLE RAC个节点分开调整服务器配置，敬请期待。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;node01上，oracle用户，执行&lt;code&gt;dbca&lt;/code&gt;，如下：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[oracle@node01 ~]$ dbca&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;安装过程如下：&lt;/p&gt;
    
    </summary>
    
      <category term="oracle" scheme="https://shijieqin.github.io/categories/oracle/"/>
    
      <category term="rac" scheme="https://shijieqin.github.io/categories/oracle/rac/"/>
    
    
      <category term="oracle" scheme="https://shijieqin.github.io/tags/oracle/"/>
    
      <category term="rac" scheme="https://shijieqin.github.io/tags/rac/"/>
    
  </entry>
  
  <entry>
    <title>hwcloud上的Oracle-RAC-12cR2安装手册(3)--oracle软件的安装</title>
    <link href="https://shijieqin.github.io/2017/11/29/hwcloud%E4%B8%8A%E7%9A%84Oracle-RAC-12cR2%E5%AE%89%E8%A3%85%E6%89%8B%E5%86%8C-3-oracle%E8%BD%AF%E4%BB%B6%E7%9A%84%E5%AE%89%E8%A3%85/"/>
    <id>https://shijieqin.github.io/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/</id>
    <published>2017-11-29T12:38:13.000Z</published>
    <updated>2017-11-29T12:38:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>node01上，oracle用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /u01/software/database/</div><div class="line">./runInstaller</div></pre></td></tr></table></figure><p>安装过程如下：</p><a id="more"></a><img src="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/Step1.png" alt="取消安全更新" title="取消安全更新"><img src="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/Step1-2.png" alt="确认" title="确认"><img src="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/Step2.png" alt="仅安装数据库软件" title="仅安装数据库软件"><img src="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/Step3.png" alt="选择安装RAC" title="选择安装RAC"><img src="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/Step4.png" alt="选择所有节点" title="选择所有节点"><img src="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/Step5.png" alt="安装企业版" title="安装企业版"><img src="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/Step6.png" alt="确认安装目录" title="确认安装目录"><img src="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/Step7.png" alt="默认" title="默认"><img src="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/Step8.png" alt="检查" title="检查"><img src="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/Step8-2.png" alt="忽略全部，无需考虑DNS的报错，因为使用了host文件指定相关域名" title="忽略全部，无需考虑DNS的报错，因为使用了host文件指定相关域名"><img src="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/Step8-3.png" alt="确认继续" title="确认继续"><img src="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/Step9.png" alt="安装" title="安装"><img src="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/Step10.png" alt="安装进行中" title="安装进行中"><img src="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/Step10-2.png" alt="需要root用户执行脚本" title="需要root用户执行脚本"><p>node01、node02上，root用户，执行<code>/u01/app/oracle/product/12.2.0/dbhome_1/root.sh</code>如下：</p><p>node01：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# /u01/app/oracle/product/12.2.0/dbhome_1/root.sh</div><div class="line">Performing root user operation.</div><div class="line">The following environment variables are set as:</div><div class="line">    ORACLE_OWNER= oracle</div><div class="line">    ORACLE_HOME=  /u01/app/oracle/product/12.2.0/dbhome_1</div><div class="line">Enter the full pathname of the local bin directory: [/usr/local/bin]:</div><div class="line">The contents of &quot;dbhome&quot; have not changed. No need to overwrite.</div><div class="line">The contents of &quot;oraenv&quot; have not changed. No need to overwrite.</div><div class="line">The contents of &quot;coraenv&quot; have not changed. No need to overwrite.</div><div class="line">Entries will be added to the /etc/oratab file as needed by</div><div class="line">Database Configuration Assistant when a database is created</div><div class="line">Finished running generic part of root script.</div><div class="line">Now product-specific root actions will be performed.</div></pre></td></tr></table></figure><p>node02：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@node02 ~]# /u01/app/oracle/product/12.2.0/dbhome_1/root.sh</div><div class="line">Performing root user operation.</div><div class="line">The following environment variables are set as:</div><div class="line">    ORACLE_OWNER= oracle</div><div class="line">    ORACLE_HOME=  /u01/app/oracle/product/12.2.0/dbhome_1</div><div class="line">Enter the full pathname of the local bin directory: [/usr/local/bin]:</div><div class="line">The contents of &quot;dbhome&quot; have not changed. No need to overwrite.</div><div class="line">The contents of &quot;oraenv&quot; have not changed. No need to overwrite.</div><div class="line">The contents of &quot;coraenv&quot; have not changed. No need to overwrite.</div><div class="line">Entries will be added to the /etc/oratab file as needed by</div><div class="line">Database Configuration Assistant when a database is created</div><div class="line">Finished running generic part of root script.</div><div class="line">Now product-specific root actions will be performed.</div></pre></td></tr></table></figure><img src="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/Step10-3.png" alt="执行完成后，选择OK" title="执行完成后，选择OK"><img src="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/Step11.png" alt="关闭" title="关闭"><p>至此，完成了数据库软件的安装</p><p>接着看<a href="/2017/11/30/hwcloud上的Oracle-RAC-12cR2安装手册-4-数据库实例的创建/" title="hwcloud上的Oracle-RAC-12cR2安装手册(4)--数据库实例的创建">hwcloud上的Oracle-RAC-12cR2安装手册(4)--数据库实例的创建</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;node01上，oracle用户&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;cd /u01/software/database/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;./runInstaller&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;安装过程如下：&lt;/p&gt;
    
    </summary>
    
      <category term="oracle" scheme="https://shijieqin.github.io/categories/oracle/"/>
    
      <category term="rac" scheme="https://shijieqin.github.io/categories/oracle/rac/"/>
    
    
      <category term="oracle" scheme="https://shijieqin.github.io/tags/oracle/"/>
    
      <category term="rac" scheme="https://shijieqin.github.io/tags/rac/"/>
    
  </entry>
  
  <entry>
    <title>Centos6安装ASMLIB</title>
    <link href="https://shijieqin.github.io/2017/11/27/abc/"/>
    <id>https://shijieqin.github.io/2017/11/27/abc/</id>
    <published>2017-11-27T08:30:19.000Z</published>
    <updated>2017-11-27T08:30:19.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Centos6安装ASMLIB"><a href="#Centos6安装ASMLIB" class="headerlink" title="Centos6安装ASMLIB"></a>Centos6安装ASMLIB</h3><p>我这里操作系统用的是Centos 6.8，Centos 6系列和Redhat 6系列都可以按下面的方式安装，至于其他版本的下载连接，参考地址：<a href="http://www.oracle.com/technetwork/server-storage/linux/asmlib/index-101839.html?ssSourceSiteId=ocomen" target="_blank" rel="external">http://www.oracle.com/technetwork/server-storage/linux/asmlib/index-101839.html?ssSourceSiteId=ocomen</a></p><a id="more"></a><p><strong><em>注：以下操作需要在node01和node02两个节点上操作</em></strong></p><h4 id="下载相关软件"><a href="#下载相关软件" class="headerlink" title="下载相关软件"></a>下载相关软件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# wget http://oss.oracle.com/projects/oracleasm-support/dist/files/RPMS/rhel6/amd64/2.1.8/oracleasm-support-2.1.8-1.el6.x86_64.rpm</div><div class="line">[root@node01 ~]# wget http://download.oracle.com/otn_software/asmlib/oracleasmlib-2.0.4-1.el6.x86_64.rpm</div></pre></td></tr></table></figure><h4 id="使用yum自动安装相关依赖"><a href="#使用yum自动安装相关依赖" class="headerlink" title="使用yum自动安装相关依赖"></a>使用yum自动安装相关依赖</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# yum install oracleasm</div></pre></td></tr></table></figure><h4 id="使用yum本地安装下载好的两个安装包"><a href="#使用yum本地安装下载好的两个安装包" class="headerlink" title="使用yum本地安装下载好的两个安装包"></a>使用yum本地安装下载好的两个安装包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# yum localinstall oracleasmlib-2.0.4-1.el6.x86_64.rpm</div><div class="line">[root@node01 ~]# yum localinstall oracleasm-support-2.1.8-1.el6.x86_64.rpm</div></pre></td></tr></table></figure><h4 id="配置oracleasm服务"><a href="#配置oracleasm服务" class="headerlink" title="配置oracleasm服务"></a>配置oracleasm服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# oracleasm configure -i</div><div class="line">Configuring the Oracle ASM library driver.</div><div class="line">This will configure the on-boot properties of the Oracle ASM library</div><div class="line">driver.  The following questions will determine whether the driver is</div><div class="line">loaded on boot and what permissions it will have.  The current values</div><div class="line">will be shown in brackets ('[]').  Hitting &lt;ENTER&gt; without typing an</div><div class="line">answer will keep that current value.  Ctrl-C will abort.</div><div class="line">Default user to own the driver interface []: grid</div><div class="line">Default group to own the driver interface []: asmadmin</div><div class="line">Start Oracle ASM library driver on boot (y/n) [n]: y</div><div class="line">Scan for Oracle ASM disks on boot (y/n) [y]: y</div><div class="line">Writing Oracle ASM library driver configuration: done</div></pre></td></tr></table></figure><h4 id="启动oracleasm"><a href="#启动oracleasm" class="headerlink" title="启动oracleasm"></a>启动oracleasm</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# /etc/init.d/oracleasm enable</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Centos6安装ASMLIB&quot;&gt;&lt;a href=&quot;#Centos6安装ASMLIB&quot; class=&quot;headerlink&quot; title=&quot;Centos6安装ASMLIB&quot;&gt;&lt;/a&gt;Centos6安装ASMLIB&lt;/h3&gt;&lt;p&gt;我这里操作系统用的是Centos 6.8，Centos 6系列和Redhat 6系列都可以按下面的方式安装，至于其他版本的下载连接，参考地址：&lt;a href=&quot;http://www.oracle.com/technetwork/server-storage/linux/asmlib/index-101839.html?ssSourceSiteId=ocomen&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.oracle.com/technetwork/server-storage/linux/asmlib/index-101839.html?ssSourceSiteId=ocomen&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="oracle" scheme="https://shijieqin.github.io/categories/oracle/"/>
    
      <category term="ASM" scheme="https://shijieqin.github.io/categories/oracle/ASM/"/>
    
    
      <category term="oracle" scheme="https://shijieqin.github.io/tags/oracle/"/>
    
      <category term="ASM" scheme="https://shijieqin.github.io/tags/ASM/"/>
    
  </entry>
  
  <entry>
    <title>centos6.8调整swap空间</title>
    <link href="https://shijieqin.github.io/2017/11/27/centos6-8%E8%B0%83%E6%95%B4swap%E7%A9%BA%E9%97%B4/"/>
    <id>https://shijieqin.github.io/2017/11/27/centos6-8调整swap空间/</id>
    <published>2017-11-27T08:20:49.000Z</published>
    <updated>2017-11-27T08:20:49.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h3><p>安装数据库时，要求swap空间至少为8G大小，由于操作系统已经安装完成，因此需要用如下方式调整swap空间</p><a id="more"></a><h3 id="创建的swap文件"><a href="#创建的swap文件" class="headerlink" title="创建的swap文件"></a>创建的swap文件</h3><p>这里启用的swap会与默认的swap空间叠加使用，默认的是4G大小，因此这里只需要再创建4Gswap即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">fallocate -l 4g /var/swapfile</div><div class="line">chmod 600 /var/swapfile </div><div class="line">mkswap /var/swapfile</div></pre></td></tr></table></figure><h3 id="启用创建的swap文件"><a href="#启用创建的swap文件" class="headerlink" title="启用创建的swap文件"></a>启用创建的swap文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">swapon /var/swapfile</div></pre></td></tr></table></figure><h3 id="添加至fstab文件"><a href="#添加至fstab文件" class="headerlink" title="添加至fstab文件"></a>添加至fstab文件</h3><p>编辑/etc/fstab文件，添加如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/var/swapfile swap swap defaults 0 0</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;起因&quot;&gt;&lt;a href=&quot;#起因&quot; class=&quot;headerlink&quot; title=&quot;起因&quot;&gt;&lt;/a&gt;起因&lt;/h3&gt;&lt;p&gt;安装数据库时，要求swap空间至少为8G大小，由于操作系统已经安装完成，因此需要用如下方式调整swap空间&lt;/p&gt;
    
    </summary>
    
      <category term="LINUX" scheme="https://shijieqin.github.io/categories/LINUX/"/>
    
      <category term="swap" scheme="https://shijieqin.github.io/categories/LINUX/swap/"/>
    
    
      <category term="LINUX" scheme="https://shijieqin.github.io/tags/LINUX/"/>
    
      <category term="swap" scheme="https://shijieqin.github.io/tags/swap/"/>
    
  </entry>
  
  <entry>
    <title>hwcloud上的Oracle RAC 12cR2安装手册(2)--grid的安装</title>
    <link href="https://shijieqin.github.io/2017/11/27/hwcloud%E4%B8%8A%E7%9A%84Oracle-RAC-12cR2%E5%AE%89%E8%A3%85%E6%89%8B%E5%86%8C-2-grid%E7%9A%84%E5%AE%89%E8%A3%85/"/>
    <id>https://shijieqin.github.io/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/</id>
    <published>2017-11-27T08:02:02.000Z</published>
    <updated>2017-11-27T08:02:02.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="安装CVU"><a href="#安装CVU" class="headerlink" title="安装CVU"></a>安装CVU</h3><p>node01上，root用户</p><p>执行如下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /u01/app/12.2.0/grid/cv/rpm/</div><div class="line">rpm -ivh cvuqdisk-1.0.10-1.rpm</div></pre></td></tr></table></figure><a id="more"></a><p>node01上，grid用户</p><p>执行如下命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /u01/app/12.2.0/grid/</div><div class="line">./runcluvfy.sh stage -pre crsinst -n node01,node02 -fixup -verbose</div></pre></td></tr></table></figure><p>返回结果如下，则表示配置正确</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Pre-check for cluster services setup was successful.</div><div class="line">CVU operation performed:      stage -pre crsinst</div><div class="line">Date:                         Nov 27, 2017 6:26:58 PM</div><div class="line">CVU home:                     /u01/app/12.2.0/grid/</div><div class="line">User:                         grid</div></pre></td></tr></table></figure><p>如果有报错，则按照提示修复错误即可</p><h3 id="安装网格基础设施-grid"><a href="#安装网格基础设施-grid" class="headerlink" title="安装网格基础设施(grid)"></a>安装网格基础设施(grid)</h3><p><strong><em>注：</em></strong></p><ul><li><strong><em>安装前需保证node02上ORACLE_BASE和ORACLE_HOME目录为空，如果报错，可以手动清理掉</em></strong></li><li><strong><em>安装前保证node01上的ORACLE_BASE的目录为空，如果报错，可以手动清理掉</em></strong></li></ul><p>node01上，grid用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /u01/app/12.2.0/grid/</div><div class="line">./gridSetup.sh</div></pre></td></tr></table></figure><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step1.png" alt="选择第一项，为新集群配置Grid" title="选择第一项，为新集群配置Grid"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step2.png" alt="配置一个独立的集群" title="配置一个独立的集群"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step3.png" alt="输入集群名称、SCAN名称（需要与hosts配置的一致）和SCAN端口（默认1521）" title="输入集群名称、SCAN名称（需要与hosts配置的一致）和SCAN端口（默认1521）"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step4.png" alt="选择添加新节点" title="选择添加新节点"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step4-3.png" alt="添加节点，格式按照node01的格式" title="添加节点，格式按照node01的格式"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step4-2.png" alt="添加完成，下一步" title="添加完成，下一步"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step5.png" alt="指定网卡用途" title="指定网卡用途"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step6.png" alt="选择使用块设备配置ASM" title="选择使用块设备配置ASM"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step7.png" alt="不为GIMR配置单独的ASM磁盘组" title="不为GIMR配置单独的ASM磁盘组"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step8.png" alt="命名磁盘组为OCR_VOT_GIMR，选择外部冗余，修改探索目录" title="命名磁盘组为OCR_VOT_GIMR，选择外部冗余，修改探索目录"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step8-2.png" alt="选择OCR_VOT_GIMR" title="选择OCR_VOT_GIMR"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step9.png" alt="使用统一密码" title="使用统一密码"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step10.png" alt="不用IPMI" title="不用IPMI"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step11.png" alt="不注册EM" title="不注册EM"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step12.png" alt="默认" title="默认"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step13.png" alt="默认" title="默认"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step14.png" alt="默认" title="默认"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step15.png" alt="输入root密码，自动配置脚本" title="输入root密码，自动配置脚本"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step16.png" alt="检查" title="检查"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step16-3.png" alt="忽略全部，下一步" title="忽略全部，下一步"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step16-4.png" alt="确认" title="确认"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step17.png" alt="安装" title="安装"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step18.png" alt="开始安装，安装过程中需要确认使用root执行脚本" title="开始安装，安装过程中需要确认使用root执行脚本"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step18-2.png" alt="集群校验失败，确认即可" title="集群校验失败，确认即可"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Step18-3.png" alt="确认继续" title="确认继续"><p>安装完成后，点击close关闭即可。</p><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>使用grid用户分别在node01和node02上执行<code>crs_stat -v -t</code>查看服务运行状态，如下：</p><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Node01-1.png" alt="node01" title="node01"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/Node02-1.png" alt="node02" title="node02"><h3 id="创建其他磁盘组"><a href="#创建其他磁盘组" class="headerlink" title="创建其他磁盘组"></a>创建其他磁盘组</h3><p>node01上，grid用户</p><p>执行<code>asmca</code>，结果如下：</p><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/asmca1.png" alt="欢迎界面" title="欢迎界面"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/asmca2.png" alt="选择创建磁盘组" title="选择创建磁盘组"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/asmca3.png" alt="创建DATA磁盘，选择外部冗余，选择DATA磁盘" title="创建DATA磁盘，选择外部冗余，选择DATA磁盘"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/asmca4.png" alt="创建中" title="创建中"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/asmca5.png" alt="创建完成，退出" title="创建完成，退出"><img src="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/asmca6.png" alt="确认退出" title="确认退出"><p>至此，完成Grid安装</p><p>接着看<a href="/2017/11/29/hwcloud上的Oracle-RAC-12cR2安装手册-3-oracle软件的安装/" title="hwcloud上的Oracle RAC 12cR2安装手册(3)—oracle软件的安装">hwcloud上的Oracle RAC 12cR2安装手册(3)—oracle软件的安装</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;安装CVU&quot;&gt;&lt;a href=&quot;#安装CVU&quot; class=&quot;headerlink&quot; title=&quot;安装CVU&quot;&gt;&lt;/a&gt;安装CVU&lt;/h3&gt;&lt;p&gt;node01上，root用户&lt;/p&gt;
&lt;p&gt;执行如下命令：&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;cd /u01/app/12.2.0/grid/cv/rpm/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;rpm -ivh cvuqdisk-1.0.10-1.rpm&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="oracle" scheme="https://shijieqin.github.io/categories/oracle/"/>
    
      <category term="rac" scheme="https://shijieqin.github.io/categories/oracle/rac/"/>
    
    
      <category term="oracle" scheme="https://shijieqin.github.io/tags/oracle/"/>
    
      <category term="rac" scheme="https://shijieqin.github.io/tags/rac/"/>
    
  </entry>
  
  <entry>
    <title>Centos6修改Hostname</title>
    <link href="https://shijieqin.github.io/2017/11/24/Centos6%E4%BF%AE%E6%94%B9Hostname/"/>
    <id>https://shijieqin.github.io/2017/11/24/Centos6修改Hostname/</id>
    <published>2017-11-24T05:52:09.000Z</published>
    <updated>2017-11-24T05:52:09.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="查看当前hostname"><a href="#查看当前hostname" class="headerlink" title="查看当前hostname"></a>查看当前hostname</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# hostname</div><div class="line">node01.myCluster.com</div></pre></td></tr></table></figure><a id="more"></a><h3 id="临时修改hostname"><a href="#临时修改hostname" class="headerlink" title="临时修改hostname"></a>临时修改hostname</h3><p>命令格式为：</p><p><strong><em>hostname newhostname</em></strong></p><p>如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# hostname node02.myCluster.com</div><div class="line">[root@node01 ~]# hostname</div><div class="line">node02.myCluster.com</div></pre></td></tr></table></figure><p>通过以上修改，只能临时生效，重启服务器后失效</p><h3 id="修改-etc-sysconfig-network"><a href="#修改-etc-sysconfig-network" class="headerlink" title="修改/etc/sysconfig/network"></a>修改/etc/sysconfig/network</h3><p>通过修改/etc/sysconfig/network中的hostname，实现永久生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NETWORKING=yes</div><div class="line">HOSTNAME=node02.myCluster.com</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;查看当前hostname&quot;&gt;&lt;a href=&quot;#查看当前hostname&quot; class=&quot;headerlink&quot; title=&quot;查看当前hostname&quot;&gt;&lt;/a&gt;查看当前hostname&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@node01 ~]# hostname&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;node01.myCluster.com&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="LINUX" scheme="https://shijieqin.github.io/categories/LINUX/"/>
    
      <category term="hostname" scheme="https://shijieqin.github.io/categories/LINUX/hostname/"/>
    
    
      <category term="LINUX" scheme="https://shijieqin.github.io/tags/LINUX/"/>
    
      <category term="hostname" scheme="https://shijieqin.github.io/tags/hostname/"/>
    
  </entry>
  
  <entry>
    <title>hwcloud上的Oracle RAC 12cR2安装手册(1)--环境的准备</title>
    <link href="https://shijieqin.github.io/2017/11/23/hwcloud%E4%B8%8A%E7%9A%84Oracle-RAC-12cR2%E5%AE%89%E8%A3%85%E6%89%8B%E5%86%8C-1-%E7%8E%AF%E5%A2%83%E7%9A%84%E5%87%86%E5%A4%87/"/>
    <id>https://shijieqin.github.io/2017/11/23/hwcloud上的Oracle-RAC-12cR2安装手册-1-环境的准备/</id>
    <published>2017-11-23T09:15:01.000Z</published>
    <updated>2017-11-23T09:15:01.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h3><h4 id="网卡分配"><a href="#网卡分配" class="headerlink" title="网卡分配"></a>网卡分配</h4><table><thead><tr><th>网卡名</th><th>作用</th><th>网段</th></tr></thead><tbody><tr><td>eth0</td><td>Public IP</td><td>192.168.1.0/24</td></tr><tr><td>eth1</td><td>NET IP</td><td>192.168.2.0/24</td></tr><tr><td>eth2</td><td>Private IP</td><td>192.168.6.0/24</td></tr></tbody></table><p>这里我用了三块网卡：</p><ul><li><p>eth0做Public IP的网卡，同时会绑定Virtual IP 和 SCAN IP</p></li><li><p>eth1做NET IP的网卡，用来提供访问互联网的服务</p></li><li><p>eth2做Private的网卡，用来做节点之间的数据交互</p><p><strong><em>注：在华为云控制台关闭node01节点和node02节点的Public IP网卡的<code>源/目的检查</code>，否则虚拟ip是不通的</em></strong></p></li></ul><a id="more"></a><h4 id="IP段分配"><a href="#IP段分配" class="headerlink" title="IP段分配"></a>IP段分配</h4><table><thead><tr><th>Name</th><th>node01</th><th>node02</th></tr></thead><tbody><tr><td>Public IP</td><td>192.168.1.14</td><td>192.168.1.15</td></tr><tr><td>Private IP</td><td>192.168.6.2</td><td>192.168.6.3</td></tr><tr><td>Virtual IP</td><td>192.168.1.16</td><td>192.168.1.17</td></tr><tr><td>SCAN IP</td><td>192.168.1.18</td><td>192.168.1.19</td></tr><tr><td></td><td>192.168.1.20</td><td></td></tr><tr><td>NET IP</td><td>192.168.2.95</td><td>192.168.2.96</td></tr></tbody></table><h4 id="安全组"><a href="#安全组" class="headerlink" title="安全组"></a>安全组</h4><p>修改华为云安全组，放行169.254.0.0/16 网段、放行Public IP、放心Virtual IP、放行SCAN IP、Private IP</p><h4 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h4><p>参考<a href="/2017/11/24/Centos6修改Hostname/" title="Centos6修改Hostname">Centos6修改Hostname</a></p><p>分别将两个节点的主机名改为node01.myCluster.com、node02.myCluster.com</p><h4 id="配置host解析"><a href="#配置host解析" class="headerlink" title="配置host解析"></a>配置host解析</h4><p>修改node1和node2的hosts文件，添加如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"># Public</div><div class="line">192.168.1.14 node01.myCluster.com node01</div><div class="line">192.168.1.14 node02.myCluster.com node02</div><div class="line"># Private</div><div class="line">192.168.6.2   node01-priv.myCluster.com   node01-priv</div><div class="line">192.168.6.3   node02-priv.myCluster.com   node02-priv</div><div class="line"># Virtual</div><div class="line">192.168.1.16   node01-vip.myCluster.com    node01-vip</div><div class="line">192.168.1.17   node02-vip.myCluster.com    node02-vip</div><div class="line"># SCAN</div><div class="line">192.168.1.18   nodes-scan.myCluster.com nodes-scan</div><div class="line">192.168.1.19   nodes-scan.myCluster.com nodes-scan</div><div class="line">192.168.1.20   nodes-scan.myCluster.com nodes-scan</div></pre></td></tr></table></figure><h4 id="关闭libvirt的虚拟网卡功能"><a href="#关闭libvirt的虚拟网卡功能" class="headerlink" title="关闭libvirt的虚拟网卡功能"></a>关闭libvirt的虚拟网卡功能</h4><p>如果服务器安装了libvirt，则需要关闭其自带的虚拟网卡功能，方法如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">virsh net-list</div><div class="line">virsh net-destroy default</div><div class="line">virsh net-undefine default</div><div class="line">service libvirtd restart</div></pre></td></tr></table></figure><p><strong><em>(注：华为云提供的Centos6.8镜像不需要做此操作)</em></strong></p><h4 id="禁用ZEROCONF"><a href="#禁用ZEROCONF" class="headerlink" title="禁用ZEROCONF"></a>禁用ZEROCONF</h4><p>分别编辑node01和node02上的/etc/sysconfig/network，添加如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NOZEROCONF=yes</div></pre></td></tr></table></figure><h3 id="操作系统配置"><a href="#操作系统配置" class="headerlink" title="操作系统配置"></a>操作系统配置</h3><h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install binutils compat-libcap1 compat-libstdc++ compat-libstdc++-33 e2fsprogs e2fsprogs-libs glibc glibc glibc-devel glibc-devel ksh libgcc libgcc libstdc++ libstdc++ libstdc++-devel libstdc++-devel libaio libaio libaio-devel libaio-devel libXtst libXtst libX11 libX11 libXau libXau libxcb libxcb libXi libXi make net-tools nfs-utils sysstat smartmontools gcc gcc-c++ gcc-devel</div></pre></td></tr></table></figure><h4 id="配置swap"><a href="#配置swap" class="headerlink" title="配置swap"></a>配置swap</h4><p>oracle要求swap空间至少为8G，我用的这个镜像默认swap为4G，因此需要调整，参考<a href="/2017/11/27/centos6-8调整swap空间/" title="centos6.8调整swap空间">centos6.8调整swap空间</a> 调整即可</p><h4 id="配置内核参数"><a href="#配置内核参数" class="headerlink" title="配置内核参数"></a>配置内核参数</h4><p>我服务器配置为<strong><em>4C/8G</em></strong></p><p>在node01和node02上编辑/etc/sysctl.conf，添加或修改如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">kernel.shmall = 4294967296</div><div class="line">kernel.shmmax = 8589934591</div><div class="line">fs.aio-max-nr = 1048576</div><div class="line">fs.file-max = 6815744</div><div class="line">kernel.shmmni = 4096</div><div class="line">kernel.sem = 250 32000 100 128</div><div class="line">net.ipv4.ip_local_port_range = 9000 65500</div><div class="line">net.core.rmem_default = 262144</div><div class="line">net.core.rmem_max = 4194304</div><div class="line">net.core.wmem_default = 262144</div><div class="line">net.core.wmem_max = 1048576</div><div class="line">kernel.panic_on_oops=1</div></pre></td></tr></table></figure><p>关于以上部分参数的介绍：</p><p><strong>kernel.shmmax</strong>:</p><blockquote><p>用来定义共享内存单个共享内存段可使用的内存大小，最好设置改值得大小能容下整个SGA的大小，否则会导致性能下降，原因是因为在实例启动以及ServerProcess创建的时候，多个小的共享内存段可能会导致当时轻微的系统性能的降低(在启动的时候需要去创建多个虚拟地址段，在进程创建的时候要让进程对多个段进行“识别”，会有一些影响)，但是其他时候都不会有影响。</p></blockquote><p><strong><em>以上未经过验证</em></strong></p><p>基于以上的说法，在设置改参数的时候需要考虑SGA的大小。在我的数据库中，一般设置MEMORY_TARGET为物理内存80%，SGA又占MEMORY_TARGET的80%，因此可将kernel.shmmax设置为物理内存的64%，一般情况下大于SGA即可，这里为了方便计算，我设置为物理-1byte，既8589934591byte</p><p><strong>kernel.shmall</strong>:</p><blockquote><p>该参数控制可以使用的共享内存的总页数。Linux共享内存页大小为4KB,共享内存段的大小都是共享内存页大小的整数倍。一个共享内存段的最大大小是16G，那么需要共享内存页数是16GB/4KB=16777216KB /4KB=4194304（页），也就是64Bit系统下16GB物理内存，设置kernel.shmall = 4194304才符合要求(几乎是原来设置2097152的两倍)。这时可以将shmmax参数调整到16G了，同时可以修改SGA_MAX_SIZE和SGA_TARGET为12G（您想设置的SGA最大大小，当然也可以是2G~14G等，还要协调PGA参数及OS等其他内存使用，不能设置太满，比如16G）</p></blockquote><p><strong><em>以上的说法来自于网络，这里贴出来仅供参考</em></strong></p><p>其实，该参数是用来控制可用的共享内存数的，单位是page(通常在linux中1page=4KB)，只要可用的共享内存书大于SGA的大小即可，一般默认的大小就可以满足大部分oracle的需求了，这里我没有修改默认值</p><p><strong><em>kernel.shmmni</em></strong>：</p><blockquote><p>该参数是共享内存段的最大数量。shmmni缺省值4096，一般肯定是够用了。</p></blockquote><p><strong><em>fs.file-max</em></strong>：</p><blockquote><p>该参数决定了系统中所允许的文件句柄最大数目，文件句柄设置代表linux系统中可以打开的文件的数量。</p></blockquote><p><strong><em>fs.aio-max-nr</em></strong>：</p><blockquote><p>此参数限制并发未完成的请求，应该设置避免I/O子系统故障。</p></blockquote><p><strong><em>kernel.sem</em></strong>：</p><blockquote><p>以kernel.sem = 250 32000 100 128为例：</p><p>​       250是参数semmsl的值，表示一个信号量集合中能够包含的信号量最大数目。</p><p>​       32000是参数semmns的值，表示系统内可允许的信号量最大数目。</p><p>​       100是参数semopm的值，表示单个semopm()调用在一个信号量集合上可以执行的操作数量。</p><p>​       128是参数semmni的值，表示系统信号量集合总数。</p></blockquote><p><strong><em>net.ipv4.ip_local_port_range</em></strong>：</p><blockquote><p>表示应用程序可使用的IPv4端口范围。</p></blockquote><p><strong><em>net.core.rmem_default</em></strong>：</p><blockquote><p>表示套接字接收缓冲区大小的缺省值。</p></blockquote><p><strong><em>net.core.rmem_max</em></strong>：</p><blockquote><p>表示套接字接收缓冲区大小的最大值。</p></blockquote><p><strong><em>net.core.wmem_default</em></strong>：</p><blockquote><p>表示套接字发送缓冲区大小的缺省值。</p></blockquote><p><strong><em>net.core.wmem_max</em></strong>：</p><blockquote><p>表示套接字发送缓冲区大小的最大值。</p></blockquote><p>执行<code>sysctl -p</code>使其生效</p><h4 id="关闭NTP"><a href="#关闭NTP" class="headerlink" title="关闭NTP"></a>关闭NTP</h4><p>Oracle Rac有自带的<strong>Oracle Cluster Time Synchronization Service</strong>来保证节点间的时间同步，因此，关闭自带的NTP服务</p><p>命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">/sbin/service ntpd stop</div><div class="line">chkconfig ntpd off</div><div class="line">mv /etc/ntp.conf /etc/ntp.conf.org</div><div class="line">rm /var/run/ntpd.pid</div></pre></td></tr></table></figure><h4 id="配置PAM"><a href="#配置PAM" class="headerlink" title="配置PAM"></a>配置PAM</h4><p>在node01和node02节点上编辑<strong>/etc/pam.d/login</strong>，添加如下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">session required pam_limits.so</div></pre></td></tr></table></figure><h4 id="limit文件"><a href="#limit文件" class="headerlink" title="limit文件"></a>limit文件</h4><p>在node01和node02节点上编辑<strong>/etc/security/limits.conf</strong>，添加如下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@oinstall hard nofile 65536</div><div class="line">@oinstall soft nofile 10240</div><div class="line">@oinstall hard nproc 16384</div><div class="line">@oinstall soft nproc 16384</div><div class="line">@oinstall hard stack 32768</div><div class="line">@oinstall soft stack 10240</div><div class="line">@oinstall soft memlock 475188563</div><div class="line">@oinstall hard memlock 475188563</div></pre></td></tr></table></figure><h4 id="关闭SELinux"><a href="#关闭SELinux" class="headerlink" title="关闭SELinux"></a>关闭SELinux</h4><p>在node01和node02上分别执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setenforce 0</div></pre></td></tr></table></figure><p>在node01和node02节点上编辑文件<strong>/etc/sysconfig/selinux</strong>，修改如下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELINUX=disabled</div></pre></td></tr></table></figure><h4 id="创建用户、组、文件夹"><a href="#创建用户、组、文件夹" class="headerlink" title="创建用户、组、文件夹"></a>创建用户、组、文件夹</h4><p>在node01和node02上分别执行如下命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">groupadd -g 1000 oinstall</div><div class="line">groupadd -g 1020 asmadmin</div><div class="line">groupadd -g 1021 asmdba</div><div class="line">groupadd -g 1022 asmoper</div><div class="line">groupadd -g 1031 dba</div><div class="line">groupadd -g 1032 oper</div><div class="line">useradd -u 1100 -g oinstall -G asmadmin,asmdba,asmoper,oper,dba grid</div><div class="line">useradd -u 1101 -g oinstall -G dba,asmdba,oper oracle</div><div class="line">mkdir -p /u01/software</div><div class="line">mkdir -p /u01/app/12.2.0/grid</div><div class="line">mkdir -p /u01/app/grid</div><div class="line">mkdir -p /u01/app/oracle</div><div class="line">chown -R grid:oinstall /u01</div><div class="line">chown oracle:oinstall /u01/app/oracle</div><div class="line">chmod -R 775 /u01/</div></pre></td></tr></table></figure><p>将下面的两个文件分别上传至node01的/u01/software文件夹下</p><ul><li>linuxx64_12201_grid_home.zip</li><li>linuxx64_12201_database.zip</li></ul><p>解压并修改对应权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd /u01/software</div><div class="line">unzip linuxx64_12201_grid_home.zip -d /u01/app/12.2.0/grid/</div><div class="line">chown -R grid:oinstall /u01/app/12.2.0/grid/</div><div class="line">unzip linuxx64_12201_database.zip</div><div class="line">chown oracle:oinstall database</div></pre></td></tr></table></figure><h4 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h4><h5 id="配置grid用户的环境变量"><a href="#配置grid用户的环境变量" class="headerlink" title="配置grid用户的环境变量"></a>配置grid用户的环境变量</h5><p>在node01上，grid用户</p><p>编辑<strong>/home/grid/.bash_profile</strong>，添加如下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">export ORACLE_SID=+ASM1</div><div class="line">export TMP=/tmp</div><div class="line">export ORACLE_BASE=/u01/app/grid</div><div class="line">export ORACLE_HOME=/u01/app/12.2.0/grid</div><div class="line">export PATH=$ORACLE_HOME/bin:/usr/sbin:$PATH</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib</div><div class="line">export LC_ALL=en_US.UTF-8</div></pre></td></tr></table></figure><p>在node02上，grid用户</p><p>编辑<strong>/home/grid/.bash_profile</strong>，添加如下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">export ORACLE_SID=+ASM2</div><div class="line">export TMP=/tmp</div><div class="line">export ORACLE_BASE=/u01/app/grid</div><div class="line">export ORACLE_HOME=/u01/app/12.2.0/grid</div><div class="line">export PATH=$ORACLE_HOME/bin:/usr/sbin:$PATH</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib</div><div class="line">export LC_ALL=en_US.UTF-8</div></pre></td></tr></table></figure><h5 id="配置oracle的环境变量"><a href="#配置oracle的环境变量" class="headerlink" title="配置oracle的环境变量"></a>配置oracle的环境变量</h5><p>在node01上，oracle用户</p><p>编辑<strong>/home/oracle/.bash_profile</strong>，添加如下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">export TMP=/tmp</div><div class="line">export ORACLE_BASE=/u01/app/oracle</div><div class="line">export ORACLE_HOME=$ORACLE_BASE/product/12.2.0/dbhome_1</div><div class="line">export ORACLE_SID=orcl1</div><div class="line">export PATH=$ORACLE_HOME/bin:/usr/sbin:$ORACLE_HOME/OPatch:$PATH</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib</div><div class="line">export NLS_LANG=AMERICAN_AMERICA.UTF8</div><div class="line">export LC_ALL=en_US.UTF-8</div></pre></td></tr></table></figure><p>在node02上，oracle用户</p><p>编辑<strong>/home/oracle/.bash_profile</strong>，添加如下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">export TMP=/tmp</div><div class="line">export ORACLE_BASE=/u01/app/oracle</div><div class="line">export ORACLE_HOME=$ORACLE_BASE/product/12.2.0/dbhome_1</div><div class="line">export ORACLE_SID=orcl2</div><div class="line">export PATH=$ORACLE_HOME/bin:/usr/sbin:$ORACLE_HOME/OPatch:$PATH</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib</div><div class="line">export NLS_LANG=AMERICAN_AMERICA.UTF8</div><div class="line">export LC_ALL=en_US.UTF-8</div></pre></td></tr></table></figure><h3 id="配置SSH互信"><a href="#配置SSH互信" class="headerlink" title="配置SSH互信"></a>配置SSH互信</h3><p>在node01上，grid用户，分别为grid用户和oracle用户配置SSH互信。</p><p><strong><em>注：配置过程中需要输入grid和oracle用户的密码，请提前设置好</em></strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd /u01/app/12.2.0/grid/oui/prov/resources/scripts/</div><div class="line">./sshUserSetup.sh -hosts &quot;node01 node02&quot; -user grid  -advanced -noPromptPassphrase</div><div class="line">./sshUserSetup.sh -hosts &quot;node01 node02&quot; -user oracle  -advanced -noPromptPassphrase</div></pre></td></tr></table></figure><p>在node01上，grid用户，尝试登录node02验证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[grid@node01 ~]$ ssh node02 hostname</div><div class="line">node02.myCluster.com</div><div class="line">[grid@node01 ~]$ ssh node02-priv hostname</div><div class="line">node02.myCluster.com</div></pre></td></tr></table></figure><p>在node02上，grid用户，尝试登录node01验证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[grid@node02 ~]$ ssh node01 hostname</div><div class="line">node01.myCluster.com</div><div class="line">[grid@node02 ~]$ ssh node01-priv hostname</div><div class="line">node01.myCluster.com</div></pre></td></tr></table></figure><p>在node01上，oracle用户，尝试登录node02验证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[oracle@node01 ~]$ ssh node02 hostname</div><div class="line">node02.myCluster.com</div><div class="line">[oracle@node01 ~]$ ssh node02-priv hostname</div><div class="line">node02.myCluster.com</div></pre></td></tr></table></figure><p>在node02上，oracle用户，尝试登录node01验证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[oracle@node02 ~]$ ssh node01 hostname</div><div class="line">node01.myCluster.com</div><div class="line">[oracle@node02 ~]$ ssh node01-priv hostname</div><div class="line">node01.myCluster.com</div></pre></td></tr></table></figure><h3 id="配置存储"><a href="#配置存储" class="headerlink" title="配置存储"></a>配置存储</h3><p>在华为云控制台选购磁盘，共享模式选择共享，磁盘模式选择VBD(这里使用的是VBD的磁盘，使用oracleasm来配置共享磁盘)</p><h4 id="安装ASMLIB"><a href="#安装ASMLIB" class="headerlink" title="安装ASMLIB"></a>安装ASMLIB</h4><p>参考<a href="/2017/11/27/abc/" title="Centos6.8安装ASMLIB">Centos6.8安装ASMLIB</a></p><h4 id="创建分区"><a href="#创建分区" class="headerlink" title="创建分区"></a>创建分区</h4><p><strong><em>注：</em></strong></p><ul><li><strong><em>我的共享磁盘挂载点为/dev/xvdc</em></strong></li><li><strong><em>OCR_VOT_GIMR磁盘组和DATA磁盘组的冗余类型都选择为External</em></strong></li><li><strong><em>/dev/sdb共100G空间，创建1个40G分区分配给OCR_VOT_GIMR磁盘组使用，创建一个60G分区分配至DATA磁盘组</em></strong></li><li><strong><em>ASM磁盘要求参考<a href="https://docs.oracle.com/database/122/CWLIN/oracle-clusterware-storage-space-requirements.htm#CWLIN-GUID-97FD5D40-A65B-4575-AD12-06C491AF3F41" target="_blank" rel="external">官方文档</a></em></strong></li></ul><p>在node01上执行，仅分区即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# fdisk /dev/xvdc</div><div class="line">Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel</div><div class="line">Building a new DOS disklabel with disk identifier 0x3c07d9cd.</div><div class="line">Changes will remain in memory only, until you decide to write them.</div><div class="line">After that, of course, the previous content won't be recoverable.</div><div class="line">Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)</div><div class="line">WARNING: DOS-compatible mode is deprecated. It's strongly recommended to</div><div class="line">         switch off the mode (command 'c') and change display units to</div><div class="line">         sectors (command 'u').</div><div class="line">Command (m for help): n</div><div class="line">Command action</div><div class="line">   e   extended</div><div class="line">   p   primary partition (1-4)</div><div class="line">p</div><div class="line">Partition number (1-4): 1</div><div class="line">First cylinder (1-13054, default 1):</div><div class="line">Using default value 1</div><div class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1-13054, default 13054): +40G</div><div class="line">Command (m for help): n</div><div class="line">Command action</div><div class="line">   e   extended</div><div class="line">   p   primary partition (1-4)</div><div class="line">p</div><div class="line">Partition number (1-4): 2</div><div class="line">First cylinder (5224-13054, default 5224):</div><div class="line">Using default value 5224</div><div class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (5224-13054, default 13054):</div><div class="line">Using default value 13054</div><div class="line">Command (m for help): w</div><div class="line">The partition table has been altered!</div><div class="line">Calling ioctl() to re-read partition table.</div><div class="line">Syncing disks.</div></pre></td></tr></table></figure><p>分区结果如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# fdisk -l /dev/xvdc</div><div class="line">Disk /dev/xvdc: 107.4 GB, 107374182400 bytes</div><div class="line">255 heads, 63 sectors/track, 13054 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x3c07d9cd</div><div class="line">    Device Boot      Start         End      Blocks   Id  System</div><div class="line">/dev/xvdc1               1        5223    41953716   83  Linux</div><div class="line">/dev/xvdc2            5224       13054    62902507+  83  Linux</div></pre></td></tr></table></figure><h4 id="创建磁盘组"><a href="#创建磁盘组" class="headerlink" title="创建磁盘组"></a>创建磁盘组</h4><p>node01执行如下命令创建磁盘组：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# oracleasm createdisk OCR_VOT_GIMR /dev/xvdc1</div><div class="line">Writing disk header: done</div><div class="line">Instantiating disk: done</div><div class="line">[root@node01 ~]# oracleasm createdisk DATA /dev/xvdc2</div><div class="line">Writing disk header: done</div><div class="line">Instantiating disk: done</div></pre></td></tr></table></figure><p>使用<code>oracleasm listdisks</code>查看已创建的磁盘组，如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@node01 ~]# oracleasm listdisks</div><div class="line">DATA</div><div class="line">OCR_VOT_GIMR</div></pre></td></tr></table></figure><p>在node02上扫描node01上创建的磁盘组，如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@node02 ~]# oracleasm scandisks</div><div class="line">Reloading disk partitions: done</div><div class="line">Cleaning any stale ASM disks...</div><div class="line">Scanning system for ASM disks...</div><div class="line">Instantiating disk "OCR_VOT_GIMR"</div><div class="line">Instantiating disk "DATA"</div></pre></td></tr></table></figure><p>使用<code>oracleasm listdisks</code>查看扫描到的磁盘组，如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@node02 ~]# oracleasm listdisks</div><div class="line">DATA</div><div class="line">OCR_VOT_GIMR</div></pre></td></tr></table></figure><p>至此，安装环境准备完成。</p><p>接着看<a href="/2017/11/27/hwcloud上的Oracle-RAC-12cR2安装手册-2-grid的安装/" title="hwcloud上的Oracle RAC 12cR2安装手册(2)--grid的安装">hwcloud上的Oracle RAC 12cR2安装手册(2)--grid的安装</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;网络&quot;&gt;&lt;a href=&quot;#网络&quot; class=&quot;headerlink&quot; title=&quot;网络&quot;&gt;&lt;/a&gt;网络&lt;/h3&gt;&lt;h4 id=&quot;网卡分配&quot;&gt;&lt;a href=&quot;#网卡分配&quot; class=&quot;headerlink&quot; title=&quot;网卡分配&quot;&gt;&lt;/a&gt;网卡分配&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;网卡名&lt;/th&gt;
&lt;th&gt;作用&lt;/th&gt;
&lt;th&gt;网段&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;eth0&lt;/td&gt;
&lt;td&gt;Public IP&lt;/td&gt;
&lt;td&gt;192.168.1.0/24&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;eth1&lt;/td&gt;
&lt;td&gt;NET IP&lt;/td&gt;
&lt;td&gt;192.168.2.0/24&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;eth2&lt;/td&gt;
&lt;td&gt;Private IP&lt;/td&gt;
&lt;td&gt;192.168.6.0/24&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;这里我用了三块网卡：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;eth0做Public IP的网卡，同时会绑定Virtual IP 和 SCAN IP&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;eth1做NET IP的网卡，用来提供访问互联网的服务&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;eth2做Private的网卡，用来做节点之间的数据交互&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;注：在华为云控制台关闭node01节点和node02节点的Public IP网卡的&lt;code&gt;源/目的检查&lt;/code&gt;，否则虚拟ip是不通的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="oracle" scheme="https://shijieqin.github.io/categories/oracle/"/>
    
      <category term="rac" scheme="https://shijieqin.github.io/categories/oracle/rac/"/>
    
    
      <category term="oracle" scheme="https://shijieqin.github.io/tags/oracle/"/>
    
      <category term="rac" scheme="https://shijieqin.github.io/tags/rac/"/>
    
  </entry>
  
  <entry>
    <title>Performing RMAN Recovery</title>
    <link href="https://shijieqin.github.io/2017/11/17/Performing-RMAN-Recovery/"/>
    <id>https://shijieqin.github.io/2017/11/17/Performing-RMAN-Recovery/</id>
    <published>2017-11-17T03:14:10.000Z</published>
    <updated>2017-11-17T03:14:10.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="安装数据库软件-不需要安装实例"><a href="#安装数据库软件-不需要安装实例" class="headerlink" title="安装数据库软件(不需要安装实例)"></a>安装数据库软件(不需要安装实例)</h3><p>略</p><h3 id="创建对应路径-与原库路径一致"><a href="#创建对应路径-与原库路径一致" class="headerlink" title="创建对应路径(与原库路径一致)"></a>创建对应路径(与原库路径一致)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">mkdir -p /u01/app/oracle/oradata/TEST</div><div class="line">mkdir -p /u01/app/oracle/fast_recovery_area</div><div class="line">mkdir -p /u01/app/oracle/admin/TEST</div><div class="line">mkdir /u01/app/oracle/admin/TEST/adump</div><div class="line">mkdir /u01/app/oracle/admin/TEST/bdump</div><div class="line">mkdir /u01/app/oracle/admin/TEST/cdump</div><div class="line">mkdir /u01/app/oracle/admin/TEST/ddump</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/19A9B2E4ED836CFCE0537680A8C03E8F/DATAFILE</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/1A325228C22837A9E0537680A8C0AB5A/DATAFILE</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/BCG/DATAFILE</div><div class="line">mkdir /u01/app/oracle/oradata/TEST/CONTROLFILE</div><div class="line">mkdir /u01/app/oracle/oradata/TEST/DATAFILE</div></pre></td></tr></table></figure><h3 id="开始恢复"><a href="#开始恢复" class="headerlink" title="开始恢复"></a>开始恢复</h3><a id="more"></a><p>rman target / nocatalog</p><h4 id="设置DBID"><a href="#设置DBID" class="headerlink" title="设置DBID"></a>设置DBID</h4><p>可通过原库查询，也可通过控制文件的备份名称获得(备份名称c-DBID-date-num.bak)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SET</span> DBID <span class="number">999753383</span>;</div></pre></td></tr></table></figure><h4 id="恢复spfile-和-pfile"><a href="#恢复spfile-和-pfile" class="headerlink" title="恢复spfile 和 pfile"></a>恢复spfile 和 pfile</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">STARTUP NOMOUNT;</div><div class="line"><span class="keyword">RESTORE</span> <span class="keyword">SPFILE</span> <span class="keyword">FROM</span> <span class="string">'/u01/rmanbak/c-999753383-20170925-00.bak'</span>;</div><div class="line"><span class="keyword">RESTORE</span> <span class="keyword">SPFILE</span> <span class="keyword">TO</span> PFILE <span class="string">'/u01/app/oracle/product/12.1.0/dbhome_1/dbs/initTEST.ora'</span> <span class="keyword">FROM</span> <span class="string">'/u01/rmanbak/c-999753383-20170925-00.bak'</span>;</div></pre></td></tr></table></figure><h4 id="结合当前服务器的配置信息修改pfile文件"><a href="#结合当前服务器的配置信息修改pfile文件" class="headerlink" title="结合当前服务器的配置信息修改pfile文件"></a>结合当前服务器的配置信息修改pfile文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">TEST.__data_transfer_cache_size=0</div><div class="line">TEST.__db_cache_size=1010827260</div><div class="line">TEST.__java_pool_size=20971520</div><div class="line">TEST.__large_pool_size=8388608</div><div class="line">TEST.__oracle_base=&apos;/u01/app/oracle&apos;#ORACLE_BASE set from environment</div><div class="line">TEST.__pga_aggregate_target=289406976</div><div class="line">TEST.__sga_target=1333788670</div><div class="line">TEST.__shared_io_pool_size=46137344</div><div class="line">TEST.__shared_pool_size=234881024</div><div class="line">TEST.__streams_pool_size=8388608</div><div class="line">*.audit_file_dest=&apos;/u01/app/oracle/admin/TEST/adump&apos;</div><div class="line">*.audit_trail=&apos;db&apos;</div><div class="line">*.compatible=&apos;12.1.0.2.0&apos;</div><div class="line">*.control_files=&apos;/u01/app/oracle/oradata/TEST/CONTROLFILE/current.257.883692833&apos;,&apos;/u01/app/oracle/oradata/TEST/CONTROLFILE/current.258.883692835&apos;</div><div class="line">*.db_block_size=32768</div><div class="line">*.db_domain=&apos;&apos;</div><div class="line">*.db_name=&apos;TEST&apos;</div><div class="line">*.db_recovery_file_dest_size=30g</div><div class="line">*.diagnostic_dest=&apos;/u01/app/oracle&apos;</div><div class="line">*.dispatchers=&apos;(PROTOCOL=TCP) (SERVICE=TESTXDB)&apos;</div><div class="line">*.enable_pluggable_database=true</div><div class="line">*.open_cursors=300</div><div class="line">*.pga_aggregate_target=1310m</div><div class="line">*.processes=1500</div><div class="line">*.remote_login_passwordfile=&apos;exclusive&apos;</div><div class="line">*.resource_manager_plan=&apos;&apos;</div><div class="line">*.sga_target=5242m</div></pre></td></tr></table></figure><h4 id="使用pfile文件启动数据库到NOMOUNT状态"><a href="#使用pfile文件启动数据库到NOMOUNT状态" class="headerlink" title="使用pfile文件启动数据库到NOMOUNT状态"></a>使用pfile文件启动数据库到NOMOUNT状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">STARTUP FORCE NOMOUNT PFILE=&apos;/u01/app/oracle/product/12.1.0/dbhome_1/dbs/initTEST.ora&apos;;</div></pre></td></tr></table></figure><h4 id="恢复控制文件"><a href="#恢复控制文件" class="headerlink" title="恢复控制文件"></a>恢复控制文件</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">RESTORE</span> <span class="keyword">CONTROLFILE</span> <span class="keyword">FROM</span> <span class="string">'/u01/rmanbak/c-999753383-20170925-00.bak'</span>;</div></pre></td></tr></table></figure><h4 id="切换数据库为MOUNT状态"><a href="#切换数据库为MOUNT状态" class="headerlink" title="切换数据库为MOUNT状态"></a>切换数据库为MOUNT状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sql &apos;alter database mount&apos;;</div></pre></td></tr></table></figure><h4 id="执行恢复"><a href="#执行恢复" class="headerlink" title="执行恢复"></a>执行恢复</h4><p>以下之所以rename，因为新库的数据文件路径发生改变，所以需要rename，可通过再rman中执行report schema查看所有的数据文件名和文件编号</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div></pre></td><td class="code"><pre><div class="line">CATALOG <span class="keyword">START</span> <span class="keyword">WITH</span> <span class="string">'/u01/rmanbak'</span>;</div><div class="line">RUN</div><div class="line">&#123;</div><div class="line">  ALLOCATE CHANNEL c1 TYPE DISK;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">1</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/DATAFILE/system.263.883692841'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">2</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/19A9B2E4ED836CFCE0537680A8C03E8F/DATAFILE/system.264.883692851'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">3</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/DATAFILE/sysaux.265.883692857'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">4</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/19A9B2E4ED836CFCE0537680A8C03E8F/DATAFILE/sysaux.266.883692865'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">5</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/DATAFILE/undotbs1.267.883692869'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">6</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/DATAFILE/undotbs2.270.883692925'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">7</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/DATAFILE/users.271.883692927'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">15</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1A325228C22837A9E0537680A8C0AB5A/DATAFILE/system.282.884366019'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">16</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1A325228C22837A9E0537680A8C0AB5A/DATAFILE/sysaux.281.884366019'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">20</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1A325228C22837A9E0537680A8C0AB5A/DATAFILE/fcprod_01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">21</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1A325228C22837A9E0537680A8C0AB5A/DATAFILE/fcprod_02.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">22</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE/system.288.885650835'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">23</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE/sysaux.289.885650835'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">24</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE/sugontra_01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">25</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE/sugontra_02.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">33</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE/sgtread.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">38</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/system.365.897157457'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">39</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sysaux.376.897157457'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">42</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/system.886.898112773'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">43</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/sysaux.896.898112773'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">44</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/absenpro_01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">45</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/absenpro_02.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">50</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">51</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_02.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">63</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_data.2127.902684869'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">64</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/system.4371.904906001'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">65</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/sysaux.4372.904906011'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">66</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4376.904906531'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">67</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4377.904906561'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">68</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4378.904906591'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">69</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4379.904906621'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">70</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4380.904906651'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">71</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4381.904906683'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">72</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4382.904906713'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">73</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4383.904906741'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">74</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data.4384.904906771'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">75</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/system.9415.906672919'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">76</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/sysaux.11560.906672919'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">77</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">78</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_02.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">79</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_03.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">80</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_03.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">81</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_04.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">82</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_05.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">83</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_06.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">84</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_04.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">85</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/absenpro_03.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">86</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_10.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">87</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_data_6.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">88</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_7.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">89</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_11.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">90</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_8.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">91</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_9.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">92</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_12.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">93</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_10.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">94</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_11.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">95</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_12.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">96</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_13.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">116</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_13.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">117</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_14.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">118</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_15.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">119</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_16.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">120</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_14.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">121</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/system.6863.913669707'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">122</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/sysaux.6861.913669707'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">123</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/shacpro_01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">124</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/shacpro_02.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">125</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/shacpro_03.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">126</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/shacpro_04.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">127</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/shacpro_05.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">128</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_15.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">129</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_17.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">130</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_data_7.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">131</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_18.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">132</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_19.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">133</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_16.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">134</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_20.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">135</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_21.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">136</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_17.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">137</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/absenpro_data_4.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">142</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/absenpro_data_5.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">147</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_data_8.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">149</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_18.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">150</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_data_19.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">151</span> <span class="keyword">TO</span><span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_22.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">152</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_data_9.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">153</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_23.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">154</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/absenpro_data_6.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">155</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_24.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">156</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/shacpro_06.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">157</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_25.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">169</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/system01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">170</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/sysaux01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">171</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">172</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_02.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">173</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_03.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">174</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_04.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">175</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_05.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">176</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_06.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">177</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_07.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">178</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_08.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">179</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/clouddemo_09.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">180</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_data_26.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> <span class="keyword">DATAFILE</span> <span class="number">181</span> <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/shacpro_07.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">1</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/TEMPFILE/temp.268.883692873'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">2</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/19A9B2E4ED836CFCE0537680A8C03E8F/TEMPFILE/temp.269.883692873'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">3</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_temp.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">4</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1A325228C22837A9E0537680A8C0AB5A/TEMPFILE/temp.283.884366053'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">5</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1A325228C22837A9E0537680A8C0AB5A/DATAFILE/fcprod_temp.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">6</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/TEMPFILE/temp.290.885650869'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">7</span>     <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE/sugontra_temp.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">8</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/TEMPFILE/temp.9418.906672955'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">9</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE/zzmetro_temp.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">10</span>   <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE/sgtread_temp.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">11</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/BCG/DATAFILE/temp01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">13</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/TEMPFILE/temp.462.897157491'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">14</span>    <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE/sugonpro_temp.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">15</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/TEMPFILE/temp.898.898112805'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">16</span>    <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE/absenpro_temp.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">19</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/ljbb_temp_01.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">20</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/TEMPFILE/temp.6857.913669745'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">21</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE/shacpro_temp.dbf'</span>;</div><div class="line">  <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> TEMPFILE <span class="number">25</span>  <span class="keyword">TO</span> <span class="string">'/u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE/temp001.dbf'</span>;</div><div class="line">  <span class="keyword">RESTORE</span> <span class="keyword">DATABASE</span>;</div><div class="line">  switch DATAFILE all;</div><div class="line">  switch tempfile all;</div><div class="line">  RECOVER DATABASE;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>由于归档日志缺失，只能部分恢复数据库，也就是只能恢复到rman备份的那一刻，根据报错显示的SCN号，恢复到指定SCN</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">RECOVER DATABASE UNTIL SCN 10144773006017;</div></pre></td></tr></table></figure><h4 id="根据pfile创建spfile"><a href="#根据pfile创建spfile" class="headerlink" title="根据pfile创建spfile"></a>根据pfile创建spfile</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Create</span> <span class="keyword">spfile</span> <span class="keyword">from</span> pfile=<span class="string">'/u01/app/oracle/product/12.1.0/dbhome_1/dbs/initTEST.ora'</span>;</div></pre></td></tr></table></figure><h4 id="修改日志文件路径"><a href="#修改日志文件路径" class="headerlink" title="修改日志文件路径"></a>修改日志文件路径</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">member</span> <span class="keyword">from</span> v$<span class="keyword">logfile</span>;</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/ONLINELOG;</div><div class="line">mkdir -p /u01/app/oracle/oradata/TEST/STANDBYLOG;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/ONLINELOG/group1.259.883692835'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/ONLINELOG/group1.259.883692835'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/ONLINELOG/group1.260.883692837'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/ONLINELOG/group1.260.883692837'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/ONLINELOG/group2.261.883692837'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/ONLINELOG/group2.261.883692837'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/ONLINELOG/group2.262.883692839'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/ONLINELOG/group2.262.883692839'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/ONLINELOG/group3.272.883704715'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/ONLINELOG/group3.272.883704715'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/ONLINELOG/group3.273.883704717'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/ONLINELOG/group3.273.883704717'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/ONLINELOG/group4.274.883704719'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/ONLINELOG/group4.274.883704719'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/ONLINELOG/group4.275.883704721'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/ONLINELOG/group4.275.883704721'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/STANDBYLOG/standby_group11.log'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/STANDBYLOG/standby_group11.log'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/STANDBYLOG/standby_group12.log'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/STANDBYLOG/standby_group12.log'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/STANDBYLOG/standby_group13.log'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/STANDBYLOG/standby_group13.log'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/STANDBYLOG/standby_group14.log'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/STANDBYLOG/standby_group14.log'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/STANDBYLOG/standby_group15.log'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/STANDBYLOG/standby_group15.log'</span>;</div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">rename</span> <span class="keyword">file</span> <span class="string">'+DATA/TEST/STANDBYLOG/standby_group16.log'</span> <span class="keyword">to</span> <span class="string">'/u01/app/oracle/oradata/TEST/STANDBYLOG/standby_group16.log'</span>;</div></pre></td></tr></table></figure><h4 id="启动数据库"><a href="#启动数据库" class="headerlink" title="启动数据库"></a>启动数据库</h4><p>由于修改了数据库日志路径，第一次启动需要resetlogs</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">open</span> <span class="keyword">resetlogs</span>;</div></pre></td></tr></table></figure><h3 id="创建lisenter"><a href="#创建lisenter" class="headerlink" title="创建lisenter"></a>创建lisenter</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">netca /silent /responsefile /u01/software/database/response/netca.rsp</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;安装数据库软件-不需要安装实例&quot;&gt;&lt;a href=&quot;#安装数据库软件-不需要安装实例&quot; class=&quot;headerlink&quot; title=&quot;安装数据库软件(不需要安装实例)&quot;&gt;&lt;/a&gt;安装数据库软件(不需要安装实例)&lt;/h3&gt;&lt;p&gt;略&lt;/p&gt;
&lt;h3 id=&quot;创建对应路径-与原库路径一致&quot;&gt;&lt;a href=&quot;#创建对应路径-与原库路径一致&quot; class=&quot;headerlink&quot; title=&quot;创建对应路径(与原库路径一致)&quot;&gt;&lt;/a&gt;创建对应路径(与原库路径一致)&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/fast_recovery_area&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/admin/TEST&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir /u01/app/oracle/admin/TEST/adump&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir /u01/app/oracle/admin/TEST/bdump&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir /u01/app/oracle/admin/TEST/cdump&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir /u01/app/oracle/admin/TEST/ddump&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/19A9B2E4ED836CFCE0537680A8C03E8F/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/1A325228C22837A9E0537680A8C0AB5A/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/1B5D770684A12982E0537680A8C00768/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/25C07163596B0AD0E0537680A8C0EAE1/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/268AC0DAD4617497E0537680A8C0152A/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/2CB869B96579626EE0530C30A8C0E46C/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/2E2B9591B4C13CC9E0537680A8C09CCF/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/347488B0A2DA5C21E0537680A8C0E0CA/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /u01/app/oracle/oradata/TEST/BCG/DATAFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir /u01/app/oracle/oradata/TEST/CONTROLFILE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir /u01/app/oracle/oradata/TEST/DATAFILE&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;开始恢复&quot;&gt;&lt;a href=&quot;#开始恢复&quot; class=&quot;headerlink&quot; title=&quot;开始恢复&quot;&gt;&lt;/a&gt;开始恢复&lt;/h3&gt;
    
    </summary>
    
      <category term="oracle" scheme="https://shijieqin.github.io/categories/oracle/"/>
    
      <category term="rman" scheme="https://shijieqin.github.io/categories/oracle/rman/"/>
    
    
      <category term="oracle" scheme="https://shijieqin.github.io/tags/oracle/"/>
    
      <category term="rman" scheme="https://shijieqin.github.io/tags/rman/"/>
    
  </entry>
  
  <entry>
    <title>rebuild oracle password file</title>
    <link href="https://shijieqin.github.io/2017/10/19/rebuild-oracle-password-file/"/>
    <id>https://shijieqin.github.io/2017/10/19/rebuild-oracle-password-file/</id>
    <published>2017-10-19T07:47:40.000Z</published>
    <updated>2017-10-19T07:47:40.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h3><p>之前通过rman将一台生产库恢复到了另外一台服务器上。今天使用sys用户连接数据库时，一直报用户名密码错误，后台通过<strong>sys / as sysdba</strong>登录服务器之后，使用<strong>alter user sys identified by newpassword</strong>修改密码之后依然不能使用密码登录数据库，因此才有如下解决方式。</p><a id="more"></a><p>原因是因为数据库回复后并没有生成对应的密码文件，因此sys用户无法作为sysdba登录，在开始之前需要先检查数据库的<strong>remote_login_passwordfile</strong>参数为<strong>exclusive</strong>，这也是oracle数据库的默认值。</p><p>检查方式如下：</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; show parameter remote_login_passwordfile</div></pre></td></tr></table></figure><p>VALUE值为<strong>EXCLUSIVE</strong>即可</p><p>关于密码文件：</p><ol><li>oracle官网解释说在用DBCA创建数据库对的时候会自动创建密码文件，所以用DBCA创建的数据库一般是没问题的，但是我这次是用rman恢复的实例，不知道是否我原库是RAC的原因，恢复完之后并没有密码文件</li><li>具有管理员权限的角色(<code>SYSDBA</code>, <code>SYSOPER</code>, <code>SYSBACKUP</code>, <code>SYSDG</code>, or <code>SYSKM</code>)都会通过密码文件进行验证，而不是通过数据库来进行验证，但前提是该用户在数据库中存在。</li><li>密码文件中保存的密码是区分大小写的</li><li>RAC的密码文件是保存在ASM磁盘中的</li></ol><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>重建密码文件即可，其中密码文件的路径为<strong>$ORACLE_HOME/dbs/orapw<em>$instance_name</em></strong></p><p>其中最后的文件名必须是<strong>orapw</strong>与<strong>instance_name</strong>拼接起来的名字，假设这里的instance_name为TEST</p><p>使用如下命令重建密码文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> orapwd file="$ORACLE_HOME/dbs/orapwTEST" password=testtest</div></pre></td></tr></table></figure><p>重建之后即可正常使用密码登录sys了，其中password指定的就是sys的密码</p><p>验证密码文件是否生效可登陆数据库后同若如下命令验证</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select * from v$pwfile_users;</div></pre></td></tr></table></figure><p>如果密码文件没生效，则查出的结果为空，如果密码生效了，则查出的是记录在密码文件中的用户，默认仅有SYS用户。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;起因&quot;&gt;&lt;a href=&quot;#起因&quot; class=&quot;headerlink&quot; title=&quot;起因&quot;&gt;&lt;/a&gt;起因&lt;/h3&gt;&lt;p&gt;之前通过rman将一台生产库恢复到了另外一台服务器上。今天使用sys用户连接数据库时，一直报用户名密码错误，后台通过&lt;strong&gt;sys / as sysdba&lt;/strong&gt;登录服务器之后，使用&lt;strong&gt;alter user sys identified by newpassword&lt;/strong&gt;修改密码之后依然不能使用密码登录数据库，因此才有如下解决方式。&lt;/p&gt;
    
    </summary>
    
      <category term="oracle" scheme="https://shijieqin.github.io/categories/oracle/"/>
    
    
      <category term="oracle" scheme="https://shijieqin.github.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>create LVM disk</title>
    <link href="https://shijieqin.github.io/2017/07/19/create-LVM-disk/"/>
    <id>https://shijieqin.github.io/2017/07/19/create-LVM-disk/</id>
    <published>2017-07-19T08:24:04.000Z</published>
    <updated>2017-07-19T08:24:04.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="创建物理分区"><a href="#创建物理分区" class="headerlink" title="创建物理分区"></a>创建物理分区</h3><h4 id="查看是否有未分区的磁盘"><a href="#查看是否有未分区的磁盘" class="headerlink" title="查看是否有未分区的磁盘"></a>查看是否有未分区的磁盘</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@srm-fs ~]# fdisk -l</div><div class="line">Disk /dev/xvda: 42.9 GB, 42949672960 bytes</div><div class="line">255 heads, 63 sectors/track, 5221 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x000d6814</div><div class="line">    Device Boot      Start         End      Blocks   Id  System</div><div class="line">/dev/xvda1               1         523     4194304   82  Linux swap / Solaris</div><div class="line">Partition 1 does not end on cylinder boundary.</div><div class="line">/dev/xvda2   *         523        5222    37747712   83  Linux</div><div class="line">Disk /dev/xvdb: 536.9 GB, 536870912000 bytes</div><div class="line">255 heads, 63 sectors/track, 65270 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x00000000</div><div class="line">Disk /dev/xvdc: 536.9 GB, 536870912000 bytes</div><div class="line">255 heads, 63 sectors/track, 65270 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x00000000</div></pre></td></tr></table></figure><p>发现有两个未使用的磁盘，这里以xvdb为例<br><a id="more"></a></p><h4 id="在磁盘xvdb上创建xvdb1分区"><a href="#在磁盘xvdb上创建xvdb1分区" class="headerlink" title="在磁盘xvdb上创建xvdb1分区"></a>在磁盘xvdb上创建xvdb1分区</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[root@srm-fs ~]# fdisk /dev/xvdb</div><div class="line">Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel</div><div class="line">Building a new DOS disklabel with disk identifier 0xf72f347d.</div><div class="line">Changes will remain in memory only, until you decide to write them.</div><div class="line">After that, of course, the previous content won&apos;t be recoverable.</div><div class="line">Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)</div><div class="line">WARNING: DOS-compatible mode is deprecated. It&apos;s strongly recommended to</div><div class="line">         switch off the mode (command &apos;c&apos;) and change display units to</div><div class="line">         sectors (command &apos;u&apos;).</div><div class="line">Command (m for help): n</div><div class="line">Command action</div><div class="line">   e   extended</div><div class="line">   p   primary partition (1-4)</div><div class="line">p</div><div class="line">Partition number (1-4): 1</div><div class="line">First cylinder (1-65270, default 1):</div><div class="line">Using default value 1</div><div class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1-65270, default 65270):</div><div class="line">Using default value 65270</div><div class="line">添加磁盘系统表id为8e(LVM的标识)</div><div class="line">Command (m for help): t</div><div class="line">Selected partition 1</div><div class="line">Hex code (type L to list codes): 8e</div><div class="line">Changed system type of partition 1 to 8e (Linux LVM)</div><div class="line">保存分区表</div><div class="line">Command (m for help): w</div><div class="line">The partition table has been altered!</div><div class="line">Calling ioctl() to re-read partition table.</div></pre></td></tr></table></figure><h3 id="将分区划分为物理卷，主要是添加LVM属性信息并划分PE存储单元"><a href="#将分区划分为物理卷，主要是添加LVM属性信息并划分PE存储单元" class="headerlink" title="将分区划分为物理卷，主要是添加LVM属性信息并划分PE存储单元."></a>将分区划分为物理卷，主要是添加LVM属性信息并划分PE存储单元.</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@srm-fs ~]# pvcreate /dev/xvdb1</div><div class="line">  Physical volume &quot;/dev/xvdb1&quot; successfully created</div><div class="line">[root@srm-fs ~]# pvs</div><div class="line">  PV         VG   Fmt  Attr PSize   PFree  </div><div class="line">  /dev/xvdb1      lvm2 a--  499.99g 499.99g</div><div class="line">[root@srm-fs ~]# pvdisplay</div><div class="line">  &quot;/dev/xvdb1&quot; is a new physical volume of &quot;499.99 GiB&quot;</div><div class="line">  --- NEW Physical volume ---</div><div class="line">  PV Name               /dev/xvdb1</div><div class="line">  VG Name               </div><div class="line">  PV Size               499.99 GiB</div><div class="line">  Allocatable           NO</div><div class="line">  PE Size               0   </div><div class="line">  Total PE              0</div><div class="line">  Free PE               0</div><div class="line">  Allocated PE          0</div><div class="line">  PV UUID               5KBToI-5jzg-P0ra-kdZO-3bt2-MRS2-Hbbjk3</div></pre></td></tr></table></figure><h3 id="创建卷组vg-atm-并将分区xvdb1加入卷组"><a href="#创建卷组vg-atm-并将分区xvdb1加入卷组" class="headerlink" title="创建卷组vg-atm, 并将分区xvdb1加入卷组"></a>创建卷组vg-atm, 并将分区xvdb1加入卷组</h3><p>其中PE为卷组的最小存储单元，可通过-s命令修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@srm-fs ~]# vgcreate vg-atm /dev/xvdb1</div><div class="line">  Volume group &quot;vg-atm&quot; successfully created</div><div class="line">[root@srm-fs ~]# vgs</div><div class="line">  VG     #PV #LV #SN Attr   VSize   VFree  </div><div class="line">  vg-atm   1   0   0 wz--n- 499.99g 499.99g</div><div class="line">[root@srm-fs ~]# vgdisplay</div><div class="line">  --- Volume group ---</div><div class="line">  VG Name               vg-atm</div><div class="line">  System ID             </div><div class="line">  Format                lvm2</div><div class="line">  Metadata Areas        1</div><div class="line">  Metadata Sequence No  1</div><div class="line">  VG Access             read/write</div><div class="line">  VG Status             resizable</div><div class="line">  MAX LV                0</div><div class="line">  Cur LV                0</div><div class="line">  Open LV               0</div><div class="line">  Max PV                0</div><div class="line">  Cur PV                1</div><div class="line">  Act PV                1</div><div class="line">  VG Size               499.99 GiB</div><div class="line">  PE Size               4.00 MiB</div><div class="line">  Total PE              127998</div><div class="line">  Alloc PE / Size       0 / 0   </div><div class="line">  Free  PE / Size       127998 / 499.99 GiB</div><div class="line">  VG UUID               8Enzk5-pm35-z6OQ-ee2v-RW4X-vp1n-00Z2Ua</div></pre></td></tr></table></figure></p><h4 id="从vg-atm卷组创建逻辑分区lv-atm1"><a href="#从vg-atm卷组创建逻辑分区lv-atm1" class="headerlink" title="从vg-atm卷组创建逻辑分区lv-atm1"></a>从vg-atm卷组创建逻辑分区lv-atm1</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@srm-fs ~]# lvcreate -l 127998 -n lv-atm1 vg-atm</div><div class="line">  Logical volume &quot;lv-atm1&quot; created</div><div class="line">其中，指定创建的逻辑分区大小有两种方式:</div><div class="line">-L 后面指定大小(e.g. 499G)不能超过卷组的free size，可通过vgdisplay查看</div><div class="line">-l 后面指定PE大小(e.g. 127998)不能超过卷组的free PE大小，可通过vgdisplay查看</div><div class="line">[root@srm-fs ~]# lvs</div><div class="line">  LV      VG     Attr       LSize   Pool Origin Data%  Move Log Cpy%Sync Convert</div><div class="line">  lv-atm1 vg-atm -wi-a----- 499.99g</div><div class="line"></div><div class="line">[root@srm-fs ~]# lvdisplay</div><div class="line">  --- Logical volume ---</div><div class="line">  LV Path                /dev/vg-atm/lv-atm1</div><div class="line">  LV Name                lv-atm1</div><div class="line">  VG Name                vg-atm</div><div class="line">  LV UUID                U8nc8o-aa2p-NeNw-JMie-mjoh-eRfo-wKdQuS</div><div class="line">  LV Write Access        read/write</div><div class="line">  LV Creation host, time srm-fs, 2017-06-07 10:42:57 +0800</div><div class="line">  LV Status              available</div><div class="line">  # open                 0</div><div class="line">  LV Size                499.99 GiB</div><div class="line">  Current LE             127998</div><div class="line">  Segments               1</div><div class="line">  Allocation             inherit</div><div class="line">  Read ahead sectors     auto</div><div class="line">  - currently set to     256</div><div class="line">  Block device           253:0</div></pre></td></tr></table></figure><h3 id="在逻辑分区lv-atm上创建文件系统"><a href="#在逻辑分区lv-atm上创建文件系统" class="headerlink" title="在逻辑分区lv-atm上创建文件系统"></a>在逻辑分区lv-atm上创建文件系统</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@srm-fs ~]# mkfs.ext4 /dev/vg-atm/lv-atm1</div><div class="line">mke2fs 1.41.12 (17-May-2010)</div><div class="line">Filesystem label=</div><div class="line">OS type: Linux</div><div class="line">Block size=4096 (log=2)</div><div class="line">Fragment size=4096 (log=2)</div><div class="line">Stride=0 blocks, Stripe width=0 blocks</div><div class="line">32768000 inodes, 131069952 blocks</div><div class="line">6553497 blocks (5.00%) reserved for the super user</div><div class="line">First data block=0</div><div class="line">Maximum filesystem blocks=4294967296</div><div class="line">4000 block groups</div><div class="line">32768 blocks per group, 32768 fragments per group</div><div class="line">8192 inodes per group</div><div class="line">Superblock backups stored on blocks:</div><div class="line">32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,</div><div class="line">4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968,</div><div class="line">102400000</div><div class="line">Writing inode tables: done                            </div><div class="line">Creating journal (32768 blocks): done</div><div class="line">Writing superblocks and filesystem accounting information: done</div><div class="line">This filesystem will be automatically checked every 25 mounts or</div><div class="line">180 days, whichever comes first.  Use tune2fs -c or -i to override.</div></pre></td></tr></table></figure><h3 id="挂载文件系统"><a href="#挂载文件系统" class="headerlink" title="挂载文件系统"></a>挂载文件系统</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@srm-fs ~]# mount /dev/vg-atm/lv-atm1 /u01</div><div class="line">[root@srm-fs ~]# df -h</div><div class="line">Filesystem                    Size  Used Avail Use% Mounted on</div><div class="line">/dev/xvda2                     36G  2.4G   32G   7% /</div><div class="line">tmpfs                         487M     0  487M   0% /dev/shm</div><div class="line">/dev/mapper/vg--atm-lv--atm1  493G  198M  467G   1% /u01</div><div class="line">[root@srm-fs ~]# mount | grep u01</div><div class="line">/dev/mapper/vg--atm-lv--atm1 on /u01 type ext4</div><div class="line">创建好之后,会在/dev/mapper/生成一个软连接名字为”卷组-逻辑卷”从上面的命令也可以看出来。</div><div class="line">[root@srm-fs ~]# ll /dev/vg-atm/lv-atm1</div><div class="line">lrwxrwxrwx 1 root root 7 Jun  7 13:32 /dev/vg-atm/lv-atm1 -&gt; ../dm-0</div></pre></td></tr></table></figure><h3 id="配置开机自动挂载"><a href="#配置开机自动挂载" class="headerlink" title="配置开机自动挂载"></a>配置开机自动挂载</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">查看新增分区的UUID</div><div class="line">[root@srm-fs ~]# blkid</div><div class="line">/dev/xvda1: UUID=&quot;25ec3bdb-ba24-4561-bcdc-802edf42b85f&quot; TYPE=&quot;swap&quot;</div><div class="line">/dev/xvda2: UUID=&quot;1a1ce4de-e56a-4e1f-864d-31b7d9dfb547&quot; TYPE=&quot;ext4&quot;</div><div class="line">/dev/xvdb1: UUID=&quot;5KBToI-5jzg-P0ra-kdZO-3bt2-MRS2-Hbbjk3&quot; TYPE=&quot;LVM2_member&quot;</div><div class="line">/dev/mapper/vg--atm-lv--atm1: UUID=&quot;eb80318b-480f-486c-8b7c-6093974139f8&quot; TYPE=&quot;ext4&quot;</div><div class="line">编辑/etc/fstab,添加如下内容</div><div class="line">UUID=eb80318b-480f-486c-8b7c-6093974139f8&quot; TYPE=&quot;ext4  /u01    ext4   defaults   1 1</div></pre></td></tr></table></figure><h3 id="添加新的物理分区至卷组vg-atm"><a href="#添加新的物理分区至卷组vg-atm" class="headerlink" title="添加新的物理分区至卷组vg-atm"></a>添加新的物理分区至卷组vg-atm</h3><p>同样需要先创建pv，具体步骤省略<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vgextend vg-atm /dev/xvdc1</div></pre></td></tr></table></figure></p><h3 id="扩展逻辑分区lv-atm"><a href="#扩展逻辑分区lv-atm" class="headerlink" title="扩展逻辑分区lv-atm"></a>扩展逻辑分区lv-atm</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">lvextend -L +500M /dev/vg-atm/lv-atm1</div><div class="line">路径为逻辑分区的路径，可通过lvdisplay查看</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;创建物理分区&quot;&gt;&lt;a href=&quot;#创建物理分区&quot; class=&quot;headerlink&quot; title=&quot;创建物理分区&quot;&gt;&lt;/a&gt;创建物理分区&lt;/h3&gt;&lt;h4 id=&quot;查看是否有未分区的磁盘&quot;&gt;&lt;a href=&quot;#查看是否有未分区的磁盘&quot; class=&quot;headerlink&quot; title=&quot;查看是否有未分区的磁盘&quot;&gt;&lt;/a&gt;查看是否有未分区的磁盘&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@srm-fs ~]# fdisk -l&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Disk /dev/xvda: 42.9 GB, 42949672960 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;255 heads, 63 sectors/track, 5221 cylinders&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Units = cylinders of 16065 * 512 = 8225280 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Sector size (logical/physical): 512 bytes / 512 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;I/O size (minimum/optimal): 512 bytes / 512 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Disk identifier: 0x000d6814&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    Device Boot      Start         End      Blocks   Id  System&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/dev/xvda1               1         523     4194304   82  Linux swap / Solaris&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Partition 1 does not end on cylinder boundary.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/dev/xvda2   *         523        5222    37747712   83  Linux&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Disk /dev/xvdb: 536.9 GB, 536870912000 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;255 heads, 63 sectors/track, 65270 cylinders&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Units = cylinders of 16065 * 512 = 8225280 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Sector size (logical/physical): 512 bytes / 512 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;I/O size (minimum/optimal): 512 bytes / 512 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Disk identifier: 0x00000000&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Disk /dev/xvdc: 536.9 GB, 536870912000 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;255 heads, 63 sectors/track, 65270 cylinders&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Units = cylinders of 16065 * 512 = 8225280 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Sector size (logical/physical): 512 bytes / 512 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;I/O size (minimum/optimal): 512 bytes / 512 bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Disk identifier: 0x00000000&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;发现有两个未使用的磁盘，这里以xvdb为例&lt;br&gt;
    
    </summary>
    
      <category term="LINUX" scheme="https://shijieqin.github.io/categories/LINUX/"/>
    
      <category term="LVM" scheme="https://shijieqin.github.io/categories/LINUX/LVM/"/>
    
    
      <category term="LINUX" scheme="https://shijieqin.github.io/tags/LINUX/"/>
    
      <category term="LVM" scheme="https://shijieqin.github.io/tags/LVM/"/>
    
      <category term="DISK" scheme="https://shijieqin.github.io/tags/DISK/"/>
    
  </entry>
  
  <entry>
    <title>OpenVpn4Centos</title>
    <link href="https://shijieqin.github.io/2017/07/11/OpenVpn4Centos/"/>
    <id>https://shijieqin.github.io/2017/07/11/OpenVpn4Centos/</id>
    <published>2017-07-11T07:15:14.000Z</published>
    <updated>2017-07-11T07:15:14.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h3><ul><li>OpenVpn版本: 2.4.3  </li><li>Centos版本: 6.8  </li><li>本机IP: 192.168.5.3</li><li>实现功能：<ul><li>客户端需通过用户名密码登录</li><li>用户名密码为系统用户</li><li>不同用户分为不同网段</li><li>通过VPN服务器的iptables来限制不同网段的访问，间接限制用户<br>先实现证书登录，再实现用户名密码登录，也可以跳过证书登录的配置，直接实现用户名密码登录<a id="more"></a></li></ul></li></ul><table><thead><tr><th style="text-align:left">用户</th><th style="text-align:left">获得网段</th><th>可访问网段</th></tr></thead><tbody><tr><td style="text-align:left">普通用户</td><td style="text-align:left">10.0.2.0/24</td><td>192.168.3.0/24 192.168.4.0/24  192.168.5.0/24</td></tr><tr><td style="text-align:left">特殊用户</td><td style="text-align:left">10.0.1.0/24</td><td>192.168.0.0/24 192.168.1.0/24 192.168.5.0/24</td></tr><tr><td style="text-align:left">管理员</td><td style="text-align:left">10.0.0.0/24</td><td>192.168.0.0/16</td></tr></tbody></table><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><h4 id="安装epel库"><a href="#安装epel库" class="headerlink" title="安装epel库"></a>安装epel库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">wget http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm</div><div class="line">rpm -Uvh epel-release-6-8.noarch.rpm</div></pre></td></tr></table></figure><h4 id="安装openvpn"><a href="#安装openvpn" class="headerlink" title="安装openvpn"></a>安装openvpn</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install openvpn</div></pre></td></tr></table></figure><h4 id="安装easy-rs"><a href="#安装easy-rs" class="headerlink" title="安装easy-rs"></a>安装easy-rs</h4><p>该包用来制作ca证书，服务端证书，客户端证书。最新的为easy-rsa3<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wget https://github.com/OpenVPN/easy-rsa/archive/master.zip</div><div class="line">unzip master.zip</div><div class="line">mv easy-rsa-mater/ easy-rsa/</div><div class="line">cp -R easy-rsa/ /etc/openvpn/</div></pre></td></tr></table></figure></p><h4 id="编辑vars文件"><a href="#编辑vars文件" class="headerlink" title="编辑vars文件"></a>编辑vars文件</h4><ol><li><p>先进入/etc/openvpn/easy-rsa/easyrsa3目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd /etc/openvpn/easy-rsa/easyrsa3/</div></pre></td></tr></table></figure></li><li><p>复制vars.example 为vars</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp vars.example vars</div></pre></td></tr></table></figure></li><li><p>修改vars文件的如下字段</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">set_var EASYRSA_REQ_COUNTRY “CN” //根据自己情况更改</div><div class="line">set_var EASYRSA_REQ_PROVINCE “ShangHai”</div><div class="line">set_var EASYRSA_REQ_CITY “ShangHai”</div><div class="line">set_var EASYRSA_REQ_ORG “Test”</div><div class="line">set_var EASYRSA_REQ_EMAIL “test@test.com”</div><div class="line">set_var EASYRSA_REQ_OU “TestOpenVpn”</div></pre></td></tr></table></figure></li></ol><h4 id="初始化easyrsa"><a href="#初始化easyrsa" class="headerlink" title="初始化easyrsa"></a>初始化easyrsa</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /etc/openvpn/easy-rsa/easyrsa3/</div><div class="line">./easyrsa init-pki</div></pre></td></tr></table></figure><h4 id="创建CA-根-证书"><a href="#创建CA-根-证书" class="headerlink" title="创建CA(根)证书"></a>创建CA(根)证书</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">./easyrsa build-ca</div><div class="line"></div><div class="line">Generating a 2048 bit RSA private key</div><div class="line">…………………………………….+++</div><div class="line">……+++</div><div class="line"></div><div class="line">writing new private key to ‘/root/easy-rsa/easyrsa3/pki/private/ca.key’</div><div class="line">Enter PEM pass phrase:</div><div class="line">Verifying – Enter PEM pass phrase:</div><div class="line">—–</div><div class="line">You are about to be asked to enter information that will be incorporated</div><div class="line">into your certificate request.</div><div class="line">What you are about to enter is what is called a Distinguished Name or a DN.</div><div class="line">There are quite a few fields but you can leave some blank</div><div class="line">For some fields there will be a default value,</div><div class="line">If you enter ‘.’, the field will be left blank.</div><div class="line">—–</div><div class="line">Common Name (eg: your user, host, or server name) [Easy-RSA CA]:Test</div><div class="line">CA creation complete and you may now import and sign cert requests.</div><div class="line">Your new CA certificate file for publishing is at:</div><div class="line">/root/easy-rsa/easyrsa3/pki/ca.crt</div></pre></td></tr></table></figure><p>注意：在上述部分需要输入PEM密码 PEM pass phrase，输入两次，此密码必须记住，<br>不然以后不能为证书签名。还需要输入common name 通用名，这个你自己随便设置个独一无二的。</p><h4 id="创建服务器端证书"><a href="#创建服务器端证书" class="headerlink" title="创建服务器端证书"></a>创建服务器端证书</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">./easyrsa gen-req server nopass</div><div class="line"></div><div class="line"></div><div class="line">Generating a 2048 bit RSA private key</div><div class="line">……………………………………………………………………..+++</div><div class="line">……………………+++</div><div class="line">writing new private key to ‘/root/easy-rsa/easyrsa3/pki/private/server.key’</div><div class="line">—–</div><div class="line">You are about to be asked to enter information that will be incorporated</div><div class="line">into your certificate request.</div><div class="line">What you are about to enter is what is called a Distinguished Name or a DN.</div><div class="line">There are quite a few fields but you can leave some blank</div><div class="line">For some fields there will be a default value,</div><div class="line">If you enter ‘.’, the field will be left blank.</div><div class="line">—–</div><div class="line">Common Name (eg: your user, host, or server name) [server]:TestServer</div><div class="line">Keypair and certificate request completed. Your files are:</div><div class="line">req: /root/easy-rsa/easyrsa3/pki/reqs/server.req</div><div class="line">key: /root/easy-rsa/easyrsa3/pki/private/server.key</div></pre></td></tr></table></figure><p>该过程中需要输入common name，随意但是不要跟之前的根证书的一样</p><h4 id="签约服务端证书"><a href="#签约服务端证书" class="headerlink" title="签约服务端证书"></a>签约服务端证书</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">./easyrsa sign server server</div><div class="line"></div><div class="line"></div><div class="line">You are about to sign the following certificate.</div><div class="line">Please check over the details shown below for accuracy. Note that this request</div><div class="line">has not been cryptographically verified. Please be sure it came from a trusted</div><div class="line">source or that you have verified the request checksum with the sender.</div><div class="line">Request subject, to be signed as a server certificate for 3650 days:</div><div class="line">subject=</div><div class="line">commonName = TestServer</div><div class="line">Type the word ‘yes’ to continue, or any other input to abort.</div><div class="line">Confirm request details: yes</div><div class="line">Using configuration from /root/easy-rsa/easyrsa3/openssl-1.0.cnf</div><div class="line">Enter pass phrase for /root/easy-rsa/easyrsa3/pki/private/ca.key:</div><div class="line">Check that the request matches the signature</div><div class="line">Signature ok</div><div class="line">The Subject’s Distinguished Name is as follows</div><div class="line">commonName</div><div class="line">RINTABLE:’TestServer’</div><div class="line">Certificate is to be certified until Apr 20 06:02:10 2024 GMT (3650 days)</div><div class="line">Write out database with 1 new entries</div><div class="line">Data Base Updated</div><div class="line">Certificate created at: /root/easy-rsa/easyrsa3/pki/issued/server.crt</div></pre></td></tr></table></figure><p>该命令中.需要你确认生成，要输入yes，还需要你提供我们当时创建CA时候的密码。如果你忘记了密码，<br>那你就重头开始再来一次吧。</p><h4 id="创建Diffie-Hellman"><a href="#创建Diffie-Hellman" class="headerlink" title="创建Diffie-Hellman"></a>创建Diffie-Hellman</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">./easyrsa gen-dh</div><div class="line"></div><div class="line"></div><div class="line">Note: using Easy-RSA configuration from: ./vars</div><div class="line">Generating DH parameters, 2048 bit long safe prime, generator 2</div><div class="line">This is going to take a long time</div><div class="line">……..+……………………………….+..+…………………………………………………………………………………………………………………………….</div><div class="line">DH parameters of size 2048 created at /etc/openvpn/easy-rsa/easyrsa3/pki/dh.pem</div></pre></td></tr></table></figure><h4 id="创建客户端证书"><a href="#创建客户端证书" class="headerlink" title="创建客户端证书"></a>创建客户端证书</h4><p>以下是为了实现证书登录而做的操作。<br>为了避免与服务器端证书冲突，因此另外复制一份easyrsa到另一个文件夹下操作。<br>进入root目录新建client文件夹(也可以是任意目录，只要有权限访问)，文件夹可随意命名，<br>然后拷贝前面解压得到的easy-ras文件夹到client文件夹,进入下列目录,并初始化<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd /root/</div><div class="line">mkdir client</div><div class="line">cp -R easy-rsa/ client/</div><div class="line">cd client/easy-rsa/easyrsa3/</div><div class="line">./easyrsa init-pki</div></pre></td></tr></table></figure></p><ul><li><p>创建客户端key及生成证书（记住生成是自己输入的密码）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./easyrsa gen-req client (名字自定义)</div></pre></td></tr></table></figure></li><li><p>将的到的client.req导入然后签约证书</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd /etc/openvpn/easy-rsa/easyrsa3/</div><div class="line">./easyrsa import-req /root/client/easy-rsa/easyrsa3/pki/reqs/client.req client</div><div class="line">./easyrsa sign client client(后面这个为客户端证书的名字，前面的为固定格式)</div></pre></td></tr></table></figure></li></ul><p>过程跟签约server类似，需要输入CA证书的密码</p><h4 id="现在说一下我们上面都生成了什么东西"><a href="#现在说一下我们上面都生成了什么东西" class="headerlink" title="现在说一下我们上面都生成了什么东西"></a>现在说一下我们上面都生成了什么东西</h4><p>服务端：(/cetc/openvpn/easy-rsa/文件夹)</p><ul><li>/etc/openvpn/easy-rsa/easyrsa3/pki/ca.crt</li><li>/etc/openvpn/easy-rsa/easyrsa3/pki/reqs/server.req</li><li>/etc/openvpn/easy-rsa/easyrsa3/pki/reqs/client.req</li><li>/etc/openvpn/easy-rsa/easyrsa3/pki/private/ca.key</li><li>/etc/openvpn/easy-rsa/easyrsa3/pki/private/server.key</li><li>/etc/openvpn/easy-rsa/easyrsa3/pki/issued/server.crt</li><li>/etc/openvpn/easy-rsa/easyrsa3/pki/issued/client.crt</li><li>/etc/openvpn/easy-rsa/easyrsa3/pki/dh.pem</li></ul><p>客户端：(root/client/easy-rsa文件夹)</p><ul><li>/root/client/easy-rsa/easyrsa3/pki/private/client.key</li><li>/root/client/easy-rsa/easyrsa3/pki/reqs/client.req //这个文件被我们导入到了服务端,<pre><code>所以那里也有</code></pre><h4 id="将生成的证书拷贝到指定文件夹-etc-openvpn-keys"><a href="#将生成的证书拷贝到指定文件夹-etc-openvpn-keys" class="headerlink" title="将生成的证书拷贝到指定文件夹(/etc/openvpn/keys)"></a>将生成的证书拷贝到指定文件夹(/etc/openvpn/keys)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cp /etc/openvpn/easy-rsa/easyrsa3/pki/ca.crt /etc/openvpn/keys</div><div class="line">cp /etc/openvpn/easy-rsa/easyrsa3/pki/private/server.key /etc/openvpn/keys</div><div class="line">cp /etc/openvpn/easy-rsa/easyrsa3/pki/issued/server.crt /etc/openvpn/keys</div><div class="line">cp /etc/openvpn/easy-rsa/easyrsa3/pki/dh.pem /etc/openvpn/keys</div></pre></td></tr></table></figure></li></ul><h4 id="生成ta-key文件并移动到-etc-openvpn-keys"><a href="#生成ta-key文件并移动到-etc-openvpn-keys" class="headerlink" title="生成ta.key文件并移动到/etc/openvpn/keys"></a>生成ta.key文件并移动到/etc/openvpn/keys</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">openvpn --genkey --secret ta.key</div><div class="line">mv ta.key /etc/openvpn/keys</div></pre></td></tr></table></figure><h4 id="编辑server的配置文件"><a href="#编辑server的配置文件" class="headerlink" title="编辑server的配置文件"></a>编辑server的配置文件</h4><p>当你安装好了openvpn时候，他会提供一个server配置的文件例子，在<br>/usr/share/doc/openvpn-2.4.3/sample/sample-config-files<br>下会有一个server.conf文件，我们将这个文件复制到/etc/openvpn<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp /usr/share/doc/openvpn-2.4.3/sample/sample-config-files/server.conf /etc/openvpn</div></pre></td></tr></table></figure></p><p>修改配置文件为如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">local 192.168.5.3 #本地IP，既服务器的IP地址</div><div class="line">port 1194 #vpn端口</div><div class="line">proto udp #使用UDP协议，也可以选择tcp协议</div><div class="line">dev tun #相对应的tab，tab是桥接模式，tun为虚拟网卡模式</div><div class="line">ca /etc/openvpn/keys/ca.crt #ca证书</div><div class="line">cert /etc/openvpn/keys/server.crt #服务器端证书</div><div class="line">key /etc/openvpn/keys/server.key  #服务器端的key，需保密</div><div class="line">dh /etc/openvpn/keys/dh.pem #dh证书</div><div class="line">server 10.0.2.0 255.255.255.0 #普通vpn用户虚拟IP的网段</div><div class="line">ifconfig-pool-persist /etc/openvpn/ipp.txt #虚拟IP记录文件，防止重复分发IP</div><div class="line">push &quot;route 192.168.0.0 255.255.255.0&quot; #网客户端注入route规则，用来实现部分网段走vpn，</div><div class="line">                                        其他网段仍然走客户端电脑的默认链路</div><div class="line">push &quot;route 192.168.1.0 255.255.255.0&quot;</div><div class="line">push &quot;route 192.168.2.0 255.255.255.0&quot;</div><div class="line">push &quot;route 192.168.3.0 255.255.255.0&quot;</div><div class="line">push &quot;route 192.168.4.0 255.255.255.0&quot;</div><div class="line">push &quot;route 192.168.5.0 255.255.255.0&quot;</div><div class="line">client-config-dir /etc/openvpn/ccd #用户个性化配置目录，特殊用户与管理员用户</div><div class="line">                                    的网段就是通过这个文件夹下的配置实现的</div><div class="line">route 10.0.0.0 255.255.255.0 #添加本地route，将特殊用户与管理员用户</div><div class="line">                              的网段加入vpn服务器的路由表中</div><div class="line">route 10.0.1.0 255.255.255.0</div><div class="line">push &quot;dhcp-option DNS 114.114.114.114&quot; #为客户端电脑得到的虚拟IP推送DNS</div><div class="line">duplicate-cn #允许同一个证书或同一个用户同一时间多次登录</div><div class="line">keepalive 10 120 #客户端与服务器的心跳包，互相知道对方是否断开</div><div class="line">tls-auth /etc/openvpn/keys/ta.key 0 #ta证书，需保密</div><div class="line">cipher AES-256-CBC #加密规则</div><div class="line">comp-lzo #兼容旧的客户端</div><div class="line">max-clients 100 #客户端数量</div><div class="line">persist-key</div><div class="line">persist-tun</div><div class="line">status /etc/openvpn/logs/openvpn-status.log #日志文件</div><div class="line">log         /etc/openvpn/logs/openvpn.log #日志文件</div><div class="line">verb 3 #日志等级</div></pre></td></tr></table></figure><p>创建 /etc/openvpn/logs文件夹<br>创建 /etc/openvpn/ccd文件夹</p><h4 id="配置特殊用户的个性化配置"><a href="#配置特殊用户的个性化配置" class="headerlink" title="配置特殊用户的个性化配置"></a>配置特殊用户的个性化配置</h4><p>文件名必须与客户端证书名或者与下面即将配置的用户名密码登录的用户名一致，<br>一个用户一个对应的文件，如果没有，则按默认配置<br>这里假设client为特殊用户，既获得的网段在192.168.1.0/24。<br>需要创建client对应的客户端证书(如果使用用户名密码登录，需要创建对应用户)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">touch client</div><div class="line">vi client</div><div class="line"></div><div class="line">ifconfig-push 10.0.1.1 10.0.1.2</div><div class="line"># 这里是指定该用户的IP，既直接固定IP，而不是随机分配。暂时没找到指定IP段的方法。</div><div class="line">因此，通过固定IP的方式来达到特殊用户属于特殊网段</div><div class="line"># 这里指定的是一对IP，表示虚拟客户端和服务器的IP端点。</div><div class="line">它们必须从连续的/30子网网段中获取</div><div class="line">(这里是/30表示xxx.xxx.xxx.xxx/30，即子网掩码位数为30)，</div><div class="line">以便于与Windows客户端和TAP-Windows驱动兼容。暂时还没理解。</div><div class="line">明确地说，每个端点的IP地址对的最后8位字节必须取自下面的集合：</div><div class="line">[  1,  2]  [  5,  6]  [  9, 10]  [ 13, 14]</div><div class="line">[ 17, 18]  [ 21, 22]  [ 25, 26]  [ 29, 30]   </div><div class="line">[ 33, 34]  [ 37, 38]  [ 41, 42]  [ 45, 46]</div><div class="line">[ 49, 50]  [ 53, 54]  [ 57, 58]  [ 61, 62]   </div><div class="line">[ 65, 66]  [ 69, 70]  [ 73, 74]  [ 77, 78]</div><div class="line">[ 81, 82]  [ 85, 86]  [ 89, 90]  [ 93, 94]   </div><div class="line">[ 97, 98]  [101,102]  [105,106]  [109,110]   </div><div class="line">[113,114]  [117,118]  [121,122]  [125,126]   </div><div class="line">[129,130]  [133,134]  [137,138]  [141,142]   </div><div class="line">[145,146]  [149,150]  [153,154]  [157,158]</div><div class="line">[161,162]  [165,166]  [169,170]  [173,174]   </div><div class="line">[177,178]  [181,182]  [185,186]  [189,190]   </div><div class="line">[193,194]  [197,198]  [201,202]  [205,206]   </div><div class="line">[209,210]  [213,214]  [217,218]  [221,222]   </div><div class="line">[225,226]  [229,230]  [233,234]  [237,238]</div><div class="line">[241,242]  [245,246]  [249,250]  [253,254]</div></pre></td></tr></table></figure></p><h4 id="下载openvpn客户端，并进行配置"><a href="#下载openvpn客户端，并进行配置" class="headerlink" title="下载openvpn客户端，并进行配置"></a>下载openvpn客户端，并进行配置</h4><p>用sftp将我们在vpn服务器上生成的客户端证书和key下载到客户端电脑，包括如下四个文件</p><ul><li>/etc/openvpn/easy-rsa/easyrsa3/pki/ca.crt</li><li>/etc/openvpn/easy-rsa/easyrsa3/pki/issued/client.crt</li><li>/root/client/easy-rsa/easyrsa3/pki/private/client.key</li><li>/etc/openvpn/keys/ta.key<br>去官网下载openvpn客户端进行安装，然后安装目录找到simple-config，<br>默认为C:\Program Files\OpenVPN\sample-config\client.ovpn。<br>将client.ovpn 复制到openvpn的config目录下，<br>默认为C:\Program Files\OpenVPN\config<br>将下载到的四个文件同样放入config目录下，<br>默认为C:\Program Files\OpenVPN\config  </li></ul><p>修改配置文件为如下内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">client #标记为客户端</div><div class="line">dev tun #与服务器端配置一致</div><div class="line">proto udp #与服务器端配置一致</div><div class="line">remote 122.112.219.248 1194 #服务器端IP与端口</div><div class="line">resolv-retry infinite</div><div class="line">nobind</div><div class="line">persist-key</div><div class="line">persist-tun</div><div class="line">ca ca.crt #ca证书</div><div class="line">cert client.crt #客户端证书</div><div class="line">key client.key #客户端证书的key</div><div class="line">remote-cert-tls server #服务器证书的名字</div><div class="line">tls-auth ta.key 1 #ta证书，如果服务器端配置，则客户端必须配置</div><div class="line">cipher AES-256-CBC #与服务器端配置一致</div><div class="line">comp-lzo #与服务器端配置一致</div><div class="line">verb 3 #日志级别</div></pre></td></tr></table></figure></p><p>经过以上配置，客户端就能连接上vpn服务器了(服务器端的1194端口要开放)，但是并不能访问内网服务器，<br>因为vpn服务器没有配置虚拟ip的转发。</p><h4 id="配置服务器端iptables"><a href="#配置服务器端iptables" class="headerlink" title="配置服务器端iptables"></a>配置服务器端iptables</h4><p>通过如下命令来达到将某个网段的IP转发到主网卡上，以达到与内网服务器通信的目的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t nat -A POSTROUTING -s 10.0.1.0/24 -d 192.168.0.0/24 -o eth0 -j MASQUERADE</div></pre></td></tr></table></figure></p><p>为了实现不同用户不同权限，需要做如下操作来限制不同网段的用户的访问权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">iptables -t nat -A POSTROUTING -s 10.0.0.0/24 -o eth0 -j MASQUERADE</div><div class="line">iptables -t nat -A POSTROUTING -s 10.0.1.0/24 -d 192.168.0.0/24 -o eth0 -j MASQUERADE</div><div class="line">iptables -t nat -A POSTROUTING -s 10.0.1.0/24 -d 192.168.1.0/24 -o eth0 -j MASQUERADE</div><div class="line">iptables -t nat -A POSTROUTING -s 10.0.1.0/24 -d 192.168.5.0/24 -o eth0 -j MASQUERADE</div><div class="line">iptables -t nat -A POSTROUTING -s 10.0.2.0/24 -d 192.168.3.0/24 -o eth0 -j MASQUERADE</div><div class="line">iptables -t nat -A POSTROUTING -s 10.0.2.0/24 -d 192.168.4.0/24 -o eth0 -j MASQUERADE</div><div class="line">iptables -t nat -A POSTROUTING -s 10.0.2.0/24 -d 192.168.5.0/24 -o eth0 -j MASQUERADE</div></pre></td></tr></table></figure></p><p>经过如此配置，即可访问内网<br>配置完成后，使用如下命令保存iptables 规则到文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service iptables save</div></pre></td></tr></table></figure></p><h4 id="实现用户名密码登录"><a href="#实现用户名密码登录" class="headerlink" title="实现用户名密码登录"></a>实现用户名密码登录</h4><p>在经过以上配置后，再来实现用户名密码登录就简单多了，只需要改一些配置即可。</p><h5 id="修改服务器端配置"><a href="#修改服务器端配置" class="headerlink" title="修改服务器端配置"></a>修改服务器端配置</h5><p>编辑/etc/openvpn/server.conf,添加如下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">plugin /usr/lib64/openvpn/plugin/lib/openvpn-auth-pam.so login #我是64位操作系统</div><div class="line">client-cert-not-required #只需验证用户名密码，不要求客户端证书</div><div class="line">username-as-common-name #用户名做common-name，既用户名相当于客户端名，个性化的时候使用用户名即可。</div></pre></td></tr></table></figure></p><p>编辑客户端配置文件，既C:\Program Files\OpenVPN\sample-config\client.ovpn<br>注释掉如下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">;cert client.crt</div><div class="line">;key client.key</div></pre></td></tr></table></figure></p><p>添加如下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">auth-user-pass</div></pre></td></tr></table></figure></p><p>创建服务器用户，由于仅作为vpn用户登录，因此建议创建不带home目录，没有登录权限的用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">useradd -M user1 -s /sbin/nologin</div><div class="line">echo &quot;password&quot; | passwd user1 --stdin</div></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;声明&quot;&gt;&lt;a href=&quot;#声明&quot; class=&quot;headerlink&quot; title=&quot;声明&quot;&gt;&lt;/a&gt;声明&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;OpenVpn版本: 2.4.3  &lt;/li&gt;
&lt;li&gt;Centos版本: 6.8  &lt;/li&gt;
&lt;li&gt;本机IP: 192.168.5.3&lt;/li&gt;
&lt;li&gt;实现功能：&lt;ul&gt;
&lt;li&gt;客户端需通过用户名密码登录&lt;/li&gt;
&lt;li&gt;用户名密码为系统用户&lt;/li&gt;
&lt;li&gt;不同用户分为不同网段&lt;/li&gt;
&lt;li&gt;通过VPN服务器的iptables来限制不同网段的访问，间接限制用户&lt;br&gt;先实现证书登录，再实现用户名密码登录，也可以跳过证书登录的配置，直接实现用户名密码登录
    
    </summary>
    
      <category term="OpenVpn" scheme="https://shijieqin.github.io/categories/OpenVpn/"/>
    
    
      <category term="OpenVpn" scheme="https://shijieqin.github.io/tags/OpenVpn/"/>
    
  </entry>
  
  <entry>
    <title>s3fs on obs</title>
    <link href="https://shijieqin.github.io/2017/06/21/s3fs-on-obs/"/>
    <id>https://shijieqin.github.io/2017/06/21/s3fs-on-obs/</id>
    <published>2017-06-21T08:47:14.000Z</published>
    <updated>2017-06-21T08:47:14.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="s3fs简介"><a href="#s3fs简介" class="headerlink" title="s3fs简介"></a>s3fs简介</h3><p>s3fs 是一款用于 Amazon S3 在 Linux 环境下的命令行工具，并为商业和私人免费使用，只需支付对应的存储服务的费用。它的主要功能是能够把桶（Bucket）挂载到本地目录，进行文件、文件夹的拷入、拷出和删除等操作，即完成对桶内文件、文件夹的上传、下载和删除操作。<br><a id="more"></a></p><h3 id="下载s3fs"><a href="#下载s3fs" class="headerlink" title="下载s3fs"></a>下载s3fs</h3><p>登录网址 <a href="http://code.google.com/p/s3fs/downloads/list" target="_blank" rel="external">http://code.google.com/p/s3fs/downloads/list</a> 进入下载界面，选择相应<br>版本，单击“Download”进行下载。<br>本文档以s3fs-1.74.tar.gz为例</p><h3 id="安装s3fs"><a href="#安装s3fs" class="headerlink" title="安装s3fs"></a>安装s3fs</h3><h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">yum install fuse.x86_64 fuse-devel.x86_64 fuse-libs.x86_64 libconfuse-devel.x86_64 libconfuse.x86_64 gcc-c++.noarch curl.x86_64 libcurl-devel.x86_64 libcurl.x86_64 libxml2.x86_64 libxml2-devel.x86_64 openssl-devel.x86_64</div><div class="line"># 检查fuse版本(必须要大于2.8.4)</div><div class="line">rpm -qa | grep fuse</div><div class="line"># 若小于2.8.4，则需要用源码安装新版的fuse，如下</div><div class="line">yum remove fuse fuse-devel</div><div class="line">tar -xvf fuse-2.8.4.tar</div><div class="line">cd fuse-2.8.4</div><div class="line">./configure --prefix=/usr/local/fuse</div><div class="line">make</div><div class="line">make install</div><div class="line">echo /usr/local/fuse/lib &gt;&gt; /etc/ld.so.conf</div><div class="line">echo &quot;export PKG_CONFIG_PATH=/usr/lib/pkgconfig:/usr/lib64/pkgconfig/:/usr/local/fuse/lib/pkgconfig/&quot; &gt;&gt; /etc/profile</div><div class="line">source /etc/profile</div><div class="line">ldconfig</div><div class="line">modprobe fuse</div><div class="line">pkg-config --modversion fuse</div></pre></td></tr></table></figure><h4 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -zxvf s3fs-1.74.tar.gz</div></pre></td></tr></table></figure><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd s3fs-1.74</div><div class="line">./configure</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure><h4 id="配置秘钥"><a href="#配置秘钥" class="headerlink" title="配置秘钥"></a>配置秘钥</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vi /etc/passwd-s3fs</div><div class="line"># 添加秘钥，格式如下</div><div class="line">AK:SK</div><div class="line"># 更改权限</div><div class="line">chmod 640 /etc/passwd-s3fs</div></pre></td></tr></table></figure><h4 id="创建obs用户"><a href="#创建obs用户" class="headerlink" title="创建obs用户"></a>创建obs用户</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">groupadd obs</div><div class="line">useradd -g obs obs</div></pre></td></tr></table></figure><h4 id="用户obs用户创建cache文件夹"><a href="#用户obs用户创建cache文件夹" class="headerlink" title="用户obs用户创建cache文件夹"></a>用户obs用户创建cache文件夹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir .obs_cache</div></pre></td></tr></table></figure><h4 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">s3fs www.going-link.com /obs -o host=http://obs.myhwclouds.com -o umask=0022 -o uid=501 -o gid=501 -o use_cache=/home/obs/.obs_cache -o allow_other</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;s3fs简介&quot;&gt;&lt;a href=&quot;#s3fs简介&quot; class=&quot;headerlink&quot; title=&quot;s3fs简介&quot;&gt;&lt;/a&gt;s3fs简介&lt;/h3&gt;&lt;p&gt;s3fs 是一款用于 Amazon S3 在 Linux 环境下的命令行工具，并为商业和私人免费使用，只需支付对应的存储服务的费用。它的主要功能是能够把桶（Bucket）挂载到本地目录，进行文件、文件夹的拷入、拷出和删除等操作，即完成对桶内文件、文件夹的上传、下载和删除操作。&lt;br&gt;
    
    </summary>
    
      <category term="华为云" scheme="https://shijieqin.github.io/categories/%E5%8D%8E%E4%B8%BA%E4%BA%91/"/>
    
      <category term="obs" scheme="https://shijieqin.github.io/categories/%E5%8D%8E%E4%B8%BA%E4%BA%91/obs/"/>
    
    
      <category term="华为云" scheme="https://shijieqin.github.io/tags/%E5%8D%8E%E4%B8%BA%E4%BA%91/"/>
    
      <category term="obs" scheme="https://shijieqin.github.io/tags/obs/"/>
    
  </entry>
  
  <entry>
    <title>duplicity install</title>
    <link href="https://shijieqin.github.io/2017/06/20/duplicity-install/"/>
    <id>https://shijieqin.github.io/2017/06/20/duplicity-install/</id>
    <published>2017-06-20T10:17:26.000Z</published>
    <updated>2017-06-20T10:17:26.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="安装环境依赖"><a href="#安装环境依赖" class="headerlink" title="安装环境依赖"></a>安装环境依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum install -y gcc-c++ librsync python-lockfile python-urllib3 python-setuptools python-devel librsync-devel python-pip</div><div class="line"></div><div class="line">pip install oss2</div></pre></td></tr></table></figure><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">tar zxvf duplicity.tar.gz</div><div class="line">cd duplicity</div><div class="line">python setup.py install</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;安装环境依赖&quot;&gt;&lt;a href=&quot;#安装环境依赖&quot; class=&quot;headerlink&quot; title=&quot;安装环境依赖&quot;&gt;&lt;/a&gt;安装环境依赖&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gut
      
    
    </summary>
    
      <category term="duplicity" scheme="https://shijieqin.github.io/categories/duplicity/"/>
    
      <category term="install" scheme="https://shijieqin.github.io/categories/duplicity/install/"/>
    
    
      <category term="duplicity" scheme="https://shijieqin.github.io/tags/duplicity/"/>
    
  </entry>
  
</feed>
